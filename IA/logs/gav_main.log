2025-08-12 18:10:18,878 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-12 18:10:18,951 [INFO] [root:21] [<module>] Cliente Twilio inicializado com sucesso
2025-08-12 18:10:18,984 [INFO] [werkzeug:97] [_log] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.18.0.4:8080
2025-08-12 18:10:18,985 [INFO] [werkzeug:97] [_log] [33mPress CTRL+C to quit[0m
2025-08-12 18:10:18,986 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-12 18:10:19,659 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-12 18:10:19,727 [INFO] [root:21] [<module>] Cliente Twilio inicializado com sucesso
2025-08-12 18:10:19,757 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-12 18:10:19,759 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 903-193-335
2025-08-12 18:10:23,262 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:10:23] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:10:23,265 [DEBUG] [root:94] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:10:23,272 [DEBUG] [root:133] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:10:23,276 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'ü§ñ Ol√°! Como posso ajudar voc√™ hoje?'
2025-08-12 18:10:23,654 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:10:23,656 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:10:23,657 [INFO] [root:1386] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-12 18:10:32,825 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:10:32] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:10:32,828 [DEBUG] [root:94] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:10:32,832 [DEBUG] [root:133] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:10:32,833 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üõí *SEU CARRINHO:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
*1.* REFRIG.COCA-COLA LT 350ML
   10√ó R$ 4,20 = *R$ 42,00*

*...'
2025-08-12 18:10:33,041 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:10:33,042 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:10:33,043 [INFO] [root:1386] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-12 18:10:41,645 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:10:41] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:10:41,651 [DEBUG] [root:94] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:10:41,659 [DEBUG] [root:133] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:10:41,660 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üõí *SEU CARRINHO:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
*1.* REFRIG.COCA-COLA LT 350ML
   10√ó R$ 4,20 = *R$ 42,00*

*...'
2025-08-12 18:10:41,833 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:10:41,835 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:10:41,837 [INFO] [root:1386] [process_message_async] THREAD: Processamento finalizado para 'esvaziar carrinho'
2025-08-12 18:10:56,311 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:10:56] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:10:56,316 [DEBUG] [root:94] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:10:56,331 [DEBUG] [root:133] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:10:56,332 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'ü§ñ N√£o encontrei esse item no carrinho.

üõí *SEU CARRINHO:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
*1.* REFRIG.COCA-COLA...'
2025-08-12 18:10:56,506 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:10:56,508 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:10:56,509 [INFO] [root:1386] [process_message_async] THREAD: Processamento finalizado para 'remover item'
2025-08-12 18:11:04,227 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:11:04] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:11:04,233 [DEBUG] [root:94] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:11:04,238 [DEBUG] [root:133] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:11:04,239 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'ü§ñ Ol√°! Como posso ajudar voc√™ hoje?'
2025-08-12 18:11:04,415 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:11:04,421 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:11:04,427 [INFO] [root:1386] [process_message_async] THREAD: Processamento finalizado para 'remover coca cola'
2025-08-12 18:11:17,568 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:11:17] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:11:17,576 [DEBUG] [root:94] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:11:17,583 [DEBUG] [root:133] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:11:17,584 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üõí *SEU CARRINHO:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
*1.* REFRIG.COCA-COLA LT 350ML
   10√ó R$ 4,20 = *R$ 42,00*

*...'
2025-08-12 18:11:17,771 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:11:17,773 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:11:17,774 [INFO] [root:1386] [process_message_async] THREAD: Processamento finalizado para 'remover coca cola do carrinho'
2025-08-12 18:11:28,917 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:11:28] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:11:28,924 [DEBUG] [root:94] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:11:28,928 [DEBUG] [root:133] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:11:28,928 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üõí *SEU CARRINHO:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
*1.* REFRIG.COCA-COLA LT 350ML
   10√ó R$ 4,20 = *R$ 42,00*

*...'
2025-08-12 18:11:29,119 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:11:29,121 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:11:29,123 [INFO] [root:1386] [process_message_async] THREAD: Processamento finalizado para 'limpar carrinho'
2025-08-12 18:15:28,870 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/core/session_manager.py', reloading
2025-08-12 18:15:28,937 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-12 18:15:29,909 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-12 18:15:29,998 [INFO] [root:21] [<module>] Cliente Twilio inicializado com sucesso
2025-08-12 18:15:30,034 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-12 18:15:30,035 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 903-193-335
2025-08-12 18:18:24,680 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-12 18:18:24,729 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-12 18:18:25,444 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-12 18:18:25,511 [INFO] [root:21] [<module>] Cliente Twilio inicializado com sucesso
2025-08-12 18:18:25,537 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-12 18:18:25,539 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 903-193-335
2025-08-12 18:18:34,567 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:18:34] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:18:34,572 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:18:34,574 [INFO] [root:378] [detect_user_intent_type] [INTENT] Comando de limpeza detectado: 'esvaziar carrinho'
2025-08-12 18:18:34,578 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:18:34,578 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üóëÔ∏è Carrinho esvaziado! 2 itens removidos.

üîç Digite o nome do produto
üì¶ Digite *produtos* para ver o...'
2025-08-12 18:18:35,152 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:18:35,154 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:18:35,155 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'esvaziar carrinho'
2025-08-12 18:18:48,034 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:18:48] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:18:48,041 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:18:48,055 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:18:48,056 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üõí Seu carrinho est√° vazio.

üîç Digite o nome do produto
üì¶ Digite *produtos* para ver os mais vendidos...'
2025-08-12 18:18:48,274 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:18:48,275 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:18:48,276 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-12 18:18:55,210 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:18:55] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:18:55,214 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:18:55,215 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero coca cola'
2025-08-12 18:18:55,216 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-12 18:18:55,218 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 5500 caracteres
2025-08-12 18:18:55,220 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5500 caracteres
2025-08-12 18:18:55,236 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-12 18:18:55,239 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-12 18:18:55,242 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fa47836e070>
2025-08-12 18:18:55,242 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-12 18:18:55,243 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-12 18:18:55,244 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-12 18:18:55,244 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-12 18:18:55,245 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-12 18:18:59,801 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Tue, 12 Aug 2025 18:18:59 GMT'), (b'Content-Length', b'334')])
2025-08-12 18:18:59,803 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-12 18:18:59,804 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-12 18:18:59,805 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-12 18:18:59,806 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-12 18:18:59,806 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-12 18:18:59,807 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.57s
2025-08-12 18:18:59,808 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-12 18:18:59,809 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-12 18:18:59,810 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-12 18:18:59,816 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 3 produtos e 59 termos.
2025-08-12 18:18:59,817 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: coca cola
2025-08-12 18:18:59,835 [INFO] [root:352] [fuzzy_search_products] [FUZZY] Busca fuzzy no banco para: 'coca cola'
2025-08-12 18:18:59,840 [INFO] [root:397] [fuzzy_search_products] [FUZZY] Retornando 2 produtos do banco
2025-08-12 18:18:59,844 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:18:59,845 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üì¶ *üì¶ Encontrei estes produtos relacionados a 'coca cola'::*

*1.* REFRIG.COCA-COLA PET 2L
    üí∞ R$ 8...'
2025-08-12 18:19:00,063 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:19:00,075 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:19:00,084 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'quero coca cola'
2025-08-12 18:19:05,959 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:19:05] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:19:05,963 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:19:05,968 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:19:05,971 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'Quantas unidades de REFRIG.COCA-COLA LT 350ML voc√™ deseja adicionar?'
2025-08-12 18:19:06,176 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:19:06,177 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:19:06,178 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para '2'
2025-08-12 18:19:15,051 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:19:15] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:19:15,058 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:19:15,064 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'coca cola'
2025-08-12 18:19:15,078 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:19:15,079 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: '‚úÖ Perfeito! Adicionei 10 REFRIG.COCA-COLA LT 350ML ao seu carrinho.

üõí *SEU CARRINHO:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ...'
2025-08-12 18:19:15,367 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:19:15,370 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:19:15,372 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para '10'
2025-08-12 18:19:22,209 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:19:22] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:19:22,212 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:19:22,215 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:19:22,216 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üõí *SEU CARRINHO:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
*1.* REFRIG.COCA-COLA LT 350ML
   10√ó R$ 4,20 = *R$ 42,00*

‚îÅ...'
2025-08-12 18:19:22,468 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:19:22,470 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:19:22,472 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-12 18:19:33,665 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:19:33] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:19:33,670 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:19:33,673 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:19:33,674 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'ü§ñ Ol√°! Como posso ajudar voc√™ hoje?'
2025-08-12 18:19:33,983 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:19:33,987 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:19:33,989 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'Adiciona mais 5 coca cola'
2025-08-12 18:19:53,722 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:19:53] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:19:53,726 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:19:53,730 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:19:53,732 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üõí *SEU CARRINHO:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
*1.* REFRIG.COCA-COLA LT 350ML
   10√ó R$ 4,20 = *R$ 42,00*

‚îÅ...'
2025-08-12 18:19:53,959 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:19:53,961 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:19:53,962 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'mudar item do carrinho'
2025-08-12 18:20:18,282 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:20:18] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:20:18,287 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:20:18,291 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:20:18,291 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: '‚≠ê Para finalizar a compra, preciso do seu CNPJ.'
2025-08-12 18:20:18,492 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:20:18,495 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:20:18,496 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'finalizar'
2025-08-12 18:20:31,377 [INFO] [werkzeug:97] [_log] 172.18.0.1 - - [12/Aug/2025 18:20:31] "POST /webhook HTTP/1.1" 200 -
2025-08-12 18:20:31,381 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:20:31,393 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-12 18:20:31,393 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'ü§ñ N√£o encontrei um cliente com o CNPJ 12345678910236. Mas posso registrar seu pedido mesmo assim!

‚úÖ...'
2025-08-12 18:20:31,639 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-12 18:20:31,641 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-12 18:20:31,642 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para '12345678910236'
2025-08-13 11:01:59,663 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 11:01:59,721 [INFO] [root:21] [<module>] Cliente Twilio inicializado com sucesso
2025-08-13 11:01:59,748 [INFO] [werkzeug:97] [_log] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.20.0.4:8080
2025-08-13 11:01:59,748 [INFO] [werkzeug:97] [_log] [33mPress CTRL+C to quit[0m
2025-08-13 11:01:59,750 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 11:02:00,427 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 11:02:00,482 [INFO] [root:21] [<module>] Cliente Twilio inicializado com sucesso
2025-08-13 11:02:00,510 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 11:02:00,511 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 100-502-274
2025-08-13 12:31:48,042 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/knowledge/knowledge.py', reloading
2025-08-13 12:31:48,230 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 12:31:49,144 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 12:31:49,214 [INFO] [root:21] [<module>] Cliente Twilio inicializado com sucesso
2025-08-13 12:31:49,242 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 12:31:49,244 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 100-502-274
2025-08-13 12:35:07,461 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/knowledge/knowledge.py', reloading
2025-08-13 12:35:07,569 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 12:35:08,740 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 12:35:08,852 [INFO] [root:21] [<module>] Cliente Twilio inicializado com sucesso
2025-08-13 12:35:08,897 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 12:35:08,899 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 100-502-274
2025-08-13 12:39:17,510 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 12:39:17] "POST /webhook HTTP/1.1" 200 -
2025-08-13 12:39:17,513 [INFO] [root:106] [load_session] [SESSION] Nova sess√£o criada: 5511940726493***
2025-08-13 12:39:17,516 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero um abs'
2025-08-13 12:39:17,518 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-13 12:39:17,526 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 5500 caracteres
2025-08-13 12:39:17,527 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5500 caracteres
2025-08-13 12:39:17,544 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-13 12:39:17,546 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-13 12:39:17,551 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f908cc17ee0>
2025-08-13 12:39:17,553 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-13 12:39:17,555 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-13 12:39:17,556 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-13 12:39:17,557 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-13 12:39:17,558 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-13 12:39:20,347 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 13 Aug 2025 12:39:20 GMT'), (b'Content-Length', b'320')])
2025-08-13 12:39:20,348 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-13 12:39:20,349 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-13 12:39:20,350 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-13 12:39:20,351 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-13 12:39:20,351 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-13 12:39:20,352 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.81s
2025-08-13 12:39:20,352 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM:**...
2025-08-13 12:39:20,353 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM:**
2025-08-13 12:39:20,354 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-13 12:39:20,359 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 2 produtos e 43 termos.
2025-08-13 12:39:20,360 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'um abs'
2025-08-13 12:39:20,364 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.8
2025-08-13 12:39:20,364 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'um abs'
2025-08-13 12:39:20,365 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.6
2025-08-13 12:39:20,365 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'um abs'
2025-08-13 12:39:20,366 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.4
2025-08-13 12:39:20,367 [INFO] [root:205] [find_product_in_kb] [KB] Nenhum produto encontrado para: um abs
2025-08-13 12:39:20,391 [INFO] [root:352] [fuzzy_search_products] [FUZZY] Busca fuzzy no banco para: 'um abs'
2025-08-13 12:39:22,365 [INFO] [root:397] [fuzzy_search_products] [FUZZY] Retornando 0 produtos do banco
2025-08-13 12:39:22,382 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 12:39:22,383 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'ü§ñ N√£o encontrei produtos para 'um abs'.

Tente usar termos mais gerais como 'refrigerante', 'sab√£o' ...'
2025-08-13 12:39:23,204 [INFO] [root:57] [send_whatsapp_message] Mensagem enviada com sucesso. SID: SMd11803b31dbde1bd5debeae736301af8
2025-08-13 12:39:23,209 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'quero um abs'
2025-08-13 12:40:17,851 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 12:40:17] "POST /webhook HTTP/1.1" 200 -
2025-08-13 12:40:17,857 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 12:40:17,858 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero abacaxi'
2025-08-13 12:40:17,859 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5500 caracteres
2025-08-13 12:40:17,875 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-13 12:40:17,878 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-13 12:40:17,883 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f908c105130>
2025-08-13 12:40:17,884 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-13 12:40:17,885 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-13 12:40:17,886 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-13 12:40:17,887 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-13 12:40:17,888 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-13 12:40:20,702 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 13 Aug 2025 12:40:20 GMT'), (b'Content-Length', b'332')])
2025-08-13 12:40:20,703 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-13 12:40:20,704 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-13 12:40:20,705 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-13 12:40:20,706 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-13 12:40:20,706 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-13 12:40:20,707 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.83s
2025-08-13 12:40:20,708 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-13 12:40:20,708 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-13 12:40:20,709 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-13 12:40:20,710 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: abacaxi
2025-08-13 12:40:20,741 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 12:40:20,742 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üì¶ *üéØ Encontrei estes produtos relacionados a 'abacaxi'::*

*1.* ABACAXI CALDA MARIZA EM PEDACOS
    ...'
2025-08-13 12:40:20,950 [INFO] [root:57] [send_whatsapp_message] Mensagem enviada com sucesso. SID: SMb1e3bce66a724853ec03fa85a6bb61d6
2025-08-13 12:40:20,951 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'quero abacaxi'
2025-08-13 17:09:06,085 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 17:09:06] "POST /webhook HTTP/1.1" 200 -
2025-08-13 17:09:06,101 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:09:06,105 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'skol beats'
2025-08-13 17:09:06,107 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-13 17:09:06,113 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 5500 caracteres
2025-08-13 17:09:06,115 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5500 caracteres
2025-08-13 17:09:06,140 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-13 17:09:06,149 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-13 17:09:06,153 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f908c109880>
2025-08-13 17:09:06,155 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-13 17:09:06,156 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-13 17:09:06,157 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-13 17:09:06,158 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-13 17:09:06,159 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-13 17:09:08,535 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 13 Aug 2025 17:09:08 GMT'), (b'Content-Length', b'332')])
2025-08-13 17:09:08,537 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-13 17:09:08,538 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-13 17:09:08,539 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-13 17:09:08,540 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-13 17:09:08,540 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-13 17:09:08,541 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.40s
2025-08-13 17:09:08,542 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-13 17:09:08,542 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-13 17:09:08,543 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-13 17:09:08,544 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'skol beats'
2025-08-13 17:09:08,552 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.8
2025-08-13 17:09:08,553 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'skol beats'
2025-08-13 17:09:08,554 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.6
2025-08-13 17:09:08,555 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'skol beats'
2025-08-13 17:09:08,555 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.4
2025-08-13 17:09:08,556 [INFO] [root:205] [find_product_in_kb] [KB] Nenhum produto encontrado para: skol beats
2025-08-13 17:09:08,610 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:09:08,614 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üì¶ *üéØ Encontrei estes produtos relacionados a 'skol beats'::*

*1.* BEB.MISTA SKOL BEATS CAIPIRINHA L...'
2025-08-13 17:09:09,158 [INFO] [root:57] [send_whatsapp_message] Mensagem enviada com sucesso. SID: SMe94b754f3234b355cc7be2f0b8d8eea7
2025-08-13 17:09:09,165 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'skol beats'
2025-08-13 17:09:22,410 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 17:09:22] "POST /webhook HTTP/1.1" 200 -
2025-08-13 17:09:22,413 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:09:22,413 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero vinho'
2025-08-13 17:09:22,414 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5500 caracteres
2025-08-13 17:09:22,429 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-13 17:09:22,430 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-13 17:09:22,433 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f908c121040>
2025-08-13 17:09:22,433 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-13 17:09:22,434 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-13 17:09:22,434 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-13 17:09:22,435 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-13 17:09:22,435 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-13 17:09:23,824 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 13 Aug 2025 17:09:23 GMT'), (b'Content-Length', b'331')])
2025-08-13 17:09:23,825 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-13 17:09:23,826 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-13 17:09:23,827 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-13 17:09:23,827 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-13 17:09:23,828 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-13 17:09:23,829 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.40s
2025-08-13 17:09:23,829 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-13 17:09:23,830 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-13 17:09:23,830 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-13 17:09:23,832 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'vinho'
2025-08-13 17:09:23,833 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.8
2025-08-13 17:09:23,834 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'vinho'
2025-08-13 17:09:23,835 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.6
2025-08-13 17:09:23,835 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'vinho'
2025-08-13 17:09:23,836 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.4
2025-08-13 17:09:23,836 [INFO] [root:205] [find_product_in_kb] [KB] Nenhum produto encontrado para: vinho
2025-08-13 17:09:23,858 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:09:23,858 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üì¶ *üéØ Encontrei estes produtos relacionados a 'vinho'::*

*1.* ACUCAR FAVINHO MASCAVO
    üí∞ R$ 13,98
...'
2025-08-13 17:09:24,230 [INFO] [root:57] [send_whatsapp_message] Mensagem enviada com sucesso. SID: SM7f4732b1187a276f989b1c900ff11c7b
2025-08-13 17:09:24,231 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'quero vinho'
2025-08-13 17:09:38,609 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 17:09:38] "POST /webhook HTTP/1.1" 200 -
2025-08-13 17:09:38,613 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:09:38,639 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:09:38,639 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üì¶ *Mostrando mais produtos relacionados a 'vinho'::*

*6.* BOLSA TERM P/VINHO BEL CZ P/2 GARRAFAS
  ...'
2025-08-13 17:09:38,911 [INFO] [root:57] [send_whatsapp_message] Mensagem enviada com sucesso. SID: SM8de437510f5e8035160aae0c5826eb3c
2025-08-13 17:09:38,914 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'mais'
2025-08-13 17:10:10,460 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 17:10:10] "POST /webhook HTTP/1.1" 200 -
2025-08-13 17:10:10,467 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:10:10,473 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:10:10,474 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'ü§ñ Desculpe, n√£o entendi. Pode reformular?'
2025-08-13 17:10:10,779 [INFO] [root:57] [send_whatsapp_message] Mensagem enviada com sucesso. SID: SMe32e4f1f6de6999ea3e8e4f770e5e86a
2025-08-13 17:10:10,783 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para '7'
2025-08-13 17:10:30,380 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 17:10:30] "POST /webhook HTTP/1.1" 200 -
2025-08-13 17:10:30,383 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:10:30,386 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:10:30,386 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'Quantas unidades de BEB.CHOPP BLACK SKULL VINHO voc√™ deseja adicionar?'
2025-08-13 17:10:30,613 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACad7b82d94a6416ade9b1d19a8194499f exceeded the 9 daily messages limit
2025-08-13 17:10:30,614 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-13 17:10:30,615 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para '3'
2025-08-13 17:10:58,789 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 17:10:58] "POST /webhook HTTP/1.1" 200 -
2025-08-13 17:10:58,795 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:10:58,909 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'vinho'
2025-08-13 17:10:58,922 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:10:58,922 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: '‚úÖ Perfeito! Adicionei 5 BEB.CHOPP BLACK SKULL VINHO ao seu carrinho.

üõí *SEU CARRINHO:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ...'
2025-08-13 17:10:59,283 [INFO] [root:57] [send_whatsapp_message] Mensagem enviada com sucesso. SID: SM609bd8b8b9f0f8a26efadbd0c8a2b050
2025-08-13 17:10:59,284 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para '5'
2025-08-13 17:11:51,698 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 17:11:51] "POST /webhook HTTP/1.1" 200 -
2025-08-13 17:11:51,702 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:11:51,703 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero bala fini'
2025-08-13 17:11:51,704 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5500 caracteres
2025-08-13 17:11:51,724 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-13 17:11:51,727 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-13 17:11:51,731 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f908c118610>
2025-08-13 17:11:51,732 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-13 17:11:51,733 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-13 17:11:51,733 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-13 17:11:51,734 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-13 17:11:51,741 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-13 17:11:52,973 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 13 Aug 2025 17:11:52 GMT'), (b'Content-Length', b'331')])
2025-08-13 17:11:52,974 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-13 17:11:52,975 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-13 17:11:52,976 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-13 17:11:52,977 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-13 17:11:52,977 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-13 17:11:52,978 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.25s
2025-08-13 17:11:52,978 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-13 17:11:52,979 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-13 17:11:52,980 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-13 17:11:53,299 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 2637 produtos e 42848 termos.
2025-08-13 17:11:53,301 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: bala fini
2025-08-13 17:11:53,434 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:11:53,435 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'üì¶ *üéØ Encontrei estes produtos relacionados a 'bala fini'::*

*1.* BALA FINI AMORA
    üí∞ R$ 6,89

*2....'
2025-08-13 17:11:53,598 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACad7b82d94a6416ade9b1d19a8194499f exceeded the 9 daily messages limit
2025-08-13 17:11:53,599 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-13 17:11:53,600 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para 'quero bala fini'
2025-08-13 17:12:04,097 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 17:12:04] "POST /webhook HTTP/1.1" 200 -
2025-08-13 17:12:04,102 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:12:04,104 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 17:12:04,105 [INFO] [root:48] [send_whatsapp_message] Enviando mensagem proativa para 5511940726493***: 'Quantas unidades de BALA FINI BANANAS voc√™ deseja adicionar?'
2025-08-13 17:12:04,270 [ERROR] [root:61] [send_whatsapp_message] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACad7b82d94a6416ade9b1d19a8194499f exceeded the 9 daily messages limit
2025-08-13 17:12:04,272 [ERROR] [root:65] [send_whatsapp_message] Limite de mensagens di√°rio atingido
2025-08-13 17:12:04,273 [INFO] [root:1425] [process_message_async] THREAD: Processamento finalizado para '3'
2025-08-13 19:51:24,984 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 19:51:25,100 [INFO] [root:21] [<module>] Cliente Twilio inicializado com sucesso
2025-08-13 19:51:25,143 [INFO] [werkzeug:97] [_log] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.20.0.4:8080
2025-08-13 19:51:25,145 [INFO] [werkzeug:97] [_log] [33mPress CTRL+C to quit[0m
2025-08-13 19:51:25,147 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 19:51:26,004 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 19:51:26,083 [INFO] [root:21] [<module>] Cliente Twilio inicializado com sucesso
2025-08-13 19:51:26,114 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 19:51:26,115 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 596-827-150
2025-08-13 19:52:39,081 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/communication/twilio_client.py', reloading
2025-08-13 19:52:39,237 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 19:52:40,876 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 19:56:51,855 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:12:35,838 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:14:24,830 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:14:25,031 [INFO] [werkzeug:97] [_log] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.20.0.4:8080
2025-08-13 20:14:25,033 [INFO] [werkzeug:97] [_log] [33mPress CTRL+C to quit[0m
2025-08-13 20:14:25,035 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:14:25,739 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:14:25,912 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:14:25,914 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 124-575-799
2025-08-13 20:22:58,076 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:22:58] "[33mPOST /webhooks/inbound-message HTTP/1.1[0m" 404 -
2025-08-13 20:23:15,390 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:23:15] "[33mPOST /webhooks/inbound-message HTTP/1.1[0m" 404 -
2025-08-13 20:25:11,542 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:25:11] "[33mPOST /webhooks/inbound-messagesss HTTP/1.1[0m" 404 -
2025-08-13 20:28:33,544 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 20:28:33,641 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:28:34,549 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:28:34,720 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:28:34,721 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 124-575-799
2025-08-13 20:28:41,430 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:28:41] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:28:47,006 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:28:47] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:28:57,587 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:28:57] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:29:18,123 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:29:18] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:29:31,373 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 20:29:31,418 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:29:32,136 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:29:32,300 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:29:32,301 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 124-575-799
2025-08-13 20:29:39,869 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:29:39] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:29:45,500 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:29:45] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:29:55,513 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 20:29:55,562 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:29:56,539 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:29:56,795 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:29:56,798 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 124-575-799
2025-08-13 20:29:56,944 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:29:56] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:29:58,668 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:29:58] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:30:17,575 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:30:17] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:30:58,172 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:30:58] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:31:19,260 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:31:19] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:32:37,389 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:32:37,607 [INFO] [werkzeug:97] [_log] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.20.0.4:8080
2025-08-13 20:32:37,608 [INFO] [werkzeug:97] [_log] [33mPress CTRL+C to quit[0m
2025-08-13 20:32:37,609 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:32:38,302 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:32:38,472 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:32:38,473 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:32:56,416 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:32:56] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:33:01,990 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:33:01] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:33:12,576 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:33:12] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:33:33,134 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:33:33] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 20:33:52,451 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 20:33:52,503 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:33:53,331 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:33:53,509 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:33:53,510 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:33:58,719 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 20:33:58,721 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:33:58] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 20:33:59,798 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 20:33:59,799 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:33:59] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 20:34:13,669 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 20:34:13,671 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:34:13] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 20:34:42,806 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 20:34:42,861 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:34:43,665 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:34:43,893 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:34:43,894 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:35:12,786 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 20:35:12,833 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:35:13,550 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:35:13,713 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:35:13,717 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:37:53,550 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 20:37:53,598 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:37:54,321 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:37:54,476 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:37:54,478 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:38:18,749 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 20:38:18,753 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:38:18] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 20:38:18,759 [INFO] [root:106] [load_session] [SESSION] Nova sess√£o criada: 
2025-08-13 20:38:18,782 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_.json
2025-08-13 20:38:18,786 [ERROR] [root:1429] [process_message_async] ERRO CR√çTICO NA THREAD: name 'vonage_client' is not defined
Traceback (most recent call last):
  File "/app/app.py", line 1424, in process_message_async
    _finalize_session(sender_phone, session, state, response_text)
  File "/app/app.py", line 1381, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
NameError: name 'vonage_client' is not defined
2025-08-13 20:39:04,360 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 20:39:04,424 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:39:05,142 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:39:05,701 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:39:05,702 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:39:11,319 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 20:39:11,321 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:39:11] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 20:39:11,323 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_.json
2025-08-13 20:39:11,325 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_.json
2025-08-13 20:39:12,657 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para ''
2025-08-13 20:39:35,889 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 20:39:35,891 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:39:35] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 20:39:35,893 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_.json
2025-08-13 20:39:35,900 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_.json
2025-08-13 20:39:37,165 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para ''
2025-08-13 20:39:48,261 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 20:39:48,263 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:39:48] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 20:39:48,270 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_.json
2025-08-13 20:39:48,273 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_.json
2025-08-13 20:39:49,131 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para ''
2025-08-13 20:40:59,268 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/communication/vonage_client.py', reloading
2025-08-13 20:40:59,373 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:41:00,136 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:41:00,605 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:41:00,606 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:41:12,520 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/communication/vonage_client.py', reloading
2025-08-13 20:41:12,596 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:41:13,377 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:41:13,651 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:41:13,653 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:42:28,640 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 20:42:28,641 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 20:42:28] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 20:42:28,650 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_.json
2025-08-13 20:42:28,655 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_.json
2025-08-13 20:42:29,684 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para ''
2025-08-13 20:42:50,701 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/communication/vonage_client.py', reloading
2025-08-13 20:42:50,752 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:42:51,443 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:42:51,639 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:42:51,639 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:43:23,322 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/communication/vonage_client.py', reloading
2025-08-13 20:43:23,372 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:43:24,122 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:43:24,332 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:43:24,333 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:44:23,086 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 20:44:23,155 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:44:24,018 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:44:24,548 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:44:24,549 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:44:39,733 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 20:44:39,784 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:44:40,539 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:44:40,768 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:44:40,769 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 20:44:46,301 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 20:44:46,366 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 20:44:47,125 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 20:44:47,346 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 20:44:47,350 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 138-616-985
2025-08-13 23:28:07,062 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 23:28:07,491 [INFO] [werkzeug:97] [_log] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.20.0.4:8080
2025-08-13 23:28:07,492 [INFO] [werkzeug:97] [_log] [33mPress CTRL+C to quit[0m
2025-08-13 23:28:07,495 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 23:28:08,898 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 23:28:09,433 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 23:28:09,434 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 383-676-750
2025-08-13 23:28:36,125 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:28:36] "POST /webhook HTTP/1.1" 200 -
2025-08-13 23:28:36,133 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 23:28:36,548 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'bala fini'
2025-08-13 23:28:36,555 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 23:28:37,338 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para 'rubbed-nine'
2025-08-13 23:29:19,086 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:29:19] "POST /webhook HTTP/1.1" 200 -
2025-08-13 23:29:19,103 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 23:29:19,124 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 23:29:19,770 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-13 23:29:24,977 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:29:24] "POST /webhook HTTP/1.1" 200 -
2025-08-13 23:29:24,993 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 23:29:25,025 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 23:29:25,718 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-13 23:30:09,389 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:30:09] "POST /webhook HTTP/1.1" 200 -
2025-08-13 23:30:09,401 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 23:30:09,405 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'produtos'
2025-08-13 23:30:09,410 [INFO] [root:471] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-13 23:30:09,716 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 2637 produtos e 42848 termos.
2025-08-13 23:30:09,720 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 's'
2025-08-13 23:30:09,723 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.8
2025-08-13 23:30:09,724 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 's'
2025-08-13 23:30:09,727 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.6
2025-08-13 23:30:09,729 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 's'
2025-08-13 23:30:09,732 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.4
2025-08-13 23:30:09,883 [INFO] [root:202] [find_product_in_kb] [KB] Busca por conten√ß√£o encontrou 2305 produtos para: s
2025-08-13 23:30:16,767 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 23:30:17,431 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para 'produtos'
2025-08-13 23:30:36,170 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:30:36] "POST /webhook HTTP/1.1" 200 -
2025-08-13 23:30:36,187 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 23:30:36,200 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'cerveja'
2025-08-13 23:30:36,203 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-13 23:30:36,215 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 5500 caracteres
2025-08-13 23:30:36,218 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5500 caracteres
2025-08-13 23:30:36,225 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-13 23:30:36,228 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-13 23:30:36,237 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fe05c26b190>
2025-08-13 23:30:36,240 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-13 23:30:36,246 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-13 23:30:36,249 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-13 23:30:36,256 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-13 23:30:36,261 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-13 23:30:43,589 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 13 Aug 2025 23:30:43 GMT'), (b'Content-Length', b'334')])
2025-08-13 23:30:43,605 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-13 23:30:43,606 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-13 23:30:43,619 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-13 23:30:43,621 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-13 23:30:43,622 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-13 23:30:43,624 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 7.40s
2025-08-13 23:30:43,630 [WARNING] [root:598] [get_intent] [llm_interface.py] LLM demorou 7.40s (timeout: 5s)
2025-08-13 23:30:43,643 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-13 23:30:43,646 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-13 23:30:43,667 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-13 23:30:43,686 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja
2025-08-13 23:30:43,784 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_whatsapp_+5511940726493.json
2025-08-13 23:30:44,554 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para 'cerveja'
2025-08-13 23:31:10,350 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 23:31:10,356 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:31:10] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 23:31:10,364 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_.json
2025-08-13 23:31:10,370 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_.json
2025-08-13 23:31:11,000 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para ''
2025-08-13 23:36:41,281 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 23:36:41,346 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 23:36:42,238 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 23:36:42,620 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 23:36:42,623 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 383-676-750
2025-08-13 23:37:07,511 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 23:37:07,512 [INFO] [root:1463] [inbound_message] Received message from : 
2025-08-13 23:37:07,514 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:37:07] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 23:37:07,517 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_.json
2025-08-13 23:37:07,519 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_.json
2025-08-13 23:37:08,279 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para ''
2025-08-13 23:44:54,625 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 23:44:54,683 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 23:44:55,532 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 23:44:55,758 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 23:44:55,760 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 383-676-750
2025-08-13 23:45:03,203 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 23:45:03,203 [INFO] [root:1460] [inbound_message] Requisicao: <Request 'http://81043ec79192.ngrok-free.app/webhooks/inbound-message' [POST]>
2025-08-13 23:45:03,205 [INFO] [root:1463] [inbound_message] Received message from : 
2025-08-13 23:45:03,206 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:45:03] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 23:45:03,209 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_.json
2025-08-13 23:45:03,213 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_.json
2025-08-13 23:45:03,885 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para ''
2025-08-13 23:46:28,407 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 23:46:28,460 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 23:46:29,274 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 23:46:29,509 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 23:46:29,511 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 383-676-750
2025-08-13 23:46:32,492 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 23:46:32,493 [INFO] [root:1460] [inbound_message] Requisicao: {'to': '14157386102', 'from': '5511940726493', 'channel': 'whatsapp', 'message_uuid': '98894119-6663-4d5d-8d80-e809be1d3413', 'timestamp': '2025-08-13T23:46:31Z', 'message_type': 'text', 'text': 'oi', 'context_status': 'none', 'profile': {'name': '~ Jonathan'}}
2025-08-13 23:46:32,494 [INFO] [root:1463] [inbound_message] Received message from : 
2025-08-13 23:46:32,496 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:46:32] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 23:46:32,499 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_.json
2025-08-13 23:46:32,503 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_.json
2025-08-13 23:46:33,131 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para ''
2025-08-13 23:50:49,443 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 23:50:49,488 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 23:50:50,732 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 23:50:50,942 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 23:50:50,943 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 383-676-750
2025-08-13 23:51:23,018 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 23:51:23,159 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:51:23] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 23:51:28,661 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 23:51:28,664 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:51:28] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 23:51:39,185 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 23:51:39,189 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:51:39] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 23:51:59,659 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 23:51:59,663 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:51:59] "[35m[1mPOST /webhooks/inbound-message HTTP/1.1[0m" 500 -
2025-08-13 23:52:12,623 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-13 23:52:12,691 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-13 23:52:13,532 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-13 23:52:13,768 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-13 23:52:13,769 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 383-676-750
2025-08-13 23:52:19,106 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 23:52:19,114 [INFO] [root:1465] [inbound_message] Received message from 5511940726493: Cerveja
2025-08-13 23:52:19,121 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:52:19] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 23:52:19,127 [INFO] [root:106] [load_session] [SESSION] Nova sess√£o criada: 5511940726493
2025-08-13 23:52:19,131 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Cerveja'
2025-08-13 23:52:19,135 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-13 23:52:19,140 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 5500 caracteres
2025-08-13 23:52:19,142 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5500 caracteres
2025-08-13 23:52:19,147 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-13 23:52:19,149 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-13 23:52:19,152 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f7539c56310>
2025-08-13 23:52:19,153 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-13 23:52:19,155 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-13 23:52:19,156 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-13 23:52:19,157 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-13 23:52:19,158 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-13 23:52:21,331 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 13 Aug 2025 23:52:21 GMT'), (b'Content-Length', b'320')])
2025-08-13 23:52:21,333 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-13 23:52:21,335 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-13 23:52:21,336 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-13 23:52:21,337 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-13 23:52:21,337 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-13 23:52:21,338 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.19s
2025-08-13 23:52:21,339 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM:**...
2025-08-13 23:52:21,339 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM:**
2025-08-13 23:52:21,340 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-13 23:52:21,662 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 2637 produtos e 42848 termos.
2025-08-13 23:52:21,666 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja
2025-08-13 23:52:21,731 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-13 23:52:22,394 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para 'Cerveja'
2025-08-13 23:52:40,340 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-13 23:52:40,342 [INFO] [root:1465] [inbound_message] Received message from 5511940726493: cerveja
2025-08-13 23:52:40,343 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [13/Aug/2025 23:52:40] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-13 23:52:40,345 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-13 23:52:40,346 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'cerveja'
2025-08-13 23:52:40,347 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5500 caracteres
2025-08-13 23:52:40,351 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-13 23:52:40,353 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-13 23:52:40,355 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f753a7ec220>
2025-08-13 23:52:40,356 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-13 23:52:40,356 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-13 23:52:40,357 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-13 23:52:40,358 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-13 23:52:40,358 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-13 23:52:46,131 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 13 Aug 2025 23:52:46 GMT'), (b'Content-Length', b'332')])
2025-08-13 23:52:46,132 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-13 23:52:46,139 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-13 23:52:46,140 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-13 23:52:46,141 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-13 23:52:46,141 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-13 23:52:46,142 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 5.79s
2025-08-13 23:52:46,143 [WARNING] [root:598] [get_intent] [llm_interface.py] LLM demorou 5.79s (timeout: 5s)
2025-08-13 23:52:46,144 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-13 23:52:46,145 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-13 23:52:46,146 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-13 23:52:46,147 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja
2025-08-13 23:52:46,205 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-13 23:52:46,862 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para 'cerveja'
2025-08-14 00:01:03,793 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 00:01:03,794 [INFO] [root:1465] [inbound_message] Received message from 5511940726493: Oi
2025-08-14 00:01:03,796 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 00:01:03] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 00:01:03,799 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 00:01:03,803 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 00:01:04,624 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-14 00:01:12,956 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 00:01:12,957 [INFO] [root:1465] [inbound_message] Received message from 5511940726493: Ol√°
2025-08-14 00:01:12,959 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 00:01:12] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 00:01:12,962 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 00:01:12,965 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 00:01:13,620 [INFO] [root:1426] [process_message_async] THREAD: Processamento finalizado para 'Ol√°'
2025-08-14 16:44:17,904 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 16:44:17,906 [INFO] [root:1722] [inbound_message] Received message from 5511940726493: quero cerveja skol
2025-08-14 16:44:17,909 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 16:44:17] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 16:44:17,914 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 16:44:17,916 [INFO] [root:465] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero cerveja skol'
2025-08-14 16:44:17,917 [INFO] [root:188] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 16:44:17,920 [INFO] [root:193] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 5651 caracteres
2025-08-14 16:44:17,925 [INFO] [root:511] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5651 caracteres
2025-08-14 16:44:17,931 [INFO] [root:590] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 16:44:17,934 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 16:44:17,942 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f0881667910>
2025-08-14 16:44:17,945 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 16:44:17,946 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 16:44:17,947 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 16:44:17,949 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 16:44:17,949 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 16:44:25,186 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 16:44:25 GMT'), (b'Content-Length', b'396')])
2025-08-14 16:44:25,187 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 16:44:25,188 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 16:44:25,189 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 16:44:25,189 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 16:44:25,190 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 16:44:25,190 [INFO] [root:610] [get_intent] [llm_interface.py] Resposta recebida do LLM em 7.26s
2025-08-14 16:44:25,191 [WARNING] [root:616] [get_intent] [llm_interface.py] LLM demorou 7.26s (timeout: 5s)
2025-08-14 16:44:25,191 [INFO] [root:622] [get_intent] [llm_interface.py] Resposta do LLM: {"tool_name": "get_top_selling_products_by_name", "parameters": {"product_name": "skol"}}...
2025-08-14 16:44:25,192 [DEBUG] [root:625] [get_intent] [llm_interface.py] Conte√∫do limpo: {"tool_name": "get_top_selling_products_by_name", "parameters": {"product_name": "skol"}}
2025-08-14 16:44:25,192 [INFO] [root:658] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'get_top_selling_products_by_name', 'parameters': {'product_name': 'skol'}}
2025-08-14 16:44:25,193 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: skol
2025-08-14 16:44:25,263 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 16:44:25,854 [WARNING] [root:1622] [_send_response_safely] Erro ao enviar mensagem (mas estado foi salvo): 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 16:44:25,856 [INFO] [root:1679] [process_message_async] THREAD: Processamento finalizado para 'quero cerveja skol'
2025-08-14 16:44:47,933 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 16:44:48,077 [INFO] [root:1722] [inbound_message] Received message from 5511940726493: Oi
2025-08-14 16:44:48,080 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 16:44:48] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 16:44:48,084 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 16:44:48,093 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 16:44:48,098 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f0881609d30>
2025-08-14 16:44:48,099 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 16:44:48,100 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 16:44:48,100 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 16:44:48,101 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 16:44:48,103 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 16:44:49,416 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 16:44:49 GMT'), (b'Content-Length', b'425')])
2025-08-14 16:44:49,417 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 16:44:49,419 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 16:44:49,420 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 16:44:49,421 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 16:44:49,421 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 16:44:49,422 [INFO] [root:1083] [generate_personalized_response] IA gerou resposta personalizada para contexto 'greeting': Bem-vindo ao Comercial Esperan√ßa! Eu sou o G.A.V., aqui para ajudar voc√™ em tudo de que precisar! Como posso te atender hoje? üòä...
2025-08-14 16:44:49,433 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 16:44:50,110 [WARNING] [root:1622] [_send_response_safely] Erro ao enviar mensagem (mas estado foi salvo): 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 16:44:50,112 [INFO] [root:1679] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-14 16:45:07,927 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 16:45:07,928 [INFO] [root:1722] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 16:45:07,930 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 16:45:07] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 16:45:07,933 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 16:45:07,940 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 16:45:08,584 [WARNING] [root:1622] [_send_response_safely] Erro ao enviar mensagem (mas estado foi salvo): 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 16:45:08,587 [INFO] [root:1679] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 16:45:26,915 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 16:45:26,917 [INFO] [root:1722] [inbound_message] Received message from 5511940726493: adiciona o 1
2025-08-14 16:45:26,919 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 16:45:26] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 16:45:26,925 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 16:45:26,926 [INFO] [root:465] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'adiciona o 1'
2025-08-14 16:45:26,927 [INFO] [root:511] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5651 caracteres
2025-08-14 16:45:26,932 [INFO] [root:590] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 16:45:26,934 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 16:45:26,937 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f08816a2490>
2025-08-14 16:45:26,938 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 16:45:26,940 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 16:45:26,941 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 16:45:26,942 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 16:45:26,943 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 16:45:28,626 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 16:45:28 GMT'), (b'Content-Length', b'294')])
2025-08-14 16:45:28,627 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 16:45:28,628 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 16:45:28,628 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 16:45:28,629 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 16:45:28,629 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 16:45:28,630 [INFO] [root:610] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.70s
2025-08-14 16:45:28,631 [INFO] [root:622] [get_intent] [llm_interface.py] Resposta do LLM: ...
2025-08-14 16:45:28,631 [DEBUG] [root:625] [get_intent] [llm_interface.py] Conte√∫do limpo: 
2025-08-14 16:45:28,632 [ERROR] [root:662] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 16:45:28,633 [ERROR] [root:663] [get_intent] [llm_interface.py] Conte√∫do original recebido: '...'
2025-08-14 16:45:28,634 [ERROR] [root:664] [get_intent] [llm_interface.py] Conte√∫do limpo que falhou: ''
2025-08-14 16:45:28,636 [INFO] [root:669] [get_intent] [llm_interface.py] Intent extra√≠do do texto natural: {'tool_name': 'add_item_to_cart', 'parameters': {'index': 1, 'qt': 1.0}}
2025-08-14 16:45:28,639 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 16:45:29,325 [WARNING] [root:1622] [_send_response_safely] Erro ao enviar mensagem (mas estado foi salvo): 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 16:45:29,327 [INFO] [root:1679] [process_message_async] THREAD: Processamento finalizado para 'adiciona o 1'
2025-08-14 16:56:14,920 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 16:56:15,082 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 16:56:16,011 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 16:56:16,248 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 16:56:16,249 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:00:20,316 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:00:20,382 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:00:21,238 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:00:21,520 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:00:21,522 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:00:28,999 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:00:29,000 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: Oi
2025-08-14 17:00:29,002 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:00:29] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:00:29,029 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:00:29,064 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:00:31,039 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:00:31,050 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-14 17:01:00,545 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:01:00,546 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: Quero cerveja skol
2025-08-14 17:01:00,548 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:01:00] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:01:00,552 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:01:00,552 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Quero cerveja skol'
2025-08-14 17:01:00,557 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 17:01:00,561 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 5651 caracteres
2025-08-14 17:01:00,563 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5651 caracteres
2025-08-14 17:01:00,568 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:01:00,569 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:01:00,576 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1a0a7cd5b0>
2025-08-14 17:01:00,577 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:01:00,579 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:01:00,580 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:01:00,581 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:01:00,582 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:01:04,634 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:01:04 GMT'), (b'Content-Length', b'334')])
2025-08-14 17:01:04,635 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:01:04,637 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:01:04,637 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:01:04,638 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:01:04,638 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:01:04,639 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.07s
2025-08-14 17:01:04,639 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 17:01:04,640 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 17:01:04,641 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:01:06,378 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15969 produtos e 254977 termos.
2025-08-14 17:01:06,383 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja skol
2025-08-14 17:01:06,409 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:01:07,093 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:01:07,096 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'Quero cerveja skol'
2025-08-14 17:01:22,475 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:01:22,476 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 17:01:22,478 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:01:22] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:01:22,480 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:01:22,482 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:01:23,165 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:01:23,169 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 17:01:33,258 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:01:33,262 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: adicione o produto 3
2025-08-14 17:01:33,265 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:01:33] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:01:33,278 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:01:33,285 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'adicione o produto 3'
2025-08-14 17:01:33,287 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5651 caracteres
2025-08-14 17:01:33,296 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:01:33,299 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:01:33,304 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1a0a8a24c0>
2025-08-14 17:01:33,306 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:01:33,307 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:01:33,309 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:01:33,310 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:01:33,311 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:01:34,868 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:01:34 GMT'), (b'Content-Length', b'396')])
2025-08-14 17:01:34,869 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:01:34,871 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:01:34,876 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:01:34,879 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:01:34,879 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:01:34,881 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.58s
2025-08-14 17:01:34,883 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: Com base no contexto fornecido, posso inferir que o usu√°rio deseja adicionar o produto 3 ao carrinho...
2025-08-14 17:01:34,884 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: Com base no contexto fornecido, posso inferir que o usu√°rio deseja adicionar o produto 3 ao carrinho.
2025-08-14 17:01:34,885 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:01:34,887 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'adicione o  3'
2025-08-14 17:02:06,287 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.8
2025-08-14 17:02:06,289 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'adicione o  3'
2025-08-14 17:02:06,696 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.6
2025-08-14 17:02:06,697 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'adicione o  3'
2025-08-14 17:02:07,091 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 20 produtos com similaridade >= 0.4
2025-08-14 17:02:07,092 [INFO] [root:175] [find_product_in_kb] [KB] Busca fuzzy (baixa) encontrou 20 produtos para: adicione o  3
2025-08-14 17:02:07,185 [INFO] [root:352] [fuzzy_search_products] [FUZZY] Busca fuzzy no banco para: 'adicione o  3'
2025-08-14 17:02:09,907 [INFO] [root:397] [fuzzy_search_products] [FUZZY] Retornando 0 produtos do banco
2025-08-14 17:02:09,940 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:02:10,659 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:02:10,662 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'adicione o produto 3'
2025-08-14 17:03:39,244 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/db/database.py', reloading
2025-08-14 17:03:39,410 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:03:40,286 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:03:40,525 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:03:40,527 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:03:52,043 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:03:52,119 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:03:53,047 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:03:53,356 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:03:53,357 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:04:01,225 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/db/database.py', reloading
2025-08-14 17:04:01,288 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:04:02,228 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:04:02,582 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:04:02,585 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:04:35,218 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/utils/fuzzy_search.py', reloading
2025-08-14 17:04:35,268 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:04:36,013 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:04:36,216 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:04:36,217 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:04:50,246 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:04:50,300 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:04:51,128 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:04:51,359 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:04:51,360 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:05:07,832 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:05:07,901 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:05:08,798 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:05:09,061 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:05:09,063 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:05:22,444 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/db/database.py', reloading
2025-08-14 17:05:22,521 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:05:23,325 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:05:23,580 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:05:23,581 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:05:56,841 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:05:56,842 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: quero cerveja heineken
2025-08-14 17:05:56,844 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:05:56] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:05:56,848 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:05:56,849 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero cerveja heineken'
2025-08-14 17:05:56,851 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 17:05:56,858 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 5651 caracteres
2025-08-14 17:05:56,859 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5651 caracteres
2025-08-14 17:05:56,865 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:05:56,866 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:05:56,875 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7efd60d2ed60>
2025-08-14 17:05:56,876 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:05:56,877 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:05:56,877 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:05:56,878 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:05:56,879 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:05:58,820 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:05:58 GMT'), (b'Content-Length', b'437')])
2025-08-14 17:05:58,821 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:05:58,822 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:05:58,823 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:05:58,823 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:05:58,824 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:05:58,824 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.96s
2025-08-14 17:05:58,825 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: Baseado no contexto fornecido, podemos analisar a mensagem do usu√°rio "quero cerveja heineken" e seg...
2025-08-14 17:05:58,826 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: Baseado no contexto fornecido, podemos analisar a mensagem do usu√°rio "quero cerveja heineken" e seguir as instru√ß√µes de alta prioridade.
2025-08-14 17:05:58,826 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:06:00,559 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15969 produtos e 254977 termos.
2025-08-14 17:06:00,565 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja heineken
2025-08-14 17:06:00,603 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:06:01,445 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:06:01,451 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'quero cerveja heineken'
2025-08-14 17:06:11,475 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:06:11,479 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: quero cerveja
2025-08-14 17:06:11,482 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:06:11] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:06:11,498 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:06:11,506 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero cerveja'
2025-08-14 17:06:11,507 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5651 caracteres
2025-08-14 17:06:11,517 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:06:11,519 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:06:11,527 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7efd60d2ec40>
2025-08-14 17:06:11,528 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:06:11,530 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:06:11,531 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:06:11,531 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:06:11,532 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:06:12,953 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:06:12 GMT'), (b'Content-Length', b'331')])
2025-08-14 17:06:12,954 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:06:12,957 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:06:12,958 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:06:12,958 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:06:12,959 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:06:12,962 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.44s
2025-08-14 17:06:12,963 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 17:06:12,963 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 17:06:12,964 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:06:12,967 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja
2025-08-14 17:06:13,541 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:06:14,371 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:06:14,381 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'quero cerveja'
2025-08-14 17:07:57,964 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/core/session_manager.py', reloading
2025-08-14 17:07:58,099 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:07:58,851 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:07:59,067 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:07:59,068 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:09:44,375 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:09:44,380 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: quero heineken
2025-08-14 17:09:44,385 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:09:44] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:09:44,401 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:09:44,408 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero heineken'
2025-08-14 17:09:44,410 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 17:09:44,423 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 5651 caracteres
2025-08-14 17:09:44,428 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5651 caracteres
2025-08-14 17:09:44,434 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:09:44,436 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:09:44,445 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fb980f95a90>
2025-08-14 17:09:44,448 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:09:44,449 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:09:44,453 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:09:44,454 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:09:44,456 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:09:46,343 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:09:46 GMT'), (b'Content-Length', b'427')])
2025-08-14 17:09:46,349 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:09:46,350 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:09:46,351 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:09:46,351 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:09:46,353 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:09:46,356 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.92s
2025-08-14 17:09:46,356 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: Analisando a mensagem do usu√°rio "quero heineken", podemos inferir que ele est√° procurando por uma c...
2025-08-14 17:09:46,358 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: Analisando a mensagem do usu√°rio "quero heineken", podemos inferir que ele est√° procurando por uma cerveja espec√≠fica, Heineken.
2025-08-14 17:09:46,359 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:09:48,184 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15969 produtos e 254977 termos.
2025-08-14 17:09:48,192 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: heineken
2025-08-14 17:09:48,256 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:09:48,973 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:09:48,982 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'quero heineken'
2025-08-14 17:10:21,802 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:10:21,807 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: 5
2025-08-14 17:10:21,813 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:10:21] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:10:21,819 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:10:21,825 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:10:22,495 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:10:22,498 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para '5'
2025-08-14 17:10:37,842 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:10:37,844 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: cerveja
2025-08-14 17:10:37,845 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:10:37] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:10:37,848 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:10:37,849 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'cerveja'
2025-08-14 17:10:37,849 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 5651 caracteres
2025-08-14 17:10:37,854 [INFO] [root:573] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:10:37,857 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:10:37,867 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fb980efe5e0>
2025-08-14 17:10:37,868 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:10:37,871 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:10:37,872 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:10:37,873 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:10:37,875 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:10:39,654 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:10:39 GMT'), (b'Content-Length', b'442')])
2025-08-14 17:10:39,654 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:10:39,655 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:10:39,656 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:10:39,657 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:10:39,657 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:10:39,658 [INFO] [root:592] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.80s
2025-08-14 17:10:39,658 [INFO] [root:604] [get_intent] [llm_interface.py] Resposta do LLM: Analisando a mensagem do usu√°rio "cerveja" no contexto da conversa, podemos inferir que o usu√°rio es...
2025-08-14 17:10:39,659 [DEBUG] [root:607] [get_intent] [llm_interface.py] Conte√∫do limpo: Analisando a mensagem do usu√°rio "cerveja" no contexto da conversa, podemos inferir que o usu√°rio est√° procurando por uma cerveja espec√≠fica.
2025-08-14 17:10:39,659 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:10:39,660 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja
2025-08-14 17:10:40,252 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:10:41,007 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:10:41,010 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'cerveja'
2025-08-14 17:10:45,792 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:10:45,793 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: 7
2025-08-14 17:10:45,795 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:10:45] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:10:45,798 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:10:45,800 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:10:46,617 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:10:46,622 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para '7'
2025-08-14 17:12:26,822 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/core/session_manager.py', reloading
2025-08-14 17:12:26,969 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:12:27,702 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:12:27,913 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:12:27,914 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:13:18,373 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 17:13:18,451 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:13:19,281 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:13:19,563 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:13:19,564 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:14:00,129 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/core/session_manager.py', reloading
2025-08-14 17:14:00,188 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:14:00,925 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:14:01,138 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:14:01,139 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:14:27,933 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:14:27,935 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: quero cerveja
2025-08-14 17:14:27,938 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:14:27] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:14:27,942 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:14:27,944 [INFO] [root:436] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero cerveja'
2025-08-14 17:14:27,946 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 17:14:27,951 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 6017 caracteres
2025-08-14 17:14:27,952 [INFO] [root:482] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 6017 caracteres
2025-08-14 17:14:27,958 [INFO] [root:580] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:14:27,961 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:14:27,966 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f8e155b0e20>
2025-08-14 17:14:27,968 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:14:27,969 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:14:27,971 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:14:27,972 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:14:27,973 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:14:30,785 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:14:30 GMT'), (b'Content-Length', b'332')])
2025-08-14 17:14:30,788 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:14:30,789 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:14:30,790 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:14:30,791 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:14:30,791 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:14:30,793 [INFO] [root:599] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.83s
2025-08-14 17:14:30,797 [INFO] [root:611] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 17:14:30,799 [DEBUG] [root:614] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 17:14:30,800 [ERROR] [root:651] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:14:32,533 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15969 produtos e 254977 termos.
2025-08-14 17:14:32,538 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja
2025-08-14 17:14:33,152 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:14:34,093 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:14:34,148 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'quero cerveja'
2025-08-14 17:14:38,809 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:14:38,810 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: 7
2025-08-14 17:14:38,812 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:14:38] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:14:38,816 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:14:38,822 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:14:39,519 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:14:39,524 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para '7'
2025-08-14 17:19:11,030 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 17:19:11,174 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:19:12,251 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:19:12,516 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:19:12,517 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:19:54,215 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/core/session_manager.py', reloading
2025-08-14 17:19:54,280 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:19:55,098 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:19:55,328 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:19:55,329 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:20:21,889 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:20:21,972 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:20:22,882 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:20:23,195 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:20:23,197 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:20:46,931 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:20:46,933 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: quero cerveja
2025-08-14 17:20:46,935 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:20:46] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:20:46,941 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:20:46,943 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero cerveja'
2025-08-14 17:20:46,946 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 17:20:46,949 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 6017 caracteres
2025-08-14 17:20:46,950 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 6017 caracteres
2025-08-14 17:20:46,955 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:20:46,957 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:20:46,962 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7ff6f4f15a90>
2025-08-14 17:20:46,963 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:20:46,964 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:20:46,965 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:20:46,966 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:20:46,967 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:20:51,716 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:20:51 GMT'), (b'Content-Length', b'334')])
2025-08-14 17:20:51,717 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:20:51,719 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:20:51,720 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:20:51,720 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:20:51,721 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:20:51,721 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.76s
2025-08-14 17:20:51,723 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 17:20:51,724 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 17:20:51,724 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:20:53,445 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15969 produtos e 254977 termos.
2025-08-14 17:20:53,450 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja
2025-08-14 17:20:54,017 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:20:55,026 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:20:55,033 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'quero cerveja'
2025-08-14 17:21:00,258 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:21:00,260 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: 8
2025-08-14 17:21:00,261 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:21:00] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:21:00,266 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:21:00,279 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:21:01,012 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:21:01,014 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para '8'
2025-08-14 17:21:06,844 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:21:06,845 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: 15
2025-08-14 17:21:06,847 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:21:06] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:21:06,850 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:21:07,394 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'cerveja'
2025-08-14 17:21:07,418 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:21:08,326 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:21:08,331 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para '15'
2025-08-14 17:21:29,632 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:21:29,638 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: limpar carrinho
2025-08-14 17:21:29,642 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:21:29] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:21:29,664 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:21:29,672 [INFO] [root:390] [detect_user_intent_type] [INTENT] Comando de limpeza detectado: 'limpar carrinho'
2025-08-14 17:21:29,700 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:21:30,435 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:21:30,462 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'limpar carrinho'
2025-08-14 17:21:43,560 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:21:43,561 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: quero detergente
2025-08-14 17:21:43,563 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:21:43] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:21:43,566 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:21:43,567 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero detergente'
2025-08-14 17:21:43,568 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 6017 caracteres
2025-08-14 17:21:43,573 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:21:43,574 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:21:43,577 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7ff6f4e97df0>
2025-08-14 17:21:43,578 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:21:43,578 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:21:43,579 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:21:43,579 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:21:43,580 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:21:45,259 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:21:45 GMT'), (b'Content-Length', b'331')])
2025-08-14 17:21:45,264 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:21:45,266 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:21:45,268 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:21:45,268 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:21:45,270 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:21:45,271 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.70s
2025-08-14 17:21:45,272 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 17:21:45,273 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 17:21:45,274 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:21:47,037 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15969 produtos e 254977 termos.
2025-08-14 17:21:47,042 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: detergente
2025-08-14 17:21:47,079 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:21:47,747 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:21:47,752 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'quero detergente'
2025-08-14 17:21:56,605 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:21:56,607 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: 1
2025-08-14 17:21:56,609 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:21:56] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:21:56,612 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:21:56,615 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:21:57,688 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:21:57,694 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para '1'
2025-08-14 17:22:05,025 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:22:05,027 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: 3
2025-08-14 17:22:05,029 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:22:05] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:22:05,032 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:22:05,578 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'detergente'
2025-08-14 17:22:05,630 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:22:06,817 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:22:06,826 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para '3'
2025-08-14 17:24:14,468 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:24:14,471 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: finalizar carrinho
2025-08-14 17:24:14,474 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:24:14] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:24:14,478 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:24:14,480 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:24:15,582 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:24:15,589 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para 'finalizar carrinho'
2025-08-14 17:24:25,530 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:24:25,533 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: 3
2025-08-14 17:24:25,535 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:24:25] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:24:25,546 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:24:25,558 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:24:26,472 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:24:26,487 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para '3'
2025-08-14 17:24:45,929 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:24:45,931 [INFO] [root:1491] [inbound_message] Received message from 5511940726493: 12.345.678/0001-95
2025-08-14 17:24:45,933 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:24:45] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:24:45,937 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:24:45,939 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '12.345.678/0001-95'
2025-08-14 17:24:45,941 [INFO] [root:447] [get_intent] [llm_interface.py] CNPJ detectado em contexto de checkout
2025-08-14 17:24:45,950 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:24:46,983 [ERROR] [root:1399] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1395, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:24:46,986 [INFO] [root:1444] [process_message_async] THREAD: Processamento finalizado para '12.345.678/0001-95'
2025-08-14 17:27:21,123 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:27:21,187 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:27:22,114 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:27:22,376 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:27:22,380 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:28:12,600 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:28:12,680 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:28:13,522 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:28:13,717 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:28:13,718 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:28:53,630 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:28:53,631 [INFO] [root:1495] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 17:28:53,633 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:28:53] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:28:53,636 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:28:53,639 [ERROR] [root:1451] [process_message_async] ERRO CR√çTICO NA THREAD: name 'last_shown_products' is not defined
Traceback (most recent call last):
  File "/app/app.py", line 1427, in process_message_async
    intent, response_text = _process_user_message(
  File "/app/app.py", line 690, in _process_user_message
    print(f">>> CONSOLE: Estado atual - last_bot_action: '{last_bot_action}', produtos: {len(last_shown_products)}")
NameError: name 'last_shown_products' is not defined
2025-08-14 17:28:53,647 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:28:53,650 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:29:37,205 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:29:37,262 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:29:38,008 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:29:38,236 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:29:38,237 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:29:45,125 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:29:45,186 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:29:46,042 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:29:46,373 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:29:46,378 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:30:05,671 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:30:05,672 [INFO] [root:1495] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 17:30:05,674 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:30:05] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:30:05,677 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:30:05,684 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:30:06,610 [ERROR] [root:1403] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1399, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:30:06,627 [INFO] [root:1448] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 17:30:21,148 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:30:21,149 [INFO] [root:1495] [inbound_message] Received message from 5511940726493: quero skol
2025-08-14 17:30:21,151 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:30:21] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:30:21,156 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:30:21,157 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero skol'
2025-08-14 17:30:21,159 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 17:30:21,161 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 6017 caracteres
2025-08-14 17:30:21,162 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 6017 caracteres
2025-08-14 17:30:21,167 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:30:21,169 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:30:21,173 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fb82eaf0760>
2025-08-14 17:30:21,174 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:30:21,175 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:30:21,175 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:30:21,176 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:30:21,176 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:30:25,866 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:30:25 GMT'), (b'Content-Length', b'334')])
2025-08-14 17:30:25,867 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:30:25,870 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:30:25,870 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:30:25,871 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:30:25,871 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:30:25,872 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.70s
2025-08-14 17:30:25,873 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 17:30:25,874 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 17:30:25,875 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:30:27,611 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15969 produtos e 254977 termos.
2025-08-14 17:30:27,617 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: skol
2025-08-14 17:30:27,689 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:30:28,424 [ERROR] [root:1403] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1399, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:30:28,428 [INFO] [root:1448] [process_message_async] THREAD: Processamento finalizado para 'quero skol'
2025-08-14 17:30:38,283 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:30:38,284 [INFO] [root:1495] [inbound_message] Received message from 5511940726493: 10
2025-08-14 17:30:38,291 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:30:38] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:30:38,294 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:30:38,301 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:30:39,028 [ERROR] [root:1403] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1399, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:30:39,032 [INFO] [root:1448] [process_message_async] THREAD: Processamento finalizado para '10'
2025-08-14 17:30:55,669 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:30:55,671 [INFO] [root:1495] [inbound_message] Received message from 5511940726493: 5
2025-08-14 17:30:55,673 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:30:55] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:30:55,688 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:30:56,910 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'skol'
2025-08-14 17:30:56,941 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:30:57,761 [ERROR] [root:1403] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1399, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:30:57,769 [INFO] [root:1448] [process_message_async] THREAD: Processamento finalizado para '5'
2025-08-14 17:31:08,149 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:31:08,150 [INFO] [root:1495] [inbound_message] Received message from 5511940726493: limpar carrinho
2025-08-14 17:31:08,151 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:31:08] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:31:08,155 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:31:08,156 [INFO] [root:390] [detect_user_intent_type] [INTENT] Comando de limpeza detectado: 'limpar carrinho'
2025-08-14 17:31:08,159 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:31:09,277 [ERROR] [root:1403] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1399, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:31:09,281 [INFO] [root:1448] [process_message_async] THREAD: Processamento finalizado para 'limpar carrinho'
2025-08-14 17:38:21,928 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/core/session_manager.py', reloading
2025-08-14 17:38:21,996 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:38:22,751 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:38:23,009 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:38:23,015 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:40:12,971 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:40:13,068 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:40:13,831 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:40:14,040 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:40:14,041 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:40:44,708 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:40:44,779 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:40:45,494 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:40:45,697 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:40:45,698 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:41:12,915 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:41:12,996 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:41:13,708 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:41:13,947 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:41:13,948 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:43:26,864 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:43:27,090 [INFO] [root:1519] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 17:43:27,093 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:43:27] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:43:27,101 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:43:27,118 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:43:28,054 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:43:28,062 [INFO] [root:1472] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 17:43:35,658 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:43:35,659 [INFO] [root:1519] [inbound_message] Received message from 5511940726493: desodorante
2025-08-14 17:43:35,662 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:43:35] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:43:35,665 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:43:35,668 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'desodorante'
2025-08-14 17:43:35,672 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 17:43:35,678 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 6933 caracteres
2025-08-14 17:43:35,680 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 6933 caracteres
2025-08-14 17:43:35,686 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:43:35,697 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:43:35,701 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7ff4c805d5e0>
2025-08-14 17:43:35,701 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:43:35,702 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:43:35,703 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:43:35,704 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:43:35,704 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:43:40,533 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:43:40 GMT'), (b'Content-Length', b'333')])
2025-08-14 17:43:40,534 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:43:40,535 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:43:40,536 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:43:40,536 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:43:40,537 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:43:40,537 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.84s
2025-08-14 17:43:40,538 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 17:43:40,539 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 17:43:40,539 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:43:42,274 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15969 produtos e 254977 termos.
2025-08-14 17:43:42,279 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: desodorante
2025-08-14 17:43:42,348 [INFO] [root:352] [fuzzy_search_products] [FUZZY] Busca fuzzy no banco para: 'desodorante'
2025-08-14 17:43:43,240 [INFO] [root:397] [fuzzy_search_products] [FUZZY] Retornando 0 produtos do banco
2025-08-14 17:43:43,247 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:43:44,061 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:43:44,080 [INFO] [root:1472] [process_message_async] THREAD: Processamento finalizado para 'desodorante'
2025-08-14 17:43:51,162 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:43:51,167 [INFO] [root:1519] [inbound_message] Received message from 5511940726493: rexona
2025-08-14 17:43:51,171 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:43:51] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:43:51,183 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:43:51,184 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'rexona'
2025-08-14 17:43:51,186 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 6933 caracteres
2025-08-14 17:43:51,192 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:43:51,194 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:43:51,201 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7ff4c8116160>
2025-08-14 17:43:51,203 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:43:51,204 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:43:51,206 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:43:51,207 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:43:51,210 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:43:52,923 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:43:52 GMT'), (b'Content-Length', b'332')])
2025-08-14 17:43:52,925 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:43:52,925 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:43:52,927 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:43:52,928 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:43:52,928 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:43:52,931 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.74s
2025-08-14 17:43:52,932 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 17:43:52,932 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 17:43:52,933 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:43:52,935 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: rexona
2025-08-14 17:43:53,069 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:43:54,940 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:43:54,944 [INFO] [root:1472] [process_message_async] THREAD: Processamento finalizado para 'rexona'
2025-08-14 17:44:09,878 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:44:09,879 [INFO] [root:1519] [inbound_message] Received message from 5511940726493: 3
2025-08-14 17:44:09,882 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:44:09] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:44:09,885 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:44:09,895 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:44:10,685 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:44:10,691 [INFO] [root:1472] [process_message_async] THREAD: Processamento finalizado para '3'
2025-08-14 17:44:24,963 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:44:24,965 [INFO] [root:1519] [inbound_message] Received message from 5511940726493: 2
2025-08-14 17:44:24,967 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:44:24] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:44:24,973 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:44:25,476 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'rexona'
2025-08-14 17:44:25,511 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:44:26,455 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:44:26,459 [INFO] [root:1472] [process_message_async] THREAD: Processamento finalizado para '2'
2025-08-14 17:45:14,055 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:45:14,056 [INFO] [root:1519] [inbound_message] Received message from 5511940726493: refri
2025-08-14 17:45:14,058 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:45:14] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:45:14,061 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:45:14,062 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'refri'
2025-08-14 17:45:14,063 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 6933 caracteres
2025-08-14 17:45:14,068 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:45:14,073 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:45:14,077 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7ff4c80e0880>
2025-08-14 17:45:14,078 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:45:14,079 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:45:14,080 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:45:14,080 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:45:14,082 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:45:15,733 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:45:15 GMT'), (b'Content-Length', b'331')])
2025-08-14 17:45:15,734 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:45:15,735 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:45:15,735 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:45:15,736 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:45:15,736 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:45:15,737 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.66s
2025-08-14 17:45:15,738 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 17:45:15,738 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 17:45:15,739 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:45:17,456 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15969 produtos e 254977 termos.
2025-08-14 17:45:17,462 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: refri
2025-08-14 17:45:17,507 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:45:18,724 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:45:18,728 [INFO] [root:1472] [process_message_async] THREAD: Processamento finalizado para 'refri'
2025-08-14 17:45:26,647 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:45:26,648 [INFO] [root:1519] [inbound_message] Received message from 5511940726493: 6
2025-08-14 17:45:26,651 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:45:26] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:45:26,657 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:45:26,662 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:45:27,448 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:45:27,451 [INFO] [root:1472] [process_message_async] THREAD: Processamento finalizado para '6'
2025-08-14 17:45:31,806 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:45:31,807 [INFO] [root:1519] [inbound_message] Received message from 5511940726493: 5
2025-08-14 17:45:31,809 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:45:31] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:45:31,812 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:45:31,935 [INFO] [root:258] [update_kb] Adicionado termo 'refri' ao produto REFRIG.ANTARCTICA LT. ZERO GUARANA
2025-08-14 17:45:32,355 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'refri'
2025-08-14 17:45:32,386 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:45:33,273 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:45:33,282 [INFO] [root:1472] [process_message_async] THREAD: Processamento finalizado para '5'
2025-08-14 17:45:59,873 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:45:59,874 [INFO] [root:1519] [inbound_message] Received message from 5511940726493: 1
2025-08-14 17:45:59,876 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:45:59] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:45:59,880 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:45:59,882 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:46:00,821 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:46:00,824 [INFO] [root:1472] [process_message_async] THREAD: Processamento finalizado para '1'
2025-08-14 17:49:02,922 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:49:02,980 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:49:03,832 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:49:04,051 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:49:04,053 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:49:27,761 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:49:27,763 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 17:49:27,765 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:49:27] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:49:27,769 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:49:27,913 [INFO] [root:258] [update_kb] Adicionado termo 'refri' ao produto REFRIG.ANTARCTICA GUARANA+PEPSI BLACK
2025-08-14 17:49:28,287 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'refri'
2025-08-14 17:49:28,298 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:49:29,402 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:49:29,449 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 17:50:37,906 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:50:37,907 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: refri
2025-08-14 17:50:37,908 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:50:37] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:50:37,912 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:50:37,915 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'refri'
2025-08-14 17:50:37,917 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 17:50:37,920 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 6933 caracteres
2025-08-14 17:50:37,921 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 6933 caracteres
2025-08-14 17:50:37,927 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:50:37,929 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:50:37,934 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7efda1a4f220>
2025-08-14 17:50:37,935 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:50:37,936 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:50:37,937 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:50:37,939 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:50:37,945 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:50:42,831 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:50:42 GMT'), (b'Content-Length', b'334')])
2025-08-14 17:50:42,833 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:50:42,835 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:50:42,836 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:50:42,837 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:50:42,837 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:50:42,837 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.91s
2025-08-14 17:50:42,838 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 17:50:42,839 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 17:50:42,839 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:50:44,576 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15969 produtos e 254977 termos.
2025-08-14 17:50:44,582 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: refri
2025-08-14 17:50:44,631 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:50:46,033 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:50:46,057 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'refri'
2025-08-14 17:50:54,967 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:50:54,968 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 5
2025-08-14 17:50:54,970 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:50:54] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:50:54,986 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:50:55,002 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:50:56,123 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:50:56,127 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '5'
2025-08-14 17:51:00,971 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:51:00,972 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 6
2025-08-14 17:51:00,973 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:51:00] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:51:00,976 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:51:01,097 [INFO] [root:258] [update_kb] Adicionado termo 'refri' ao produto REFRIG.ANTARCTICA LT. SODA DIET
2025-08-14 17:51:01,503 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'refri'
2025-08-14 17:51:01,530 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:51:03,024 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:51:03,030 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '6'
2025-08-14 17:51:13,453 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:51:13,455 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 1
2025-08-14 17:51:13,458 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:51:13] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:51:13,462 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:51:13,467 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:51:15,365 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:51:15,370 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '1'
2025-08-14 17:52:15,792 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:52:15,852 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:52:16,645 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:52:16,849 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:52:16,850 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:52:59,795 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:52:59,859 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:53:00,592 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:53:00,786 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:53:00,791 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:54:25,166 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:54:25,241 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:54:25,952 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:54:26,150 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:54:26,151 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:55:22,182 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:55:22,251 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:55:23,038 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:55:23,266 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:55:23,268 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:55:50,530 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 17:55:50,588 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 17:55:51,321 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 17:55:51,537 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 17:55:51,538 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 17:56:35,690 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:56:35,939 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 1
2025-08-14 17:56:35,944 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:56:35] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:56:35,960 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:56:37,594 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'refri'
2025-08-14 17:56:37,620 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:56:38,568 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:56:38,603 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '1'
2025-08-14 17:56:45,307 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:56:45,309 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 2
2025-08-14 17:56:45,313 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:56:45] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:56:45,322 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:56:45,342 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:56:46,148 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:56:46,155 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '2'
2025-08-14 17:56:52,024 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:56:52,026 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 1
2025-08-14 17:56:52,030 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:56:52] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:56:52,036 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:56:52,046 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:56:52,747 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:56:52,759 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '1'
2025-08-14 17:57:00,029 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:57:00,030 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 12.345.678/0001-95
2025-08-14 17:57:00,031 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:57:00] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:57:00,036 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:57:00,038 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '12.345.678/0001-95'
2025-08-14 17:57:00,040 [INFO] [root:447] [get_intent] [llm_interface.py] CNPJ detectado em contexto de checkout
2025-08-14 17:57:00,054 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:57:00,965 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:57:00,969 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '12.345.678/0001-95'
2025-08-14 17:57:08,438 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:57:08,439 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 17:57:08,440 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:57:08] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:57:08,444 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:57:08,447 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:57:09,110 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:57:09,113 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 17:57:16,322 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:57:16,323 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: quero vassoura
2025-08-14 17:57:16,325 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:57:16] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:57:16,329 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:57:16,330 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero vassoura'
2025-08-14 17:57:16,331 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 17:57:16,335 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 6933 caracteres
2025-08-14 17:57:16,337 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 6933 caracteres
2025-08-14 17:57:16,342 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 17:57:16,344 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 17:57:16,347 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f4a32cd0cd0>
2025-08-14 17:57:16,347 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 17:57:16,348 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 17:57:16,349 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 17:57:16,350 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 17:57:16,352 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 17:57:21,278 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 17:57:21 GMT'), (b'Content-Length', b'333')])
2025-08-14 17:57:21,279 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 17:57:21,280 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 17:57:21,280 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 17:57:21,281 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 17:57:21,281 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 17:57:21,282 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.94s
2025-08-14 17:57:21,284 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 17:57:21,285 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 17:57:21,285 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 17:57:23,029 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15969 produtos e 254977 termos.
2025-08-14 17:57:23,037 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'vassoura'
2025-08-14 17:57:31,078 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.8
2025-08-14 17:57:31,080 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'vassoura'
2025-08-14 17:57:31,175 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.6
2025-08-14 17:57:31,176 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'vassoura'
2025-08-14 17:57:31,263 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 4 produtos com similaridade >= 0.4
2025-08-14 17:57:31,264 [INFO] [root:175] [find_product_in_kb] [KB] Busca fuzzy (baixa) encontrou 4 produtos para: vassoura
2025-08-14 17:57:31,306 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:57:32,107 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:57:32,111 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'quero vassoura'
2025-08-14 17:57:36,771 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:57:36,772 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 10
2025-08-14 17:57:36,774 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:57:36] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:57:36,778 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:57:36,781 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:57:37,531 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:57:37,536 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '10'
2025-08-14 17:57:42,662 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:57:42,663 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 2
2025-08-14 17:57:42,665 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:57:42] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:57:42,671 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:57:42,804 [INFO] [root:258] [update_kb] Adicionado termo 'vassoura' ao produto VASSOURA STA MARIA VIP PP
2025-08-14 17:57:43,212 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'vassoura'
2025-08-14 17:57:43,251 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:57:44,031 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:57:44,045 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '2'
2025-08-14 17:57:49,255 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:57:49,264 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: finalizar pedido
2025-08-14 17:57:49,269 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:57:49] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:57:49,285 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:57:49,293 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:57:49,979 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:57:50,001 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'finalizar pedido'
2025-08-14 17:57:56,430 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:57:56,431 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 10203060504022
2025-08-14 17:57:56,437 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:57:56] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:57:56,440 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:57:56,447 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:57:57,138 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:57:57,142 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '10203060504022'
2025-08-14 17:58:17,348 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 17:58:17,354 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: Oi
2025-08-14 17:58:17,357 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 17:58:17] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 17:58:17,360 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 17:58:17,364 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 17:58:18,422 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 17:58:18,428 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-14 18:04:32,654 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:04:32,739 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:04:33,578 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:04:33,809 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:04:33,811 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:04:53,048 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:04:53,117 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:04:54,131 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:04:54,453 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:04:54,457 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:05:32,772 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:05:32,824 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:05:33,479 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:05:33,681 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:05:33,684 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:06:14,598 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:06:14,655 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:06:15,328 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:06:15,543 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:06:15,544 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:06:45,809 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:06:45,872 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:06:46,637 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:06:46,844 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:06:46,846 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:07:06,749 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:07:06,807 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:07:07,729 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:07:08,052 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:07:08,054 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:07:40,147 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:07:40,191 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:07:40,987 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:07:41,203 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:07:41,204 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:08:19,023 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:08:19,224 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: Oi
2025-08-14 18:08:19,227 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:08:19] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:08:19,236 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:08:19,247 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:08:20,550 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:08:20,574 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-14 18:08:31,494 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:08:31,496 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: quero comprar cerveja
2025-08-14 18:08:31,504 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:08:31] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:08:31,512 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:08:31,519 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:08:32,459 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:08:32,463 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'quero comprar cerveja'
2025-08-14 18:10:43,907 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:10:43,908 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: quero cerveja
2025-08-14 18:10:43,911 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:10:43] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:10:43,919 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:10:43,921 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero cerveja'
2025-08-14 18:10:43,923 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 18:10:43,926 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 7848 caracteres
2025-08-14 18:10:43,928 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 7848 caracteres
2025-08-14 18:10:43,933 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 18:10:43,935 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 18:10:43,939 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f704158fdc0>
2025-08-14 18:10:43,940 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 18:10:43,940 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 18:10:43,941 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 18:10:43,942 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 18:10:43,942 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 18:10:49,021 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 18:10:49 GMT'), (b'Content-Length', b'334')])
2025-08-14 18:10:49,022 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 18:10:49,026 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 18:10:49,026 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 18:10:49,027 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 18:10:49,027 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 18:10:49,028 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 5.09s
2025-08-14 18:10:49,029 [WARNING] [root:607] [get_intent] [llm_interface.py] LLM demorou 5.09s (timeout: 5s)
2025-08-14 18:10:49,029 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 18:10:49,031 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 18:10:49,032 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 18:10:50,766 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254979 termos.
2025-08-14 18:10:50,772 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja
2025-08-14 18:10:51,353 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:10:52,173 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:10:52,177 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'quero cerveja'
2025-08-14 18:10:57,364 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:10:57,366 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 18:10:57,370 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:10:57] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:10:57,373 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:10:57,375 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:10:58,109 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:10:58,112 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 18:11:02,088 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:11:02,089 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: ver carrinho
2025-08-14 18:11:02,091 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:11:02] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:11:02,094 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:11:02,101 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:11:02,836 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:11:02,840 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'ver carrinho'
2025-08-14 18:11:09,209 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:11:09,210 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 5
2025-08-14 18:11:09,212 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:11:09] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:11:09,219 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:11:09,219 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '5'
2025-08-14 18:11:09,223 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:11:10,143 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:11:10,150 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '5'
2025-08-14 18:11:28,378 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:11:28,380 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: skol
2025-08-14 18:11:28,385 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:11:28] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:11:28,390 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:11:28,391 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'skol'
2025-08-14 18:11:28,393 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 7848 caracteres
2025-08-14 18:11:28,398 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 18:11:28,400 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 18:11:28,404 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f70416b0640>
2025-08-14 18:11:28,405 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 18:11:28,406 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 18:11:28,406 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 18:11:28,407 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 18:11:28,408 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 18:11:29,972 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 18:11:29 GMT'), (b'Content-Length', b'330')])
2025-08-14 18:11:29,972 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 18:11:29,974 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 18:11:29,974 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 18:11:29,975 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 18:11:29,975 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 18:11:29,976 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.58s
2025-08-14 18:11:29,976 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 18:11:29,978 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 18:11:29,978 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 18:11:29,979 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: skol
2025-08-14 18:11:30,049 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:11:30,900 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:11:30,903 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'skol'
2025-08-14 18:11:38,771 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:11:38,773 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: mais
2025-08-14 18:11:38,775 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:11:38] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:11:38,785 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:11:38,810 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:11:39,586 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:11:39,600 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para 'mais'
2025-08-14 18:11:51,584 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:11:51,593 [INFO] [root:1523] [inbound_message] Received message from 5511940726493: 13
2025-08-14 18:11:51,596 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:11:51] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:11:51,602 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:11:51,603 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '13'
2025-08-14 18:11:51,613 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:11:52,306 [ERROR] [root:1427] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1423, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:11:52,310 [INFO] [root:1476] [process_message_async] THREAD: Processamento finalizado para '13'
2025-08-14 18:20:52,012 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/core/session_manager.py', reloading
2025-08-14 18:20:52,193 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:20:53,045 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:20:53,261 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:20:53,262 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:22:21,114 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:22:21,177 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:22:22,399 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:22:22,815 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:22:22,819 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:23:50,965 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:23:50,966 [INFO] [root:1534] [inbound_message] Received message from 5511940726493: quero ccerveja
2025-08-14 18:23:50,969 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:23:50] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:23:50,972 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:23:50,974 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero ccerveja'
2025-08-14 18:23:50,975 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 18:23:50,976 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 7848 caracteres
2025-08-14 18:23:50,977 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 7848 caracteres
2025-08-14 18:23:50,982 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 18:23:50,984 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 18:23:50,988 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f29e5ab0ca0>
2025-08-14 18:23:50,988 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 18:23:50,989 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 18:23:50,990 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 18:23:50,990 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 18:23:50,991 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 18:23:56,233 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 18:23:56 GMT'), (b'Content-Length', b'334')])
2025-08-14 18:23:56,234 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 18:23:56,235 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 18:23:56,236 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 18:23:56,236 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 18:23:56,236 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 18:23:56,237 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 5.25s
2025-08-14 18:23:56,238 [WARNING] [root:607] [get_intent] [llm_interface.py] LLM demorou 5.25s (timeout: 5s)
2025-08-14 18:23:56,238 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 18:23:56,239 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 18:23:56,240 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 18:23:57,964 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254979 termos.
2025-08-14 18:23:57,970 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'ccerveja'
2025-08-14 18:24:05,373 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.8
2025-08-14 18:24:05,373 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'ccerveja'
2025-08-14 18:24:05,459 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.6
2025-08-14 18:24:05,460 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'ccerveja'
2025-08-14 18:24:05,549 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 248 produtos com similaridade >= 0.4
2025-08-14 18:24:05,551 [INFO] [root:175] [find_product_in_kb] [KB] Busca fuzzy (baixa) encontrou 248 produtos para: ccerveja
2025-08-14 18:24:06,391 [INFO] [root:352] [fuzzy_search_products] [FUZZY] Busca fuzzy no banco para: 'ccerveja'
2025-08-14 18:24:07,196 [INFO] [root:397] [fuzzy_search_products] [FUZZY] Retornando 0 produtos do banco
2025-08-14 18:24:07,205 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:24:08,136 [ERROR] [root:1438] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1434, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:24:08,142 [INFO] [root:1487] [process_message_async] THREAD: Processamento finalizado para 'quero ccerveja'
2025-08-14 18:24:25,817 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:24:25,819 [INFO] [root:1534] [inbound_message] Received message from 5511940726493: skol beats
2025-08-14 18:24:25,821 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:24:25] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:24:25,824 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:24:25,825 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'skol beats'
2025-08-14 18:24:25,826 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 7848 caracteres
2025-08-14 18:24:25,832 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 18:24:25,835 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 18:24:25,838 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f29e5a27160>
2025-08-14 18:24:25,839 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 18:24:25,839 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 18:24:25,840 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 18:24:25,840 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 18:24:25,841 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 18:24:28,402 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 18:24:28 GMT'), (b'Content-Length', b'511')])
2025-08-14 18:24:28,403 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 18:24:28,404 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 18:24:28,405 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 18:24:28,405 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 18:24:28,406 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 18:24:28,406 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.57s
2025-08-14 18:24:28,407 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: Com base no contexto da conversa, podemos inferir que o cliente est√° procurando por um produto relac...
2025-08-14 18:24:28,407 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: Com base no contexto da conversa, podemos inferir que o cliente est√° procurando por um produto relacionado √† "Skol Beats". No entanto, n√£o h√° produtos adicionados ao carrinho e n√£o h√° CNPJ v√°lido fornecido.
2025-08-14 18:24:28,408 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 18:24:28,409 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: skol beats
2025-08-14 18:24:28,442 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:24:29,356 [ERROR] [root:1438] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1434, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:24:29,359 [INFO] [root:1487] [process_message_async] THREAD: Processamento finalizado para 'skol beats'
2025-08-14 18:24:34,324 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:24:34,326 [INFO] [root:1534] [inbound_message] Received message from 5511940726493: mais
2025-08-14 18:24:34,328 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:24:34] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:24:34,339 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:24:34,369 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:24:35,005 [ERROR] [root:1438] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1434, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:24:35,047 [INFO] [root:1487] [process_message_async] THREAD: Processamento finalizado para 'mais'
2025-08-14 18:24:40,424 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:24:40,432 [INFO] [root:1534] [inbound_message] Received message from 5511940726493: 11
2025-08-14 18:24:40,435 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:24:40] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:24:40,444 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:24:40,451 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:24:41,188 [ERROR] [root:1438] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1434, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:24:41,206 [INFO] [root:1487] [process_message_async] THREAD: Processamento finalizado para '11'
2025-08-14 18:24:50,446 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:24:50,450 [INFO] [root:1534] [inbound_message] Received message from 5511940726493: 20
2025-08-14 18:24:50,452 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:24:50] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:24:50,455 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:24:50,613 [INFO] [root:258] [update_kb] Adicionado termo 'skol beats' ao produto BEB.MISTA SKOL BEATS TROPICAL LT
2025-08-14 18:24:51,034 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'skol beats'
2025-08-14 18:24:51,064 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:24:51,794 [ERROR] [root:1438] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1434, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:24:51,813 [INFO] [root:1487] [process_message_async] THREAD: Processamento finalizado para '20'
2025-08-14 18:24:59,328 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:24:59,329 [INFO] [root:1534] [inbound_message] Received message from 5511940726493: fechar pedido
2025-08-14 18:24:59,330 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:24:59] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:24:59,334 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:24:59,338 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:24:59,948 [ERROR] [root:1438] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1434, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:24:59,952 [INFO] [root:1487] [process_message_async] THREAD: Processamento finalizado para 'fechar pedido'
2025-08-14 18:25:16,357 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:25:16,359 [INFO] [root:1534] [inbound_message] Received message from 5511940726493: 12345678910230
2025-08-14 18:25:16,360 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:25:16] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:25:16,367 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:25:16,387 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:25:16,989 [ERROR] [root:1438] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1434, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:25:16,992 [INFO] [root:1487] [process_message_async] THREAD: Processamento finalizado para '12345678910230'
2025-08-14 18:26:56,153 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:26:56,221 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:26:57,204 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:26:57,627 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:26:57,633 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:27:44,057 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:27:44,059 [INFO] [root:1546] [inbound_message] Received message from 5511940726493: quero cerveja
2025-08-14 18:27:44,061 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:27:44] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:27:44,065 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:27:44,069 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero cerveja'
2025-08-14 18:27:44,071 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 18:27:44,074 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 7848 caracteres
2025-08-14 18:27:44,075 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 7848 caracteres
2025-08-14 18:27:44,081 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 18:27:44,084 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 18:27:44,089 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f9cae146100>
2025-08-14 18:27:44,090 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 18:27:44,090 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 18:27:44,091 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 18:27:44,091 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 18:27:44,092 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 18:27:45,910 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 18:27:45 GMT'), (b'Content-Length', b'332')])
2025-08-14 18:27:45,912 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 18:27:45,915 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 18:27:45,915 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 18:27:45,916 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 18:27:45,917 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 18:27:45,918 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.83s
2025-08-14 18:27:45,919 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**...
2025-08-14 18:27:45,920 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: **AN√ÅLISE DA MENSAGEM DO USU√ÅRIO:**
2025-08-14 18:27:45,921 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 18:27:47,671 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254979 termos.
2025-08-14 18:27:47,677 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja
2025-08-14 18:27:48,249 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:27:48,900 [ERROR] [root:1450] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1446, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:27:48,911 [INFO] [root:1499] [process_message_async] THREAD: Processamento finalizado para 'quero cerveja'
2025-08-14 18:28:01,101 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:28:01,103 [INFO] [root:1546] [inbound_message] Received message from 5511940726493: mais
2025-08-14 18:28:01,105 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:28:01] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:28:01,108 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:28:01,130 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:28:01,761 [ERROR] [root:1450] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1446, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:28:01,770 [INFO] [root:1499] [process_message_async] THREAD: Processamento finalizado para 'mais'
2025-08-14 18:28:07,368 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:28:07,370 [INFO] [root:1546] [inbound_message] Received message from 5511940726493: 19
2025-08-14 18:28:07,376 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:28:07] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:28:07,384 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:28:07,400 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:28:08,062 [ERROR] [root:1450] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1446, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:28:08,085 [INFO] [root:1499] [process_message_async] THREAD: Processamento finalizado para '19'
2025-08-14 18:28:18,187 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:28:18,189 [INFO] [root:1546] [inbound_message] Received message from 5511940726493: 20
2025-08-14 18:28:18,191 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:28:18] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:28:18,194 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:28:18,988 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'cerveja'
2025-08-14 18:28:19,015 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:28:19,640 [ERROR] [root:1450] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1446, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:28:19,659 [INFO] [root:1499] [process_message_async] THREAD: Processamento finalizado para '20'
2025-08-14 18:28:26,970 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:28:26,971 [INFO] [root:1546] [inbound_message] Received message from 5511940726493: esvaziar carrinho
2025-08-14 18:28:26,973 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:28:26] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:28:26,976 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:28:26,977 [INFO] [root:391] [detect_user_intent_type] [INTENT] Comando de limpeza detectado: 'esvaziar carrinho'
2025-08-14 18:28:26,980 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:28:27,562 [ERROR] [root:1450] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1446, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:28:27,568 [INFO] [root:1499] [process_message_async] THREAD: Processamento finalizado para 'esvaziar carrinho'
2025-08-14 18:35:41,296 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 18:35:41,375 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:35:42,092 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:35:42,318 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:35:42,320 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:35:55,329 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:35:55,399 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:35:56,106 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:35:56,296 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:35:56,298 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:36:08,270 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:36:08,339 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:36:09,000 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:36:09,197 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:36:09,198 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:36:29,169 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:36:29,233 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:36:29,943 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:36:30,140 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:36:30,141 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:36:40,986 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:36:41,042 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:36:41,702 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:36:41,917 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:36:41,918 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:36:48,583 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:36:48,639 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:36:49,359 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:36:49,570 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:36:49,571 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:37:25,175 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:37:25,249 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:37:25,960 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:37:26,161 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:37:26,163 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:37:34,200 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:37:34,291 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:37:35,285 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:37:35,717 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:37:35,719 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:37:42,811 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:37:42,869 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:37:43,544 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:37:43,750 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:37:43,751 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:37:50,352 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:37:50,417 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:37:51,193 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:37:51,429 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:37:51,430 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:37:57,982 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:37:58,035 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:37:58,686 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:37:58,879 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:37:58,881 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:38:04,992 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:38:05,043 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:38:05,671 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:38:05,864 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:38:05,865 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:38:16,703 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:38:16,759 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:38:17,425 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:38:17,628 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:38:17,629 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:38:27,400 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:38:27,453 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:38:28,104 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:38:28,321 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:38:28,322 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:38:36,006 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:38:36,064 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:38:36,837 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:38:37,173 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:38:37,177 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:38:49,919 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:38:49,986 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:38:50,669 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:38:50,867 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:38:50,869 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:38:55,372 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:38:55,431 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:38:56,136 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:38:56,353 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:38:56,354 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:40:09,250 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:40:09,251 [INFO] [root:1544] [inbound_message] Received message from 5511940726493: Oi
2025-08-14 18:40:09,253 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:40:09] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:40:09,257 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:40:09,259 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 18:40:09,262 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fdedef32e80>
2025-08-14 18:40:09,263 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 18:40:09,263 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 18:40:09,264 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 18:40:09,267 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 18:40:09,268 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 18:40:12,545 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 18:40:12 GMT'), (b'Content-Length', b'424')])
2025-08-14 18:40:12,547 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 18:40:12,548 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 18:40:12,549 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 18:40:12,550 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 18:40:12,550 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 18:40:12,551 [INFO] [root:974] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para greeting: Ol√° pessoal! Eu sou G.A.V., seu assistente de vend...
2025-08-14 18:40:12,554 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:40:13,209 [ERROR] [root:1448] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1444, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:40:13,218 [INFO] [root:1497] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-14 18:42:06,329 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 18:42:06,402 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:42:07,357 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:42:07,695 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:42:07,699 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:42:43,412 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 18:42:43,495 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:42:44,209 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:42:44,413 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:42:44,418 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:43:07,204 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 18:43:07,266 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:43:07,968 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:43:08,157 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:43:08,158 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:44:31,918 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 18:44:32,001 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:44:32,972 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:44:33,498 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:44:33,505 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:45:11,478 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/communication/twilio_client.py', reloading
2025-08-14 18:45:11,540 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:45:12,260 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:45:12,476 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:45:12,477 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:45:23,402 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/communication/twilio_client.py', reloading
2025-08-14 18:45:23,452 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:45:24,169 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:45:24,427 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:45:24,429 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:48:23,222 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:48:23,224 [INFO] [root:1544] [inbound_message] Received message from 5511940726493: oi
2025-08-14 18:48:23,228 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:48:23] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:48:23,231 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:48:23,233 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 18:48:23,236 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f67e63b1e80>
2025-08-14 18:48:23,237 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 18:48:23,238 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 18:48:23,238 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 18:48:23,239 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 18:48:23,239 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 18:48:26,499 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 18:48:26 GMT'), (b'Content-Length', b'419')])
2025-08-14 18:48:26,500 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 18:48:26,501 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 18:48:26,503 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 18:48:26,504 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 18:48:26,504 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 18:48:26,505 [INFO] [root:977] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para greeting: Ol√°! Eu sou G.A.V., seu assistente de vendas mais ...
2025-08-14 18:48:26,509 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:48:27,217 [ERROR] [root:1448] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1444, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:48:27,223 [INFO] [root:1497] [process_message_async] THREAD: Processamento finalizado para 'oi'
2025-08-14 18:51:27,649 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 18:51:27,655 [INFO] [root:1544] [inbound_message] Received message from 5511940726493: quero ver cerveja
2025-08-14 18:51:27,659 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 18:51:27] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 18:51:27,674 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 18:51:27,681 [INFO] [root:438] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero ver cerveja'
2025-08-14 18:51:27,683 [INFO] [root:187] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 18:51:27,696 [INFO] [root:192] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 8210 caracteres
2025-08-14 18:51:27,700 [INFO] [root:484] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 8210 caracteres
2025-08-14 18:51:27,705 [INFO] [root:582] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 18:51:27,707 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 18:51:27,711 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f67e649fb50>
2025-08-14 18:51:27,712 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 18:51:27,714 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 18:51:27,715 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 18:51:27,717 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 18:51:27,719 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 18:51:31,658 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 18:51:31 GMT'), (b'Content-Length', b'473')])
2025-08-14 18:51:31,660 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 18:51:31,661 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 18:51:31,662 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 18:51:31,663 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 18:51:31,667 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 18:51:31,669 [INFO] [root:601] [get_intent] [llm_interface.py] Resposta recebida do LLM em 3.96s
2025-08-14 18:51:31,675 [INFO] [root:613] [get_intent] [llm_interface.py] Resposta do LLM: Com base no hist√≥rico da conversa e na mensagem atual do cliente ("quero ver cerveja"), posso inferi...
2025-08-14 18:51:31,679 [DEBUG] [root:616] [get_intent] [llm_interface.py] Conte√∫do limpo: Com base no hist√≥rico da conversa e na mensagem atual do cliente ("quero ver cerveja"), posso inferir que o cliente est√° interessado em produtos relacionados √† "cerveja".
2025-08-14 18:51:31,684 [ERROR] [root:653] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 18:51:33,628 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254979 termos.
2025-08-14 18:51:33,635 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'ver cerveja'
2025-08-14 18:51:55,743 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 168 produtos com similaridade >= 0.8
2025-08-14 18:51:55,747 [INFO] [root:163] [find_product_in_kb] [KB] Busca fuzzy (alta) encontrou 168 produtos para: ver cerveja
2025-08-14 18:51:56,350 [INFO] [root:352] [fuzzy_search_products] [FUZZY] Busca fuzzy no banco para: 'ver cerveja'
2025-08-14 18:51:58,405 [INFO] [root:397] [fuzzy_search_products] [FUZZY] Retornando 10 produtos do banco
2025-08-14 18:51:58,411 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 18:51:59,254 [ERROR] [root:1448] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1444, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 18:51:59,265 [INFO] [root:1497] [process_message_async] THREAD: Processamento finalizado para 'quero ver cerveja'
2025-08-14 18:58:20,892 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 18:58:21,049 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:58:22,630 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:58:22,892 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:58:22,894 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 18:59:58,599 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 18:59:58,657 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 18:59:59,443 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 18:59:59,681 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 18:59:59,682 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 19:00:44,772 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 19:00:44,832 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 19:00:45,852 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 19:00:46,345 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 19:00:46,348 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 19:01:41,505 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:01:41,506 [INFO] [root:1705] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 19:01:41,509 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:01:41] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:01:41,519 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:01:41,525 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:01:42,142 [ERROR] [root:1609] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1605, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:01:42,158 [INFO] [root:1658] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 19:01:49,543 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:01:49,546 [INFO] [root:1705] [inbound_message] Received message from 5511940726493: quero ver skol
2025-08-14 19:01:49,550 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:01:49] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:01:49,554 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:01:49,554 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero ver skol'
2025-08-14 19:01:49,556 [INFO] [root:188] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 19:01:49,558 [INFO] [root:193] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 8782 caracteres
2025-08-14 19:01:49,559 [INFO] [root:485] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 8782 caracteres
2025-08-14 19:01:49,566 [INFO] [root:583] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 19:01:49,568 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 19:01:49,571 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f882dc78670>
2025-08-14 19:01:49,576 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 19:01:49,577 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 19:01:49,578 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 19:01:49,578 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 19:01:49,580 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 19:01:53,641 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 19:01:53 GMT'), (b'Content-Length', b'502')])
2025-08-14 19:01:53,643 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 19:01:53,644 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 19:01:53,644 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 19:01:53,645 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 19:01:53,645 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 19:01:53,646 [INFO] [root:602] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.08s
2025-08-14 19:01:53,647 [INFO] [root:614] [get_intent] [llm_interface.py] Resposta do LLM: Com base no contexto da conversa, o cliente j√° pediu "skol beats" anteriormente e agora est√° procura...
2025-08-14 19:01:53,647 [DEBUG] [root:617] [get_intent] [llm_interface.py] Conte√∫do limpo: Com base no contexto da conversa, o cliente j√° pediu "skol beats" anteriormente e agora est√° procurando por "skol". Isso sugere que o cliente est√° interessado em produtos relacionados √† marca Skol.
2025-08-14 19:01:53,648 [ERROR] [root:654] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 19:01:55,374 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254979 termos.
2025-08-14 19:01:55,382 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'ver skol'
2025-08-14 19:02:13,819 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 14 produtos com similaridade >= 0.8
2025-08-14 19:02:13,820 [INFO] [root:163] [find_product_in_kb] [KB] Busca fuzzy (alta) encontrou 14 produtos para: ver skol
2025-08-14 19:02:13,902 [INFO] [root:352] [fuzzy_search_products] [FUZZY] Busca fuzzy no banco para: 'ver skol'
2025-08-14 19:02:15,685 [INFO] [root:397] [fuzzy_search_products] [FUZZY] Retornando 2 produtos do banco
2025-08-14 19:02:15,693 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:02:16,305 [ERROR] [root:1609] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1605, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:02:16,311 [INFO] [root:1658] [process_message_async] THREAD: Processamento finalizado para 'quero ver skol'
2025-08-14 19:03:28,484 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:03:28,485 [INFO] [root:1705] [inbound_message] Received message from 5511940726493: 3
2025-08-14 19:03:28,487 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:03:28] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:03:28,490 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:03:28,491 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 19:03:28,499 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f882dc789d0>
2025-08-14 19:03:28,500 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 19:03:28,501 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 19:03:28,501 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 19:03:28,503 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 19:03:28,503 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 19:03:30,124 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 19:03:30 GMT'), (b'Content-Length', b'426')])
2025-08-14 19:03:30,125 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 19:03:30,126 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 19:03:30,126 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 19:03:30,127 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 19:03:30,128 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 19:03:30,129 [INFO] [root:978] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para invalid_selection: Opa! Desculpe, mas n√£o tem nada com o n√∫mero 3. S√≥...
2025-08-14 19:03:30,132 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:03:30,714 [ERROR] [root:1609] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1605, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:03:30,719 [INFO] [root:1658] [process_message_async] THREAD: Processamento finalizado para '3'
2025-08-14 19:03:40,929 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:03:40,931 [INFO] [root:1705] [inbound_message] Received message from 5511940726493: 2
2025-08-14 19:03:40,932 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:03:40] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:03:40,934 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:03:40,937 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:03:41,517 [ERROR] [root:1609] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1605, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:03:41,521 [INFO] [root:1658] [process_message_async] THREAD: Processamento finalizado para '2'
2025-08-14 19:04:02,819 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:04:02,820 [INFO] [root:1705] [inbound_message] Received message from 5511940726493: 5
2025-08-14 19:04:02,822 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:04:02] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:04:02,825 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:04:02,965 [INFO] [root:258] [update_kb] Adicionado termo 'ver skol' ao produto CERVEJA SKOL LT.
2025-08-14 19:04:03,389 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'ver skol'
2025-08-14 19:04:03,419 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:04:04,000 [ERROR] [root:1609] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1605, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:04:04,005 [INFO] [root:1658] [process_message_async] THREAD: Processamento finalizado para '5'
2025-08-14 19:05:03,412 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:05:03,430 [INFO] [root:1705] [inbound_message] Received message from 5511940726493: Adiciona mais 3 cerveja
2025-08-14 19:05:03,433 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:05:03] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:05:03,440 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:05:03,445 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Adiciona mais 3 cerveja'
2025-08-14 19:05:03,450 [INFO] [root:485] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 8782 caracteres
2025-08-14 19:05:03,456 [INFO] [root:583] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 19:05:03,457 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 19:05:03,463 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f882dc9a970>
2025-08-14 19:05:03,464 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 19:05:03,465 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 19:05:03,465 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 19:05:03,466 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 19:05:03,467 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 19:05:05,374 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 19:05:05 GMT'), (b'Content-Length', b'440')])
2025-08-14 19:05:05,375 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 19:05:05,377 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 19:05:05,382 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 19:05:05,383 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 19:05:05,384 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 19:05:05,384 [INFO] [root:602] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.93s
2025-08-14 19:05:05,385 [INFO] [root:614] [get_intent] [llm_interface.py] Resposta do LLM: Com base no contexto da conversa, o cliente j√° adicionou 5 unidades de CERVEJA SKOL LT ao seu carrin...
2025-08-14 19:05:05,386 [DEBUG] [root:617] [get_intent] [llm_interface.py] Conte√∫do limpo: Com base no contexto da conversa, o cliente j√° adicionou 5 unidades de CERVEJA SKOL LT ao seu carrinho e agora deseja adicionar mais 3 unidades.
2025-08-14 19:05:05,386 [ERROR] [root:654] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 19:05:05,388 [DEBUG] [httpcore.connection:47] [trace] close.started
2025-08-14 19:05:05,389 [DEBUG] [httpcore.connection:47] [trace] close.complete
2025-08-14 19:05:05,389 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 19:05:05,392 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f882dc78910>
2025-08-14 19:05:05,392 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 19:05:05,393 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 19:05:05,393 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 19:05:05,394 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 19:05:05,394 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 19:05:06,491 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 19:05:06 GMT'), (b'Content-Length', b'396')])
2025-08-14 19:05:06,492 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 19:05:06,492 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 19:05:06,493 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 19:05:06,494 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 19:05:06,495 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 19:05:06,495 [INFO] [root:978] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para invalid_selection: Hey, voc√™ escolheu um n√∫mero errado. S√≥ tem duas o...
2025-08-14 19:05:06,498 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:05:07,122 [ERROR] [root:1609] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1605, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:05:07,126 [INFO] [root:1658] [process_message_async] THREAD: Processamento finalizado para 'Adiciona mais 3 cerveja'
2025-08-14 19:08:26,078 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/core/session_manager.py', reloading
2025-08-14 19:08:26,185 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 19:08:26,998 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 19:08:27,254 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 19:08:27,256 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 19:09:42,148 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 19:09:42,202 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 19:09:42,961 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 19:09:43,175 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 19:09:43,179 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 19:09:59,503 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 19:09:59,603 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 19:10:00,307 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 19:10:00,558 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 19:10:00,562 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 19:10:14,058 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:10:14,059 [INFO] [root:1743] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 19:10:14,061 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:10:14] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:10:14,068 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:10:14,074 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:10:14,825 [ERROR] [root:1647] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1643, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:10:14,836 [INFO] [root:1696] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 19:10:27,070 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:10:27,071 [INFO] [root:1743] [inbound_message] Received message from 5511940726493: Adiciona mais 3 skol
2025-08-14 19:10:27,074 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:10:27] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:10:27,081 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:10:27,082 [INFO] [root:404] [detect_user_intent_type] [INTENT] Comando de smart_cart_update detectado: 'Adiciona mais 3 skol'
2025-08-14 19:10:27,083 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Adiciona mais 3 skol'
2025-08-14 19:10:27,085 [INFO] [root:188] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 19:10:27,088 [INFO] [root:193] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 9388 caracteres
2025-08-14 19:10:27,090 [INFO] [root:485] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 9388 caracteres
2025-08-14 19:10:27,098 [INFO] [root:583] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 19:10:27,100 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 19:10:27,104 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f60c7f8abe0>
2025-08-14 19:10:27,105 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 19:10:27,105 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 19:10:27,106 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 19:10:27,106 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 19:10:27,107 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 19:10:30,547 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 19:10:30 GMT'), (b'Content-Length', b'367')])
2025-08-14 19:10:30,548 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 19:10:30,549 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 19:10:30,550 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 19:10:30,550 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 19:10:30,551 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 19:10:30,551 [INFO] [root:602] [get_intent] [llm_interface.py] Resposta recebida do LLM em 3.45s
2025-08-14 19:10:30,552 [INFO] [root:614] [get_intent] [llm_interface.py] Resposta do LLM: O cliente deseja adicionar mais 3 unidades de "Skol" ao seu carrinho....
2025-08-14 19:10:30,553 [DEBUG] [root:617] [get_intent] [llm_interface.py] Conte√∫do limpo: O cliente deseja adicionar mais 3 unidades de "Skol" ao seu carrinho.
2025-08-14 19:10:30,554 [ERROR] [root:654] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 19:10:32,314 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254980 termos.
2025-08-14 19:10:32,319 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'adiciona mais 3 skol'
2025-08-14 19:11:29,000 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 49 produtos com similaridade >= 0.8
2025-08-14 19:11:29,002 [INFO] [root:163] [find_product_in_kb] [KB] Busca fuzzy (alta) encontrou 49 produtos para: adiciona mais 3 skol
2025-08-14 19:11:29,233 [INFO] [root:352] [fuzzy_search_products] [FUZZY] Busca fuzzy no banco para: 'adiciona mais 3 skol'
2025-08-14 19:11:34,147 [INFO] [root:397] [fuzzy_search_products] [FUZZY] Retornando 3 produtos do banco
2025-08-14 19:11:34,154 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:11:34,862 [ERROR] [root:1647] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1643, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:11:34,867 [INFO] [root:1696] [process_message_async] THREAD: Processamento finalizado para 'Adiciona mais 3 skol'
2025-08-14 19:15:33,326 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/core/session_manager.py', reloading
2025-08-14 19:15:33,599 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 19:15:34,507 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 19:15:34,768 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 19:15:34,769 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 19:15:52,047 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 19:15:52,106 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 19:15:52,766 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 19:15:52,974 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 19:15:52,975 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 19:17:33,632 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:17:33,633 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 19:17:33,635 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:17:33] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:17:33,639 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:17:33,647 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:17:34,698 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:17:34,708 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 19:17:50,465 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:17:50,466 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: adiciona mais 3 skol
2025-08-14 19:17:50,470 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:17:50] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:17:50,473 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:17:50,474 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'adiciona mais 3 skol'
2025-08-14 19:17:50,484 [INFO] [root:188] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 19:17:50,489 [INFO] [root:193] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 10432 caracteres
2025-08-14 19:17:50,490 [INFO] [root:485] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 10432 caracteres
2025-08-14 19:17:50,496 [INFO] [root:583] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 19:17:50,501 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 19:17:50,504 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f4af7ab9df0>
2025-08-14 19:17:50,504 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 19:17:50,514 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 19:17:50,515 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 19:17:50,516 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 19:17:50,517 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 19:17:54,503 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 19:17:54 GMT'), (b'Content-Length', b'448')])
2025-08-14 19:17:54,504 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 19:17:54,505 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 19:17:54,506 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 19:17:54,506 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 19:17:54,506 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 19:17:54,507 [INFO] [root:602] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.01s
2025-08-14 19:17:54,508 [INFO] [root:614] [get_intent] [llm_interface.py] Resposta do LLM: O cliente deseja adicionar mais 3 unidades de "Skol" ao seu carrinho. No entanto, o bot est√° esperan...
2025-08-14 19:17:54,508 [DEBUG] [root:617] [get_intent] [llm_interface.py] Conte√∫do limpo: O cliente deseja adicionar mais 3 unidades de "Skol" ao seu carrinho. No entanto, o bot est√° esperando pelo CNPJ do cliente para finalizar o pedido.
2025-08-14 19:17:54,509 [ERROR] [root:654] [get_intent] [llm_interface.py] Erro ao parsear JSON: Expecting value: line 1 column 1 (char 0)
2025-08-14 19:17:56,219 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254980 termos.
2025-08-14 19:17:56,225 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'adiciona mais 3 skol'
2025-08-14 19:18:51,206 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 49 produtos com similaridade >= 0.8
2025-08-14 19:18:51,208 [INFO] [root:163] [find_product_in_kb] [KB] Busca fuzzy (alta) encontrou 49 produtos para: adiciona mais 3 skol
2025-08-14 19:18:51,413 [INFO] [root:352] [fuzzy_search_products] [FUZZY] Busca fuzzy no banco para: 'adiciona mais 3 skol'
2025-08-14 19:18:56,151 [INFO] [root:397] [fuzzy_search_products] [FUZZY] Retornando 3 produtos do banco
2025-08-14 19:18:56,158 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:18:56,913 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:18:56,917 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para 'adiciona mais 3 skol'
2025-08-14 19:20:16,553 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 19:20:16,714 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 19:20:17,351 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 19:20:17,562 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 19:20:17,565 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 19:21:05,030 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 19:21:05,096 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 19:21:05,773 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 19:21:05,990 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 19:21:05,991 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 19:21:35,059 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 19:21:35,140 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 19:21:35,842 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 19:21:36,081 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 19:21:36,083 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 19:22:03,542 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:22:03,543 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: adiciona mais 3 skol
2025-08-14 19:22:03,547 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:22:03] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:22:03,550 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:22:03,552 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'adiciona mais 3 skol'
2025-08-14 19:22:03,554 [INFO] [root:188] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 19:22:03,555 [INFO] [root:193] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 10432 caracteres
2025-08-14 19:22:03,556 [INFO] [root:485] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 10432 caracteres
2025-08-14 19:22:03,563 [INFO] [root:583] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 19:22:03,566 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 19:22:03,569 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fe866b1a700>
2025-08-14 19:22:03,569 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 19:22:03,570 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 19:22:03,570 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 19:22:03,572 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 19:22:03,573 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 19:22:05,305 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 19:22:05 GMT'), (b'Content-Length', b'406')])
2025-08-14 19:22:05,306 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 19:22:05,307 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 19:22:05,307 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 19:22:05,308 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 19:22:05,308 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 19:22:05,309 [INFO] [root:602] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.74s
2025-08-14 19:22:05,310 [INFO] [root:614] [get_intent] [llm_interface.py] Resposta do LLM: Com base no contexto da conversa, o cliente deseja adicionar mais 3 unidades de CERVEJA SKOL LT ao s...
2025-08-14 19:22:05,311 [DEBUG] [root:624] [get_intent] [llm_interface.py] Conte√∫do limpo: 
2025-08-14 19:22:05,312 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Empty content: line 1 column 1 (char 0)
2025-08-14 19:22:05,317 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:22:06,303 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:22:06,318 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para 'adiciona mais 3 skol'
2025-08-14 19:27:33,371 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:27:33,372 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: adiciona mais 3 skol
2025-08-14 19:27:33,379 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:27:33] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:27:33,383 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:27:33,537 [INFO] [root:258] [update_kb] Adicionado termo 'adiciona mais 3 skol' ao produto CERVEJA SKOL LT.
2025-08-14 19:27:33,953 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'adiciona mais 3 skol'
2025-08-14 19:27:33,963 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:27:34,703 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:27:34,715 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para 'adiciona mais 3 skol'
2025-08-14 19:28:14,018 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:28:14,022 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: 1
2025-08-14 19:28:14,030 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:28:14] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:28:14,035 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:28:14,039 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:28:14,632 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:28:14,637 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para '1'
2025-08-14 19:28:31,404 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:28:31,406 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: quero fini
2025-08-14 19:28:31,410 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:28:31] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:28:31,417 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:28:31,418 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero fini'
2025-08-14 19:28:31,419 [INFO] [root:188] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt.txt
2025-08-14 19:28:31,421 [INFO] [root:193] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 11454 caracteres
2025-08-14 19:28:31,422 [INFO] [root:485] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 11454 caracteres
2025-08-14 19:28:31,431 [INFO] [root:583] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 19:28:31,433 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 19:28:31,440 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fe866b34400>
2025-08-14 19:28:31,441 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 19:28:31,442 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 19:28:31,442 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 19:28:31,444 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 19:28:31,444 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 19:28:35,058 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 19:28:35 GMT'), (b'Content-Length', b'411')])
2025-08-14 19:28:35,059 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 19:28:35,060 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 19:28:35,061 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 19:28:35,061 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 19:28:35,062 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 19:28:35,062 [INFO] [root:602] [get_intent] [llm_interface.py] Resposta recebida do LLM em 3.63s
2025-08-14 19:28:35,063 [INFO] [root:614] [get_intent] [llm_interface.py] Resposta do LLM: O cliente est√° tentando finalizar o pedido, mas o bot est√° esperando pelo CNPJ do cliente para concl...
2025-08-14 19:28:35,063 [DEBUG] [root:624] [get_intent] [llm_interface.py] Conte√∫do limpo: 
2025-08-14 19:28:35,064 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Empty content: line 1 column 1 (char 0)
2025-08-14 19:28:36,832 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254981 termos.
2025-08-14 19:28:36,837 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: fini
2025-08-14 19:28:36,989 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:28:37,577 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:28:37,580 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para 'quero fini'
2025-08-14 19:28:52,675 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:28:52,678 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: mais
2025-08-14 19:28:52,680 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:28:52] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:28:52,695 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:28:52,732 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:28:53,314 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:28:53,328 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para 'mais'
2025-08-14 19:28:58,377 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:28:58,378 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: 19
2025-08-14 19:28:58,380 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:28:58] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:28:58,383 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:28:58,386 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:28:59,011 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:28:59,015 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para '19'
2025-08-14 19:29:07,210 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:29:07,211 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: 3
2025-08-14 19:29:07,213 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:29:07] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:29:07,217 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:29:07,720 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'fini'
2025-08-14 19:29:07,754 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:29:08,328 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:29:08,330 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para '3'
2025-08-14 19:29:29,123 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 19:29:29,124 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: adiciona mais 7 fini
2025-08-14 19:29:29,126 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 19:29:29] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 19:29:29,130 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 19:29:29,131 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'adiciona mais 7 fini'
2025-08-14 19:29:29,132 [INFO] [root:485] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 11454 caracteres
2025-08-14 19:29:29,137 [INFO] [root:583] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 19:29:29,138 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 19:29:29,144 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fe866bb1d60>
2025-08-14 19:29:29,145 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 19:29:29,146 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 19:29:29,146 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 19:29:29,147 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 19:29:29,148 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 19:29:30,988 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 19:29:30 GMT'), (b'Content-Length', b'419')])
2025-08-14 19:29:30,989 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 19:29:30,990 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 19:29:30,990 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 19:29:30,991 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 19:29:30,992 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 19:29:30,993 [INFO] [root:602] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.85s
2025-08-14 19:29:30,994 [INFO] [root:614] [get_intent] [llm_interface.py] Resposta do LLM: Com base no contexto da conversa, o cliente est√° adicionando mais 7 unidades de um produto chamado "...
2025-08-14 19:29:30,994 [DEBUG] [root:624] [get_intent] [llm_interface.py] Conte√∫do limpo: 
2025-08-14 19:29:30,995 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Empty content: line 1 column 1 (char 0)
2025-08-14 19:29:31,000 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 19:29:31,577 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 19:29:31,583 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para 'adiciona mais 7 fini'
2025-08-14 20:24:42,163 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 20:24:42,373 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:24:43,490 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:24:43,738 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:24:43,741 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 20:25:05,036 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 20:25:05,039 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: Oi
2025-08-14 20:25:05,041 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 20:25:05] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 20:25:05,046 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 20:25:05,053 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 20:25:05,835 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 20:25:05,867 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-14 20:25:21,745 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 20:25:21,747 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: Ol√°
2025-08-14 20:25:21,750 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 20:25:21] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 20:25:21,758 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 20:25:21,760 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Ol√°'
2025-08-14 20:25:21,764 [INFO] [root:474] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-14 20:25:21,774 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 20:25:22,525 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 20:25:22,529 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para 'Ol√°'
2025-08-14 20:25:54,149 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 20:25:54,151 [INFO] [root:1706] [inbound_message] Received message from 5511940726493: Quero ver shampoo
2025-08-14 20:25:54,154 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 20:25:54] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 20:25:54,159 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 20:25:54,160 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Quero ver shampoo'
2025-08-14 20:25:54,162 [INFO] [root:188] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-14 20:25:54,165 [INFO] [root:193] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 2191 caracteres
2025-08-14 20:25:54,167 [INFO] [root:485] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 2191 caracteres
2025-08-14 20:25:54,175 [INFO] [root:583] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 20:25:54,179 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 20:25:54,190 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f98adf1ba60>
2025-08-14 20:25:54,191 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 20:25:54,191 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 20:25:54,192 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 20:25:54,193 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 20:25:54,194 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 20:26:01,132 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 20:26:01 GMT'), (b'Content-Length', b'419')])
2025-08-14 20:26:01,133 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 20:26:01,134 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 20:26:01,135 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 20:26:01,136 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 20:26:01,137 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 20:26:01,137 [INFO] [root:602] [get_intent] [llm_interface.py] Resposta recebida do LLM em 6.96s
2025-08-14 20:26:01,138 [WARNING] [root:608] [get_intent] [llm_interface.py] LLM demorou 6.96s (timeout: 5s)
2025-08-14 20:26:01,139 [INFO] [root:614] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "get_top_selling_products_by_name",
  "parameters": {
    "product_name": "shampoo"...
2025-08-14 20:26:01,140 [DEBUG] [root:624] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "get_top_selling_products_by_name",
  "parameters": {
    "product_name": "shampoo"
  }
}
2025-08-14 20:26:01,141 [INFO] [root:675] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'get_top_selling_products_by_name', 'parameters': {'product_name': 'shampoo'}}
2025-08-14 20:26:02,928 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254981 termos.
2025-08-14 20:26:02,933 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'shampoo'
2025-08-14 20:26:09,920 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 0 produtos com similaridade >= 0.8
2025-08-14 20:26:09,923 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'shampoo'
2025-08-14 20:26:10,020 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 9 produtos com similaridade >= 0.6
2025-08-14 20:26:10,022 [INFO] [root:169] [find_product_in_kb] [KB] Busca fuzzy (m√©dia) encontrou 9 produtos para: shampoo
2025-08-14 20:26:10,085 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 20:26:10,670 [ERROR] [root:1610] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1606, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 20:26:10,683 [INFO] [root:1659] [process_message_async] THREAD: Processamento finalizado para 'Quero ver shampoo'
2025-08-14 20:28:25,895 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 20:28:26,034 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:28:27,002 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:28:27,239 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:28:27,241 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 20:29:32,921 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 20:29:32,987 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:29:33,703 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:29:33,935 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:29:33,939 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 20:30:10,175 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 20:30:10,176 [INFO] [root:1574] [inbound_message] Received message from 5511940726493: Ver carrinho
2025-08-14 20:30:10,178 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 20:30:10] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 20:30:10,181 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 20:30:10,181 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Ver carrinho'
2025-08-14 20:30:10,183 [INFO] [root:474] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-14 20:30:10,187 [ERROR] [root:1530] [process_message_async] ERRO CR√çTICO NA THREAD: expected string or bytes-like object
Traceback (most recent call last):
  File "/app/app.py", line 1502, in process_message_async
    intent, response_text = _process_user_message(
  File "/app/app.py", line 744, in _process_user_message
    intent = extract_json_from_ai_response(raw_intent_response)
  File "/app/utils/response_parser.py", line 24, in extract_json_from_ai_response
    matches = re.findall(pattern, content, re.DOTALL | re.IGNORECASE)
  File "/usr/local/lib/python3.9/re.py", line 241, in findall
    return _compile(pattern, flags).findall(string)
TypeError: expected string or bytes-like object
2025-08-14 20:30:10,199 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 20:30:10,204 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 20:31:47,978 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 20:31:48,050 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:31:49,003 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:31:49,197 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:31:49,198 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 20:32:14,166 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 20:32:14,167 [INFO] [root:1574] [inbound_message] Received message from 5511940726493: Ver carrinho
2025-08-14 20:32:14,172 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 20:32:14] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 20:32:14,176 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 20:32:14,177 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Ver carrinho'
2025-08-14 20:32:14,178 [INFO] [root:474] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-14 20:32:14,180 [ERROR] [root:1530] [process_message_async] ERRO CR√çTICO NA THREAD: expected string or bytes-like object
Traceback (most recent call last):
  File "/app/app.py", line 1502, in process_message_async
    intent, response_text = _process_user_message(
  File "/app/app.py", line 744, in _process_user_message
    intent = extract_json_from_ai_response(raw_intent_response)
  File "/app/utils/response_parser.py", line 24, in extract_json_from_ai_response
    matches = re.findall(pattern, content, re.DOTALL | re.IGNORECASE)
  File "/usr/local/lib/python3.9/re.py", line 241, in findall
    return _compile(pattern, flags).findall(string)
TypeError: expected string or bytes-like object
2025-08-14 20:32:14,187 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 20:32:14,193 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 20:36:17,506 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/utils/response_parser.py', reloading
2025-08-14 20:36:17,566 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:36:18,428 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:36:18,622 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:36:18,623 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 20:37:13,684 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 20:37:13,685 [INFO] [root:1574] [inbound_message] Received message from 5511940726493: Ver carrinho
2025-08-14 20:37:13,687 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 20:37:13] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 20:37:13,693 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 20:37:13,695 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Ver carrinho'
2025-08-14 20:37:13,696 [INFO] [root:474] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-14 20:37:13,700 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 20:37:14,430 [ERROR] [root:1478] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1474, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 20:37:14,438 [INFO] [root:1527] [process_message_async] THREAD: Processamento finalizado para 'Ver carrinho'
2025-08-14 20:37:48,898 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 20:37:48,900 [INFO] [root:1574] [inbound_message] Received message from 5511940726493: limpar carrinho
2025-08-14 20:37:48,905 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 20:37:48] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 20:37:48,912 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 20:37:48,913 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'limpar carrinho'
2025-08-14 20:37:48,914 [INFO] [root:456] [get_intent] [llm_interface.py] Comando de limpeza de carrinho detectado
2025-08-14 20:37:48,920 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 20:37:49,510 [ERROR] [root:1478] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1474, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 20:37:49,515 [INFO] [root:1527] [process_message_async] THREAD: Processamento finalizado para 'limpar carrinho'
2025-08-14 20:37:57,377 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 20:37:57,381 [INFO] [root:1574] [inbound_message] Received message from 5511940726493: quero skol
2025-08-14 20:37:57,385 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 20:37:57] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 20:37:57,401 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 20:37:57,402 [INFO] [root:439] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero skol'
2025-08-14 20:37:57,404 [INFO] [root:188] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-14 20:37:57,415 [INFO] [root:193] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 2191 caracteres
2025-08-14 20:37:57,417 [INFO] [root:485] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 2191 caracteres
2025-08-14 20:37:57,423 [INFO] [root:583] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 20:37:57,425 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 20:37:57,429 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f6fb6d5b5b0>
2025-08-14 20:37:57,430 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 20:37:57,431 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 20:37:57,432 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 20:37:57,433 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 20:37:57,434 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 20:38:01,065 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 20:38:01 GMT'), (b'Content-Length', b'315')])
2025-08-14 20:38:01,067 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 20:38:01,068 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 20:38:01,069 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 20:38:01,070 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 20:38:01,070 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 20:38:01,071 [INFO] [root:602] [get_intent] [llm_interface.py] Resposta recebida do LLM em 3.65s
2025-08-14 20:38:01,072 [INFO] [root:614] [get_intent] [llm_interface.py] Resposta do LLM: Excelente conversa!...
2025-08-14 20:38:01,072 [DEBUG] [root:624] [get_intent] [llm_interface.py] Conte√∫do limpo: 
2025-08-14 20:38:01,073 [ERROR] [root:644] [get_intent] [llm_interface.py] Erro ao parsear JSON: Empty content: line 1 column 1 (char 0)
2025-08-14 20:38:02,835 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254981 termos.
2025-08-14 20:38:02,840 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: skol
2025-08-14 20:38:02,919 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 20:38:03,487 [ERROR] [root:1478] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1474, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 20:38:03,503 [INFO] [root:1527] [process_message_async] THREAD: Processamento finalizado para 'quero skol'
2025-08-14 20:45:03,926 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/communication/__init__.py', reloading
2025-08-14 20:45:04,086 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:45:05,307 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:45:05,657 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:45:05,659 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 20:46:17,132 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/utils/response_parser.py', reloading
2025-08-14 20:46:17,223 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:46:18,462 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:46:18,947 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:46:18,953 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 20:47:11,975 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 20:47:12,031 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:47:13,030 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:47:13,251 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:47:13,256 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 20:47:30,768 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 20:47:30,854 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:47:31,821 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:47:32,033 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:47:32,035 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 20:47:47,410 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 20:47:47,492 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:47:48,215 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:47:48,443 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:47:48,448 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 20:48:24,156 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 20:48:24,214 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:48:24,876 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:48:25,104 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:48:25,105 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 20:51:22,008 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-14 20:51:22,067 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 20:51:22,828 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 20:51:23,033 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 20:51:23,034 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 23:15:42,195 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:15:42,196 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 23:15:42,200 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:15:42] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:15:42,203 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:15:42,203 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'meu carrinho'
2025-08-14 23:15:42,205 [INFO] [root:189] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-14 23:15:42,207 [INFO] [root:194] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 2191 caracteres
2025-08-14 23:15:42,208 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 2191 caracteres
2025-08-14 23:15:42,213 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:15:42,215 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:15:42,224 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1fedcd2ee0>
2025-08-14 23:15:42,225 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:15:42,225 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:15:42,226 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:15:42,226 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:15:42,227 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:15:48,029 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:15:48 GMT'), (b'Content-Length', b'356')])
2025-08-14 23:15:48,031 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:15:48,032 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:15:48,033 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:15:48,034 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:15:48,034 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:15:48,035 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 5.82s
2025-08-14 23:15:48,035 [WARNING] [root:613] [get_intent] [llm_interface.py] LLM demorou 5.82s (timeout: 5s)
2025-08-14 23:15:48,036 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "view_cart",
  "parameters": {}
}...
2025-08-14 23:15:48,037 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "view_cart",
  "parameters": {}
}
2025-08-14 23:15:48,038 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'view_cart', 'parameters': {}}
2025-08-14 23:15:48,040 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:15:48,763 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:15:48,772 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 23:16:07,429 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:16:07,430 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: quero cerveja heineken
2025-08-14 23:16:07,432 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:16:07] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:16:07,441 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:16:07,442 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero cerveja heineken'
2025-08-14 23:16:07,443 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 2191 caracteres
2025-08-14 23:16:07,448 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:16:07,449 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:16:07,452 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1fedd27310>
2025-08-14 23:16:07,452 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:16:07,453 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:16:07,453 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:16:07,454 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:16:07,454 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:16:09,366 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:16:09 GMT'), (b'Content-Length', b'416')])
2025-08-14 23:16:09,367 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:16:09,368 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:16:09,369 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:16:09,370 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:16:09,373 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:16:09,375 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.93s
2025-08-14 23:16:09,377 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "get_top_selling_products_by_name",
  "parameters": {
    "product_name": "heineken...
2025-08-14 23:16:09,379 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "get_top_selling_products_by_name",
  "parameters": {
    "product_name": "heineken"
  }
}
2025-08-14 23:16:09,382 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'get_top_selling_products_by_name', 'parameters': {'product_name': 'heineken'}}
2025-08-14 23:16:11,467 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254981 termos.
2025-08-14 23:16:11,473 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: heineken
2025-08-14 23:16:11,533 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:16:12,116 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:16:12,126 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'quero cerveja heineken'
2025-08-14 23:16:26,225 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:16:26,235 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: mais
2025-08-14 23:16:26,255 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:16:26] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:16:26,260 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:16:26,261 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'mais'
2025-08-14 23:16:26,262 [INFO] [root:476] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-14 23:16:26,296 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:16:26,909 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:16:26,923 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'mais'
2025-08-14 23:16:37,439 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:16:37,440 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 4
2025-08-14 23:16:37,441 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:16:37] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:16:37,444 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:16:37,445 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '4'
2025-08-14 23:16:37,449 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:16:38,091 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:16:38,098 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '4'
2025-08-14 23:17:13,306 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:17:13,307 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 6
2025-08-14 23:17:13,310 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:17:13] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:17:13,318 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:17:13,847 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'heineken'
2025-08-14 23:17:13,884 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:17:14,463 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:17:14,479 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '6'
2025-08-14 23:18:09,099 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:18:09,101 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 23:18:09,104 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:18:09] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:18:09,108 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:18:09,109 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'meu carrinho'
2025-08-14 23:18:09,110 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 2191 caracteres
2025-08-14 23:18:09,115 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:18:09,116 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:18:09,119 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1fedd43af0>
2025-08-14 23:18:09,120 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:18:09,120 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:18:09,121 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:18:09,122 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:18:09,127 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:18:10,724 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:18:10 GMT'), (b'Content-Length', b'352')])
2025-08-14 23:18:10,725 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:18:10,727 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:18:10,727 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:18:10,729 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:18:10,729 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:18:10,730 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.61s
2025-08-14 23:18:10,731 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "view_cart",
  "parameters": {}
}...
2025-08-14 23:18:10,732 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "view_cart",
  "parameters": {}
}
2025-08-14 23:18:10,733 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'view_cart', 'parameters': {}}
2025-08-14 23:18:10,742 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:18:11,320 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:18:11,324 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 23:18:29,928 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:18:29,930 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: adiciona mais 4 cervejas no carrinho
2025-08-14 23:18:29,932 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:18:29] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:18:29,940 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:18:29,942 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'adiciona mais 4 cervejas no carrinho'
2025-08-14 23:18:29,943 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 2191 caracteres
2025-08-14 23:18:29,950 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:18:29,957 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:18:29,961 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1fedd271f0>
2025-08-14 23:18:29,962 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:18:29,963 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:18:29,964 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:18:29,965 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:18:29,965 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:18:31,307 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:18:31 GMT'), (b'Content-Length', b'315')])
2025-08-14 23:18:31,312 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:18:31,313 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:18:31,314 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:18:31,315 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:18:31,315 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:18:31,316 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.36s
2025-08-14 23:18:31,317 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: Uma conversa complexa!...
2025-08-14 23:18:31,324 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: 
2025-08-14 23:18:31,325 [ERROR] [root:649] [get_intent] [llm_interface.py] Erro ao parsear JSON: Empty content: line 1 column 1 (char 0)
2025-08-14 23:18:31,345 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:18:31,918 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:18:31,923 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'adiciona mais 4 cervejas no carrinho'
2025-08-14 23:19:17,209 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:19:17,220 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: adiciona mais 3 heineken
2025-08-14 23:19:17,226 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:19:17] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:19:17,231 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:19:17,235 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'adiciona mais 3 heineken'
2025-08-14 23:19:17,237 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 2191 caracteres
2025-08-14 23:19:17,255 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:19:17,257 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:19:17,270 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1fedcbff10>
2025-08-14 23:19:17,271 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:19:17,272 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:19:17,273 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:19:17,274 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:19:17,275 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:19:19,809 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:19:19 GMT'), (b'Content-Length', b'467')])
2025-08-14 23:19:19,810 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:19:19,812 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:19:19,813 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:19:19,813 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:19:19,814 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:19:19,814 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.56s
2025-08-14 23:19:19,815 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "CERVEJA HEINEKEN L.NECK...
2025-08-14 23:19:19,816 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "CERVEJA HEINEKEN L.NECK",
    "action": "add",
    "quantity": 3.0
  }
}
2025-08-14 23:19:19,817 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'smart_cart_update', 'parameters': {'product_name': 'CERVEJA HEINEKEN L.NECK', 'action': 'add', 'quantity': 3.0}}
2025-08-14 23:19:19,818 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:19:19,821 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1fedd94dc0>
2025-08-14 23:19:19,821 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:19:19,822 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:19:19,822 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:19:19,823 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:19:19,823 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:19:21,171 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:19:21 GMT'), (b'Content-Length', b'443')])
2025-08-14 23:19:21,172 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:19:21,173 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:19:21,174 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:19:21,174 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:19:21,175 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:19:21,175 [INFO] [root:1047] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para operation_success: E a√≠! O seu carrinho est√° completo agora. Uma cerv...
2025-08-14 23:19:21,177 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:19:21,753 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:19:21,756 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'adiciona mais 3 heineken'
2025-08-14 23:19:58,428 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:19:58,430 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 23:19:58,432 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:19:58] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:19:58,444 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:19:58,445 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'meu carrinho'
2025-08-14 23:19:58,447 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 2191 caracteres
2025-08-14 23:19:58,452 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:19:58,457 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:19:58,460 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1fedcde070>
2025-08-14 23:19:58,460 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:19:58,461 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:19:58,461 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:19:58,462 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:19:58,462 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:20:02,134 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:20:02 GMT'), (b'Content-Length', b'566')])
2025-08-14 23:20:02,135 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:20:02,136 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:20:02,137 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:20:02,138 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:20:02,138 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:20:02,139 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 3.68s
2025-08-14 23:20:02,139 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "handle_chitchat",
  "parameters": {
    "response_text": "O seu carrinho atual est...
2025-08-14 23:20:02,140 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "handle_chitchat",
  "parameters": {
    "response_text": "O seu carrinho atual est√° com 1 item: CERVEJA HEINEKEN L.NECK 0,0% S/ALCOOL x 6 unidades. O total √© de R$ 39,54. Voc√™ pode finalizar o pedido ou adicionar mais produtos."
  }
}
2025-08-14 23:20:02,141 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'O seu carrinho atual est√° com 1 item: CERVEJA HEINEKEN L.NECK 0,0% S/ALCOOL x 6 unidades. O total √© de R$ 39,54. Voc√™ pode finalizar o pedido ou adicionar mais produtos.'}}
2025-08-14 23:20:02,143 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:20:02,722 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:20:02,726 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 23:20:16,264 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:20:16,265 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 2
2025-08-14 23:20:16,267 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:20:16] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:20:16,271 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:20:16,272 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '2'
2025-08-14 23:20:16,273 [INFO] [root:476] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-14 23:20:16,277 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:20:16,860 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:20:16,864 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '2'
2025-08-14 23:20:28,952 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:20:28,953 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: carrinho
2025-08-14 23:20:28,955 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:20:28] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:20:28,958 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:20:28,959 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'carrinho'
2025-08-14 23:20:28,960 [INFO] [root:476] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-14 23:20:28,964 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:20:29,534 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:20:29,538 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'carrinho'
2025-08-14 23:21:07,819 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:21:07,843 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: adiciona mais 1 cerveja
2025-08-14 23:21:07,859 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:21:07] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:21:07,894 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:21:07,897 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'adiciona mais 1 cerveja'
2025-08-14 23:21:07,898 [INFO] [root:189] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-14 23:21:07,905 [INFO] [root:194] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 2191 caracteres
2025-08-14 23:21:07,907 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 2191 caracteres
2025-08-14 23:21:07,913 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:21:07,915 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:21:07,919 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1fedd94b20>
2025-08-14 23:21:07,920 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:21:07,921 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:21:07,922 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:21:07,923 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:21:07,923 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:21:09,349 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:21:09 GMT'), (b'Content-Length', b'322')])
2025-08-14 23:21:09,349 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:21:09,350 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:21:09,351 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:21:09,351 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:21:09,352 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:21:09,352 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.44s
2025-08-14 23:21:09,353 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: Vamos analisar a situa√ß√£o!...
2025-08-14 23:21:09,353 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: 
2025-08-14 23:21:09,354 [ERROR] [root:649] [get_intent] [llm_interface.py] Erro ao parsear JSON: Empty content: line 1 column 1 (char 0)
2025-08-14 23:21:11,093 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254981 termos.
2025-08-14 23:21:11,099 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'adiciona mais 1 cerveja'
2025-08-14 23:22:10,108 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 203 produtos com similaridade >= 0.8
2025-08-14 23:22:10,111 [INFO] [root:163] [find_product_in_kb] [KB] Busca fuzzy (alta) encontrou 203 produtos para: adiciona mais 1 cerveja
2025-08-14 23:22:10,819 [INFO] [root:352] [fuzzy_search_products] [FUZZY] Busca fuzzy no banco para: 'adiciona mais 1 cerveja'
2025-08-14 23:22:15,809 [INFO] [root:397] [fuzzy_search_products] [FUZZY] Retornando 10 produtos do banco
2025-08-14 23:22:15,820 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:22:16,590 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:22:16,595 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'adiciona mais 1 cerveja'
2025-08-14 23:44:26,882 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:44:26,887 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 23:44:26,891 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:44:26] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:44:26,895 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:44:26,897 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'meu carrinho'
2025-08-14 23:44:26,898 [INFO] [root:189] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-14 23:44:26,900 [INFO] [root:194] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 2745 caracteres
2025-08-14 23:44:26,901 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 2745 caracteres
2025-08-14 23:44:26,908 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:44:26,910 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:44:26,914 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1fedda33a0>
2025-08-14 23:44:26,915 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:44:26,916 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:44:26,916 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:44:26,917 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:44:26,918 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:44:30,938 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:44:30 GMT'), (b'Content-Length', b'356')])
2025-08-14 23:44:30,939 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:44:30,940 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:44:30,941 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:44:30,943 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:44:30,948 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:44:30,954 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.04s
2025-08-14 23:44:30,959 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "show_cart",
  "parameters": {}
}...
2025-08-14 23:44:30,960 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "show_cart",
  "parameters": {}
}
2025-08-14 23:44:30,960 [WARNING] [root:655] [get_intent] [llm_interface.py] Ferramenta inv√°lida: show_cart
2025-08-14 23:44:30,961 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'Tive um problema na consulta agora. Tentar novamente?'}}
2025-08-14 23:44:30,964 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:44:31,726 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:44:31,731 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 23:50:04,398 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:50:04,398 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 23:50:04,400 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:50:04] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:50:04,408 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:50:04,408 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'meu carrinho'
2025-08-14 23:50:04,409 [INFO] [root:189] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-14 23:50:04,411 [INFO] [root:194] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 3234 caracteres
2025-08-14 23:50:04,412 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3234 caracteres
2025-08-14 23:50:04,417 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:50:04,420 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:50:04,422 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1fedda34c0>
2025-08-14 23:50:04,422 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:50:04,423 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:50:04,423 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:50:04,424 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:50:04,424 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:50:08,415 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:50:08 GMT'), (b'Content-Length', b'356')])
2025-08-14 23:50:08,416 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:50:08,417 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:50:08,418 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:50:08,418 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:50:08,419 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:50:08,420 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.00s
2025-08-14 23:50:08,422 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "view_cart",
  "parameters": {}
}...
2025-08-14 23:50:08,423 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "view_cart",
  "parameters": {}
}
2025-08-14 23:50:08,424 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'view_cart', 'parameters': {}}
2025-08-14 23:50:08,427 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:50:09,163 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:50:09,167 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 23:50:20,630 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:50:20,642 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: adiciona mais 1 cerveja
2025-08-14 23:50:20,645 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:50:20] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:50:20,655 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:50:20,657 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'adiciona mais 1 cerveja'
2025-08-14 23:50:20,658 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3234 caracteres
2025-08-14 23:50:20,664 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:50:20,666 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:50:20,669 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1fedd947f0>
2025-08-14 23:50:20,670 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:50:20,670 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:50:20,673 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:50:20,674 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:50:20,675 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:50:22,994 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:50:22 GMT'), (b'Content-Length', b'436')])
2025-08-14 23:50:22,995 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:50:22,997 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:50:22,997 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:50:22,998 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:50:22,998 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:50:22,999 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.33s
2025-08-14 23:50:23,000 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: Analisando a conversa anterior, percebo que o cliente adicionou uma cerveja Heineken 0,0% S/Alcool c...
2025-08-14 23:50:23,002 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: 
2025-08-14 23:50:23,004 [ERROR] [root:649] [get_intent] [llm_interface.py] Erro ao parsear JSON: Empty content: line 1 column 1 (char 0)
2025-08-14 23:50:23,006 [INFO] [root:292] [fuzzy_search_kb] [FUZZY] Iniciando busca fuzzy para: 'adiciona mais 1 cerveja'
2025-08-14 23:50:23,841 [INFO] [root:331] [fuzzy_search_kb] [FUZZY] Encontrados 203 produtos com similaridade >= 0.8
2025-08-14 23:50:23,842 [INFO] [root:163] [find_product_in_kb] [KB] Busca fuzzy (alta) encontrou 203 produtos para: adiciona mais 1 cerveja
2025-08-14 23:50:24,529 [INFO] [root:352] [fuzzy_search_products] [FUZZY] Busca fuzzy no banco para: 'adiciona mais 1 cerveja'
2025-08-14 23:50:24,768 [INFO] [root:397] [fuzzy_search_products] [FUZZY] Retornando 10 produtos do banco
2025-08-14 23:50:24,775 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:50:25,357 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:50:25,362 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'adiciona mais 1 cerveja'
2025-08-14 23:53:44,471 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 23:53:44,670 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 23:53:45,956 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 23:53:46,463 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 23:53:46,466 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 23:56:12,871 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-14 23:56:12,946 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-14 23:56:14,287 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-14 23:56:14,736 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-14 23:56:14,737 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-14 23:56:50,239 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:56:50,241 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 23:56:50,243 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:56:50] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:56:50,247 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:56:50,248 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'meu carrinho'
2025-08-14 23:56:50,250 [INFO] [root:189] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-14 23:56:50,254 [INFO] [root:194] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 3234 caracteres
2025-08-14 23:56:50,256 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3234 caracteres
2025-08-14 23:56:50,265 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:56:50,267 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:56:50,271 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f4d31da72e0>
2025-08-14 23:56:50,272 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:56:50,272 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:56:50,273 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:56:50,274 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:56:50,274 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:56:54,278 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:56:54 GMT'), (b'Content-Length', b'356')])
2025-08-14 23:56:54,280 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:56:54,282 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:56:54,283 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:56:54,284 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:56:54,284 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:56:54,285 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.02s
2025-08-14 23:56:54,286 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "view_cart",
  "parameters": {}
}...
2025-08-14 23:56:54,287 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "view_cart",
  "parameters": {}
}
2025-08-14 23:56:54,288 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'view_cart', 'parameters': {}}
2025-08-14 23:56:54,291 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:56:54,996 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:56:55,010 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 23:57:05,728 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:57:05,729 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: adiciona 1 heineken
2025-08-14 23:57:05,731 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:57:05] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:57:05,735 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:57:05,736 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'adiciona 1 heineken'
2025-08-14 23:57:05,737 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3234 caracteres
2025-08-14 23:57:05,742 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:57:05,744 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:57:05,747 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f4d31e14940>
2025-08-14 23:57:05,747 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:57:05,752 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:57:05,753 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:57:05,754 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:57:05,755 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:57:08,174 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:57:08 GMT'), (b'Content-Length', b'451')])
2025-08-14 23:57:08,175 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:57:08,176 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:57:08,177 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:57:08,177 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:57:08,178 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:57:08,178 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.43s
2025-08-14 23:57:08,179 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "heineken",
    "action"...
2025-08-14 23:57:08,179 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "heineken",
    "action": "add",
    "quantity": 1
  }
}
2025-08-14 23:57:08,180 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'smart_cart_update', 'parameters': {'product_name': 'heineken', 'action': 'add', 'quantity': 1}}
2025-08-14 23:57:08,181 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:57:08,183 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f4d31e14a00>
2025-08-14 23:57:08,184 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:57:08,184 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:57:08,185 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:57:08,186 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:57:08,187 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:57:09,429 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:57:09 GMT'), (b'Content-Length', b'408')])
2025-08-14 23:57:09,430 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:57:09,431 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:57:09,432 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:57:09,432 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:57:09,432 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:57:09,433 [INFO] [root:1098] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para operation_success: Ops! Aqui est√° a atualiza√ß√£o do seu carrinho! Agor...
2025-08-14 23:57:09,435 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:57:10,085 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:57:10,100 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'adiciona 1 heineken'
2025-08-14 23:57:19,253 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:57:19,258 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: remove 5 cerveja
2025-08-14 23:57:19,260 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:57:19] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:57:19,271 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:57:19,271 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'remove 5 cerveja'
2025-08-14 23:57:19,272 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3234 caracteres
2025-08-14 23:57:19,277 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:57:19,279 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:57:19,282 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f4d31e23730>
2025-08-14 23:57:19,287 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:57:19,290 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:57:19,291 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:57:19,292 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:57:19,293 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:57:22,088 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:57:22 GMT'), (b'Content-Length', b'453')])
2025-08-14 23:57:22,089 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:57:22,090 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:57:22,091 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:57:22,092 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:57:22,093 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:57:22,094 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.82s
2025-08-14 23:57:22,095 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "cerveja",
    "action":...
2025-08-14 23:57:22,097 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "cerveja",
    "action": "remove",
    "quantity": 5
  }
}
2025-08-14 23:57:22,098 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'smart_cart_update', 'parameters': {'product_name': 'cerveja', 'action': 'remove', 'quantity': 5}}
2025-08-14 23:57:22,099 [DEBUG] [httpcore.connection:47] [trace] close.started
2025-08-14 23:57:22,100 [DEBUG] [httpcore.connection:47] [trace] close.complete
2025-08-14 23:57:22,100 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:57:22,103 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f4d31e1d850>
2025-08-14 23:57:22,104 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:57:22,105 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:57:22,106 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:57:22,106 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:57:22,107 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:57:23,377 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:57:23 GMT'), (b'Content-Length', b'421')])
2025-08-14 23:57:23,381 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:57:23,383 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:57:23,384 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:57:23,385 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:57:23,386 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:57:23,387 [INFO] [root:1098] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para operation_success: Que tal uma Heineken L. Neck 0,0% s/Alcool? Est√° t...
2025-08-14 23:57:23,395 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:57:23,957 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:57:23,979 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'remove 5 cerveja'
2025-08-14 23:57:32,738 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:57:32,739 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-14 23:57:32,740 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:57:32] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:57:32,744 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:57:32,744 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'meu carrinho'
2025-08-14 23:57:32,745 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3234 caracteres
2025-08-14 23:57:32,751 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:57:32,754 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:57:32,758 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f4d31d793d0>
2025-08-14 23:57:32,759 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:57:32,759 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:57:32,760 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:57:32,761 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:57:32,762 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:57:34,692 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:57:34 GMT'), (b'Content-Length', b'319')])
2025-08-14 23:57:34,693 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:57:34,694 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:57:34,694 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:57:34,695 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:57:34,695 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:57:34,696 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.94s
2025-08-14 23:57:34,697 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: O que podemos fazer aqui?...
2025-08-14 23:57:34,697 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: 
2025-08-14 23:57:34,698 [ERROR] [root:649] [get_intent] [llm_interface.py] Erro ao parsear JSON: Empty content: line 1 column 1 (char 0)
2025-08-14 23:57:34,703 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:57:35,273 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:57:35,278 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-14 23:57:43,947 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:57:43,948 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: quero bala fini
2025-08-14 23:57:43,950 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:57:43] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:57:43,952 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:57:43,953 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero bala fini'
2025-08-14 23:57:43,954 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3234 caracteres
2025-08-14 23:57:43,958 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-14 23:57:43,960 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-14 23:57:43,962 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f4d31d799d0>
2025-08-14 23:57:43,963 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-14 23:57:43,963 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-14 23:57:43,964 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-14 23:57:43,964 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-14 23:57:43,965 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-14 23:57:45,609 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 14 Aug 2025 23:57:45 GMT'), (b'Content-Length', b'346')])
2025-08-14 23:57:45,610 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-14 23:57:45,611 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-14 23:57:45,612 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-14 23:57:45,612 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-14 23:57:45,613 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-14 23:57:45,613 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.65s
2025-08-14 23:57:45,614 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: Ol√°! Vamos analisar a situa√ß√£o atual da conversa....
2025-08-14 23:57:45,614 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: 
2025-08-14 23:57:45,615 [ERROR] [root:649] [get_intent] [llm_interface.py] Erro ao parsear JSON: Empty content: line 1 column 1 (char 0)
2025-08-14 23:57:47,359 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254981 termos.
2025-08-14 23:57:47,364 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: bala fini
2025-08-14 23:57:47,479 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:57:48,060 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:57:48,065 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'quero bala fini'
2025-08-14 23:57:53,092 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:57:53,095 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: mais
2025-08-14 23:57:53,097 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:57:53] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:57:53,101 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:57:53,102 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'mais'
2025-08-14 23:57:53,103 [INFO] [root:476] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-14 23:57:53,123 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:57:53,689 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:57:53,692 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'mais'
2025-08-14 23:57:58,918 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-14 23:57:58,919 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 20
2025-08-14 23:57:58,921 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [14/Aug/2025 23:57:58] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-14 23:57:58,925 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-14 23:57:58,925 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '20'
2025-08-14 23:57:58,929 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-14 23:57:59,508 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-14 23:57:59,512 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '20'
2025-08-15 00:00:00,011 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:00:00,192 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:00:00,978 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:00:01,188 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:00:01,191 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:01:20,519 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:01:20,572 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:01:21,393 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:01:21,584 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:01:21,585 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:03:40,596 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:03:40,597 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: quero bala fini
2025-08-15 00:03:40,599 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:03:40] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:03:40,602 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:03:40,603 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero bala fini'
2025-08-15 00:03:40,605 [INFO] [root:189] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-15 00:03:40,607 [INFO] [root:194] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 3246 caracteres
2025-08-15 00:03:40,608 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3246 caracteres
2025-08-15 00:03:40,613 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 00:03:40,615 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:03:40,617 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f25e3dd2ee0>
2025-08-15 00:03:40,618 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:03:40,618 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:03:40,619 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:03:40,619 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:03:40,620 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:03:45,143 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:03:45 GMT'), (b'Content-Length', b'420')])
2025-08-15 00:03:45,144 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:03:45,145 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:03:45,146 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:03:45,146 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:03:45,147 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:03:45,147 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.53s
2025-08-15 00:03:45,148 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "get_top_selling_products_by_name",
  "parameters": {
    "product_name": "bala fin...
2025-08-15 00:03:45,150 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "get_top_selling_products_by_name",
  "parameters": {
    "product_name": "bala fini"
  }
}
2025-08-15 00:03:45,151 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'get_top_selling_products_by_name', 'parameters': {'product_name': 'bala fini'}}
2025-08-15 00:03:46,882 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254981 termos.
2025-08-15 00:03:46,887 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: bala fini
2025-08-15 00:03:47,013 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:03:47,608 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:03:47,615 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'quero bala fini'
2025-08-15 00:03:55,195 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:03:55,198 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: mais
2025-08-15 00:03:55,200 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:03:55] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:03:55,204 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:03:55,205 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'mais'
2025-08-15 00:03:55,205 [INFO] [root:476] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:03:55,231 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:03:55,798 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:03:55,802 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'mais'
2025-08-15 00:04:00,990 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:04:00,992 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 20
2025-08-15 00:04:00,994 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:04:00] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:04:00,996 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:04:00,997 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '20'
2025-08-15 00:04:00,998 [INFO] [root:476] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:04:01,007 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:04:01,579 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:04:01,584 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '20'
2025-08-15 00:04:07,715 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:04:07,715 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 6
2025-08-15 00:04:07,718 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:04:07] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:04:07,720 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:04:08,249 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'bala fini'
2025-08-15 00:04:08,271 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:04:08,884 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:04:08,889 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '6'
2025-08-15 00:04:17,178 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:04:17,179 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: remove 1 bala
2025-08-15 00:04:17,181 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:04:17] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:04:17,184 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:04:17,184 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'remove 1 bala'
2025-08-15 00:04:17,185 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3246 caracteres
2025-08-15 00:04:17,190 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 00:04:17,193 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:04:17,196 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f25e3e44be0>
2025-08-15 00:04:17,196 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:04:17,197 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:04:17,198 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:04:17,198 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:04:17,199 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:04:19,644 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:04:19 GMT'), (b'Content-Length', b'455')])
2025-08-15 00:04:19,645 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:04:19,646 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:04:19,647 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:04:19,647 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:04:19,648 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:04:19,648 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.46s
2025-08-15 00:04:19,649 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "bala fini",
    "action...
2025-08-15 00:04:19,650 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "bala fini",
    "action": "remove",
    "quantity": 1
  }
}
2025-08-15 00:04:19,650 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'smart_cart_update', 'parameters': {'product_name': 'bala fini', 'action': 'remove', 'quantity': 1}}
2025-08-15 00:04:19,652 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:04:19,654 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f25e3e95df0>
2025-08-15 00:04:19,655 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:04:19,656 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:04:19,657 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:04:19,658 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:04:19,658 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:04:20,904 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:04:20 GMT'), (b'Content-Length', b'423')])
2025-08-15 00:04:20,907 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:04:20,908 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:04:20,909 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:04:20,910 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:04:20,912 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:04:20,914 [INFO] [root:1098] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para operation_success: Uai, seu carrinho est√° mais quentinho agora com 5 ...
2025-08-15 00:04:20,926 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:04:21,502 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:04:21,522 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'remove 1 bala'
2025-08-15 00:04:36,269 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:04:36,270 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-15 00:04:36,272 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:04:36] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:04:36,275 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:04:36,276 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'meu carrinho'
2025-08-15 00:04:36,277 [INFO] [root:490] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3246 caracteres
2025-08-15 00:04:36,282 [INFO] [root:588] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 00:04:36,286 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:04:36,289 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f25e3e442e0>
2025-08-15 00:04:36,290 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:04:36,290 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:04:36,291 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:04:36,291 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:04:36,292 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:04:38,429 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:04:38 GMT'), (b'Content-Length', b'354')])
2025-08-15 00:04:38,430 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:04:38,431 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:04:38,431 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:04:38,432 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:04:38,432 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:04:38,432 [INFO] [root:607] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.15s
2025-08-15 00:04:38,433 [INFO] [root:619] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "view_cart",
  "parameters": {}
}...
2025-08-15 00:04:38,434 [DEBUG] [root:629] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "view_cart",
  "parameters": {}
}
2025-08-15 00:04:38,436 [INFO] [root:680] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'view_cart', 'parameters': {}}
2025-08-15 00:04:38,444 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:04:39,014 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:04:39,019 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-15 00:04:50,215 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:04:50,216 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: ver carrinho
2025-08-15 00:04:50,221 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:04:50] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:04:50,223 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:04:50,224 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'ver carrinho'
2025-08-15 00:04:50,225 [INFO] [root:476] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:04:50,228 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:04:50,804 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:04:50,808 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'ver carrinho'
2025-08-15 00:05:13,543 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:05:13,545 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 1
2025-08-15 00:05:13,547 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:05:13] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:05:13,550 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:05:13,550 [INFO] [root:441] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '1'
2025-08-15 00:05:13,551 [INFO] [root:476] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:05:13,554 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:05:14,146 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:05:14,151 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '1'
2025-08-15 00:06:41,958 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:06:42,044 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:06:43,607 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:06:43,913 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:06:43,914 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:07:49,072 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:07:49,130 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:07:49,849 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:07:50,045 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:07:50,046 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:08:40,430 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:08:40,431 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: ver carrinho
2025-08-15 00:08:40,434 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:08:40] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:08:40,443 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:08:40,444 [INFO] [root:445] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'ver carrinho'
2025-08-15 00:08:40,447 [INFO] [root:480] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:08:40,453 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:08:41,033 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:08:41,042 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'ver carrinho'
2025-08-15 00:08:46,032 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:08:46,034 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 1
2025-08-15 00:08:46,038 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:08:46] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:08:46,043 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:08:46,044 [INFO] [root:445] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '1'
2025-08-15 00:08:46,045 [INFO] [root:480] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:08:46,047 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:08:46,050 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fb0930cbc10>
2025-08-15 00:08:46,051 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:08:46,052 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:08:46,052 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:08:46,053 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:08:46,053 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:08:47,237 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:08:47 GMT'), (b'Content-Length', b'385')])
2025-08-15 00:08:47,238 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:08:47,239 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:08:47,240 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:08:47,240 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:08:47,241 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:08:47,241 [INFO] [root:1112] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para cnpj_request: Opa! Vamos finalizar a compra! Para isso, preciso ...
2025-08-15 00:08:47,243 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:08:47,875 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:08:47,880 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '1'
2025-08-15 00:08:58,203 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:08:58,205 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 12345678910203
2025-08-15 00:08:58,207 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:08:58] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:08:58,211 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:08:58,212 [INFO] [root:445] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '12345678910203'
2025-08-15 00:08:58,213 [INFO] [root:189] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-15 00:08:58,215 [INFO] [root:194] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 3246 caracteres
2025-08-15 00:08:58,216 [INFO] [root:494] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3246 caracteres
2025-08-15 00:08:58,221 [INFO] [root:592] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 00:08:58,223 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:08:58,227 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fb0930dee80>
2025-08-15 00:08:58,228 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:08:58,228 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:08:58,229 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:08:58,230 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:08:58,233 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:09:01,206 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:09:01 GMT'), (b'Content-Length', b'483')])
2025-08-15 00:09:01,206 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:09:01,207 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:09:01,208 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:09:01,208 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:09:01,208 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:09:01,209 [INFO] [root:611] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.99s
2025-08-15 00:09:01,209 [INFO] [root:623] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "handle_chitchat",
  "parameters": {
    "response_text": "Desculpe, mas n√£o entend...
2025-08-15 00:09:01,210 [DEBUG] [root:633] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "handle_chitchat",
  "parameters": {
    "response_text": "Desculpe, mas n√£o entendi que voc√™ digitou. Pode me dizer novamente o que deseja fazer?"
  }
}
2025-08-15 00:09:01,211 [INFO] [root:684] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'Desculpe, mas n√£o entendi que voc√™ digitou. Pode me dizer novamente o que deseja fazer?'}}
2025-08-15 00:09:01,214 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:09:01,907 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:09:01,913 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '12345678910203'
2025-08-15 00:13:04,076 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:13:04,130 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:13:04,794 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:13:04,990 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:13:04,991 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:13:37,804 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:13:37,805 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-15 00:13:37,807 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:13:37] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:13:37,816 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:13:37,817 [INFO] [root:457] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'meu carrinho'
2025-08-15 00:13:37,820 [INFO] [root:201] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-15 00:13:37,822 [INFO] [root:206] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 3246 caracteres
2025-08-15 00:13:37,823 [INFO] [root:506] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3246 caracteres
2025-08-15 00:13:37,829 [INFO] [root:604] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 00:13:37,830 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:13:37,833 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f0f5ffd2eb0>
2025-08-15 00:13:37,834 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:13:37,834 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:13:37,835 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:13:37,835 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:13:37,836 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:13:39,512 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:13:39 GMT'), (b'Content-Length', b'354')])
2025-08-15 00:13:39,513 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:13:39,514 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:13:39,515 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:13:39,515 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:13:39,516 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:13:39,516 [INFO] [root:623] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.69s
2025-08-15 00:13:39,517 [INFO] [root:635] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "view_cart",
  "parameters": {}
}...
2025-08-15 00:13:39,518 [DEBUG] [root:645] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "view_cart",
  "parameters": {}
}
2025-08-15 00:13:39,519 [INFO] [root:696] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'view_cart', 'parameters': {}}
2025-08-15 00:13:39,522 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:13:40,093 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:13:40,103 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-15 00:13:47,045 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:13:47,050 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 1
2025-08-15 00:13:47,055 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:13:47] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:13:47,064 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:13:47,066 [INFO] [root:457] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '1'
2025-08-15 00:13:47,068 [INFO] [root:492] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:13:47,070 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:13:47,077 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f0f5ffbfb50>
2025-08-15 00:13:47,079 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:13:47,080 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:13:47,081 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:13:47,082 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:13:47,084 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:13:48,852 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:13:48 GMT'), (b'Content-Length', b'507')])
2025-08-15 00:13:48,859 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:13:48,864 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:13:48,872 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:13:48,875 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:13:48,878 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:13:48,879 [INFO] [root:1124] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para cnpj_request: Olha s√≥! Para finalizar sua compra, √© necess√°rio e...
2025-08-15 00:13:48,884 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:13:49,669 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:13:49,701 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '1'
2025-08-15 00:14:06,083 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:14:06,084 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 12365562103231
2025-08-15 00:14:06,087 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:14:06] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:14:06,090 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:14:06,091 [INFO] [root:457] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '12365562103231'
2025-08-15 00:14:06,093 [INFO] [root:506] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3246 caracteres
2025-08-15 00:14:06,099 [INFO] [root:604] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 00:14:06,101 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:14:06,104 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f0f60044850>
2025-08-15 00:14:06,104 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:14:06,105 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:14:06,105 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:14:06,106 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:14:06,107 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:14:09,066 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:14:09 GMT'), (b'Content-Length', b'479')])
2025-08-15 00:14:09,067 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:14:09,068 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:14:09,069 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:14:09,070 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:14:09,070 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:14:09,070 [INFO] [root:623] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.97s
2025-08-15 00:14:09,071 [INFO] [root:635] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "handle_chitchat", 
  "parameters": {
    "response_text": "Desculpe, mas n√£o enten...
2025-08-15 00:14:09,072 [DEBUG] [root:645] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "handle_chitchat", 
  "parameters": {
    "response_text": "Desculpe, mas n√£o entendi esse n√∫mero. Pode me dizer novamente o que deseja fazer?"
  }
}
2025-08-15 00:14:09,072 [INFO] [root:696] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'Desculpe, mas n√£o entendi esse n√∫mero. Pode me dizer novamente o que deseja fazer?'}}
2025-08-15 00:14:09,075 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:14:09,682 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:14:09,688 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '12365562103231'
2025-08-15 00:14:19,408 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:14:19,409 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 3
2025-08-15 00:14:19,411 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:14:19] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:14:19,414 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:14:19,414 [INFO] [root:457] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '3'
2025-08-15 00:14:19,415 [INFO] [root:492] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:14:19,448 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:14:20,030 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:14:20,039 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '3'
2025-08-15 00:17:55,558 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:17:55,623 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:17:56,271 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:17:56,467 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:17:56,471 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:19:35,964 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:19:36,022 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:19:36,674 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:19:36,869 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:19:36,870 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:20:18,576 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:20:18,651 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:20:19,364 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:20:19,569 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:20:19,571 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:22:14,018 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:22:14,019 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: ver carrinho
2025-08-15 00:22:14,021 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:22:14] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:22:14,025 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:22:14,026 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'ver carrinho'
2025-08-15 00:22:14,027 [INFO] [root:493] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:22:14,036 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:22:14,774 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:22:14,796 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'ver carrinho'
2025-08-15 00:22:54,265 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:22:54,267 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: finalizar
2025-08-15 00:22:54,269 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:22:54] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:22:54,275 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:22:54,275 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'finalizar'
2025-08-15 00:22:54,277 [INFO] [root:493] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:22:54,280 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:22:54,287 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fa17dac07f0>
2025-08-15 00:22:54,287 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:22:54,288 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:22:54,289 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:22:54,289 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:22:54,290 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:22:57,706 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:22:57 GMT'), (b'Content-Length', b'440')])
2025-08-15 00:22:57,707 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:22:57,708 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:22:57,708 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:22:57,709 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:22:57,709 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:22:57,710 [INFO] [root:1129] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para cnpj_request: Tudo bem com seu carrinho! Quer continuar? Opa! Pr...
2025-08-15 00:22:57,713 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:22:58,292 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:22:58,297 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'finalizar'
2025-08-15 00:23:18,112 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:23:18,120 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 10203256412356
2025-08-15 00:23:18,122 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:23:18] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:23:18,132 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:23:18,133 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '10203256412356'
2025-08-15 00:23:18,135 [INFO] [root:202] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-15 00:23:18,138 [INFO] [root:207] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 3246 caracteres
2025-08-15 00:23:18,139 [INFO] [root:507] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3246 caracteres
2025-08-15 00:23:18,145 [INFO] [root:605] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 00:23:18,146 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:23:18,149 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fa17dacbd90>
2025-08-15 00:23:18,150 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:23:18,150 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:23:18,151 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:23:18,152 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:23:18,152 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:23:21,141 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:23:21 GMT'), (b'Content-Length', b'488')])
2025-08-15 00:23:21,142 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:23:21,146 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:23:21,155 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:23:21,156 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:23:21,158 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:23:21,161 [INFO] [root:624] [get_intent] [llm_interface.py] Resposta recebida do LLM em 3.02s
2025-08-15 00:23:21,164 [INFO] [root:636] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "handle_chitchat",
  "parameters": {
    "response_text": "Desculpe, mas n√£o entend...
2025-08-15 00:23:21,166 [DEBUG] [root:646] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "handle_chitchat",
  "parameters": {
    "response_text": "Desculpe, mas n√£o entendi esse n√∫mero como CNPJ. Pode me dizer novamente o que deseja fazer?"
  }
}
2025-08-15 00:23:21,168 [INFO] [root:697] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'Desculpe, mas n√£o entendi esse n√∫mero como CNPJ. Pode me dizer novamente o que deseja fazer?'}}
2025-08-15 00:23:21,199 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:23:21,779 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:23:21,796 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '10203256412356'
2025-08-15 00:23:56,145 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:23:56,147 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 3
2025-08-15 00:23:56,149 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:23:56] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:23:56,153 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:23:56,154 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '3'
2025-08-15 00:23:56,156 [INFO] [root:493] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:23:56,158 [DEBUG] [httpcore.connection:47] [trace] close.started
2025-08-15 00:23:56,159 [DEBUG] [httpcore.connection:47] [trace] close.complete
2025-08-15 00:23:56,160 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:23:56,163 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fa17db27520>
2025-08-15 00:23:56,164 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:23:56,165 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:23:56,165 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:23:56,166 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:23:56,166 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:23:57,858 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:23:57 GMT'), (b'Content-Length', b'490')])
2025-08-15 00:23:57,859 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:23:57,860 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:23:57,861 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:23:57,861 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:23:57,862 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:23:57,862 [INFO] [root:1129] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para cnpj_request: Perfeito! Estamos quase l√°! Voc√™ ainda tem 2 itens...
2025-08-15 00:23:57,865 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:23:58,440 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:23:58,444 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '3'
2025-08-15 00:24:16,979 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:24:16,980 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 12345678000195
2025-08-15 00:24:16,982 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:24:16] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:24:16,986 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:24:16,986 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '12345678000195'
2025-08-15 00:24:16,987 [INFO] [root:467] [get_intent] [llm_interface.py] CNPJ detectado em contexto de checkout
2025-08-15 00:24:16,996 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:24:17,568 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:24:17,572 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '12345678000195'
2025-08-15 00:30:00,538 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:30:00,539 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: Oi
2025-08-15 00:30:00,542 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:30:00] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:30:00,545 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:30:00,547 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Oi'
2025-08-15 00:30:00,548 [INFO] [root:493] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:30:00,551 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:30:01,269 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:30:01,274 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-15 00:34:29,666 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:34:29,668 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: Oi
2025-08-15 00:34:29,673 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:34:29] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:34:29,676 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:34:29,677 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Oi'
2025-08-15 00:34:29,678 [INFO] [root:493] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:34:29,681 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:34:30,269 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:34:30,273 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-15 00:34:37,997 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:34:38,002 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: Quero comprar fini
2025-08-15 00:34:38,006 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:34:38] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:34:38,010 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:34:38,010 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Quero comprar fini'
2025-08-15 00:34:38,012 [INFO] [root:202] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-15 00:34:38,014 [INFO] [root:207] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 3246 caracteres
2025-08-15 00:34:38,015 [INFO] [root:507] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3246 caracteres
2025-08-15 00:34:38,021 [INFO] [root:605] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 00:34:38,023 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:34:38,026 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fa17db27310>
2025-08-15 00:34:38,027 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:34:38,027 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:34:38,028 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:34:38,029 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:34:38,031 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:34:42,973 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:34:42 GMT'), (b'Content-Length', b'522')])
2025-08-15 00:34:42,974 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:34:42,975 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:34:42,976 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:34:42,976 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:34:42,977 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:34:42,977 [INFO] [root:624] [get_intent] [llm_interface.py] Resposta recebida do LLM em 4.95s
2025-08-15 00:34:42,978 [INFO] [root:636] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "handle_chitchat",
  "parameters": {
    "response_text": "N√£o, voc√™ n√£o est√° mais ...
2025-08-15 00:34:42,979 [DEBUG] [root:646] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "handle_chitchat",
  "parameters": {
    "response_text": "N√£o, voc√™ n√£o est√° mais no processo de compra. Voc√™ pode continuar explorando produtos ou finalizar pedido quando quiser."
  }
}
2025-08-15 00:34:42,981 [INFO] [root:697] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'N√£o, voc√™ n√£o est√° mais no processo de compra. Voc√™ pode continuar explorando produtos ou finalizar pedido quando quiser.'}}
2025-08-15 00:34:42,984 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:34:43,565 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:34:43,583 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'Quero comprar fini'
2025-08-15 00:35:03,317 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:35:03,325 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-15 00:35:03,329 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:35:03] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:35:03,343 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:35:03,351 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'meu carrinho'
2025-08-15 00:35:03,354 [INFO] [root:507] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3246 caracteres
2025-08-15 00:35:03,360 [INFO] [root:605] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 00:35:03,366 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:35:03,376 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fa17dba3700>
2025-08-15 00:35:03,379 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:35:03,386 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:35:03,391 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:35:03,393 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:35:03,394 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:35:04,827 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:35:04 GMT'), (b'Content-Length', b'353')])
2025-08-15 00:35:04,828 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:35:04,828 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:35:04,829 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:35:04,829 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:35:04,830 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:35:04,830 [INFO] [root:624] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.47s
2025-08-15 00:35:04,831 [INFO] [root:636] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "view_cart",
  "parameters": {}
}...
2025-08-15 00:35:04,832 [DEBUG] [root:646] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "view_cart",
  "parameters": {}
}
2025-08-15 00:35:04,832 [INFO] [root:697] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'view_cart', 'parameters': {}}
2025-08-15 00:35:04,851 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:35:05,457 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:35:05,478 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-15 00:35:13,893 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:35:13,894 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: quero fini
2025-08-15 00:35:13,895 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:35:13] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:35:13,899 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:35:13,900 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero fini'
2025-08-15 00:35:13,901 [INFO] [root:507] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3246 caracteres
2025-08-15 00:35:13,906 [INFO] [root:605] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 00:35:13,908 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:35:13,913 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fa17daf7bb0>
2025-08-15 00:35:13,914 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:35:13,915 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:35:13,916 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:35:13,916 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:35:13,917 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:35:15,623 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:35:15 GMT'), (b'Content-Length', b'403')])
2025-08-15 00:35:15,626 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:35:15,627 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:35:15,627 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:35:15,628 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:35:15,628 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:35:15,629 [INFO] [root:624] [get_intent] [llm_interface.py] Resposta recebida do LLM em 1.72s
2025-08-15 00:35:15,630 [INFO] [root:636] [get_intent] [llm_interface.py] Resposta do LLM: Sinto muito, mas n√£o consegui processar sua solicita√ß√£o devido ao erro anterior. Vamos come√ßar novam...
2025-08-15 00:35:15,631 [DEBUG] [root:646] [get_intent] [llm_interface.py] Conte√∫do limpo: 
2025-08-15 00:35:15,632 [ERROR] [root:666] [get_intent] [llm_interface.py] Erro ao parsear JSON: Empty content: line 1 column 1 (char 0)
2025-08-15 00:35:17,374 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254981 termos.
2025-08-15 00:35:17,380 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: fini
2025-08-15 00:35:17,520 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:35:18,092 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:35:18,099 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'quero fini'
2025-08-15 00:35:29,539 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:35:29,540 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: mais
2025-08-15 00:35:29,544 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:35:29] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:35:29,551 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:35:29,551 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'mais'
2025-08-15 00:35:29,552 [INFO] [root:493] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:35:29,575 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:35:30,166 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:35:30,170 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'mais'
2025-08-15 00:35:39,913 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:35:39,914 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 19
2025-08-15 00:35:39,917 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:35:39] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:35:39,921 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:35:39,922 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '19'
2025-08-15 00:35:39,923 [INFO] [root:493] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:35:39,927 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:35:40,504 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:35:40,509 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '19'
2025-08-15 00:35:46,412 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:35:46,413 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: 5
2025-08-15 00:35:46,416 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:35:46] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:35:46,422 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:35:46,987 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'fini'
2025-08-15 00:35:47,017 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:35:47,585 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:35:47,609 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para '5'
2025-08-15 00:36:02,353 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:36:02,354 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: adiciona mais 5 fini
2025-08-15 00:36:02,356 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:36:02] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:36:02,359 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:36:02,360 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'adiciona mais 5 fini'
2025-08-15 00:36:02,361 [INFO] [root:507] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3246 caracteres
2025-08-15 00:36:02,365 [INFO] [root:605] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 00:36:02,367 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:36:02,369 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fa17db9d250>
2025-08-15 00:36:02,370 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:36:02,371 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:36:02,372 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:36:02,372 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:36:02,373 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:36:04,783 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:36:04 GMT'), (b'Content-Length', b'454')])
2025-08-15 00:36:04,783 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:36:04,785 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:36:04,785 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:36:04,786 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:36:04,786 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:36:04,787 [INFO] [root:624] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.42s
2025-08-15 00:36:04,788 [INFO] [root:636] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "BALA FINI",
    "action...
2025-08-15 00:36:04,788 [DEBUG] [root:646] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "BALA FINI",
    "action": "add",
    "quantity": 5.0
  }
}
2025-08-15 00:36:04,789 [INFO] [root:697] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'smart_cart_update', 'parameters': {'product_name': 'BALA FINI', 'action': 'add', 'quantity': 5.0}}
2025-08-15 00:36:04,791 [DEBUG] [httpcore.connection:47] [trace] close.started
2025-08-15 00:36:04,791 [DEBUG] [httpcore.connection:47] [trace] close.complete
2025-08-15 00:36:04,792 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 00:36:04,794 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fa17dba36a0>
2025-08-15 00:36:04,795 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 00:36:04,796 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 00:36:04,796 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 00:36:04,797 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 00:36:04,797 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 00:36:06,331 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 00:36:06 GMT'), (b'Content-Length', b'433')])
2025-08-15 00:36:06,332 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 00:36:06,332 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 00:36:06,333 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 00:36:06,333 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 00:36:06,334 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 00:36:06,334 [INFO] [root:1129] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para operation_success: Que tal? Adicionei mais 5 BALA FINI MARSH.TORCAO R...
2025-08-15 00:36:06,337 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:36:06,902 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:36:06,907 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'adiciona mais 5 fini'
2025-08-15 00:36:18,042 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:36:18,048 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: ver carrinho
2025-08-15 00:36:18,054 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:36:18] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:36:18,065 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:36:18,069 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'ver carrinho'
2025-08-15 00:36:18,071 [INFO] [root:493] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 00:36:18,081 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:36:18,660 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:36:18,674 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'ver carrinho'
2025-08-15 00:36:29,757 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 00:36:29,759 [INFO] [root:1569] [inbound_message] Received message from 5511940726493: limpar carrinho
2025-08-15 00:36:29,761 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 00:36:29] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 00:36:29,765 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 00:36:29,766 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'limpar carrinho'
2025-08-15 00:36:29,767 [INFO] [root:475] [get_intent] [llm_interface.py] Comando de limpeza de carrinho detectado
2025-08-15 00:36:29,773 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 00:36:30,346 [ERROR] [root:1473] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1469, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 00:36:30,352 [INFO] [root:1522] [process_message_async] THREAD: Processamento finalizado para 'limpar carrinho'
2025-08-15 00:44:39,372 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:44:39,439 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:44:40,107 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:44:40,310 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:44:40,313 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:45:08,203 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:45:08,281 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:45:09,215 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:45:09,418 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:45:09,419 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:46:37,758 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-15 00:46:37,813 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:46:38,483 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:46:38,736 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:46:38,737 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:47:56,725 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:47:56,786 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:47:58,194 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:47:58,533 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:47:58,535 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 00:48:05,066 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 00:48:05,128 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 00:48:06,465 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 00:48:06,894 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 00:48:06,895 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 11:03:20,976 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:03:20,977 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: Oi
2025-08-15 11:03:20,980 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:03:20] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:03:20,984 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:03:20,987 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Oi'
2025-08-15 11:03:20,990 [INFO] [root:491] [get_intent] [llm_interface.py] Sauda√ß√£o detectada, usando handle_chitchat
2025-08-15 11:03:20,994 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:03:20,998 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b03f820>
2025-08-15 11:03:20,999 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:03:20,999 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:03:21,000 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:03:21,001 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:03:21,001 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:03:25,951 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:03:25 GMT'), (b'Content-Length', b'328')])
2025-08-15 11:03:25,953 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:03:25,954 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:03:25,955 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:03:25,955 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:03:25,956 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:03:25,956 [INFO] [root:1174] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para greeting: E a√≠, como posso te ajudar hoje?...
2025-08-15 11:03:25,958 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:03:27,935 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:03:27,943 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-15 11:06:07,190 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:06:07,193 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: ver carrinho
2025-08-15 11:06:07,195 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:06:07] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:06:07,199 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:06:07,201 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'ver carrinho'
2025-08-15 11:06:07,203 [INFO] [root:510] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 11:06:07,211 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:06:08,364 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:06:08,370 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'ver carrinho'
2025-08-15 11:06:29,576 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:06:29,577 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: quero comprar omo
2025-08-15 11:06:29,582 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:06:29] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:06:29,588 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:06:29,590 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero comprar omo'
2025-08-15 11:06:29,592 [INFO] [root:525] [get_intent] [llm_interface.py] Busca de produto detectada, usando fallback especializado
2025-08-15 11:06:31,717 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254981 termos.
2025-08-15 11:06:31,723 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: omo
2025-08-15 11:06:31,869 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:06:33,320 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:06:33,324 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'quero comprar omo'
2025-08-15 11:06:58,863 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:06:58,864 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: mais
2025-08-15 11:06:58,866 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:06:58] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:06:58,871 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:06:58,872 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'mais'
2025-08-15 11:06:58,873 [INFO] [root:510] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 11:06:58,901 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:07:00,296 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:07:00,299 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'mais'
2025-08-15 11:07:27,526 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:07:27,529 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: 17
2025-08-15 11:07:27,531 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:07:27] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:07:27,538 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:07:27,539 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '17'
2025-08-15 11:07:27,540 [INFO] [root:510] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 11:07:27,546 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:07:29,004 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:07:29,008 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para '17'
2025-08-15 11:07:42,421 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:07:42,422 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: 15
2025-08-15 11:07:42,424 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:07:42] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:07:42,429 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:07:42,620 [INFO] [root:258] [update_kb] Adicionado termo 'omo' ao produto DT.PO OMO LAVAGEM PERF.SANIT.& HIGIE.CT
2025-08-15 11:07:43,014 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'omo'
2025-08-15 11:07:43,040 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:07:44,490 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:07:44,497 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para '15'
2025-08-15 11:09:05,058 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:09:05,060 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: Adiciona mais 5 omo
2025-08-15 11:09:05,062 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:09:05] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:09:05,067 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:09:05,068 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Adiciona mais 5 omo'
2025-08-15 11:09:05,070 [INFO] [root:202] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-15 11:09:05,072 [INFO] [root:207] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 3592 caracteres
2025-08-15 11:09:05,073 [INFO] [root:537] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3592 caracteres
2025-08-15 11:09:05,079 [INFO] [root:635] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 11:09:05,081 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:09:05,086 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b0a9e80>
2025-08-15 11:09:05,087 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:09:05,088 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:09:05,089 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:09:05,090 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:09:05,091 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:09:10,707 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:09:10 GMT'), (b'Content-Length', b'448')])
2025-08-15 11:09:10,709 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:09:10,710 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:09:10,712 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:09:10,713 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:09:10,714 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:09:10,715 [INFO] [root:654] [get_intent] [llm_interface.py] Resposta recebida do LLM em 5.64s
2025-08-15 11:09:10,717 [WARNING] [root:660] [get_intent] [llm_interface.py] LLM demorou 5.64s (timeout: 5s)
2025-08-15 11:09:10,718 [INFO] [root:666] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "omo",
    "action": "ad...
2025-08-15 11:09:10,719 [DEBUG] [root:676] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "omo",
    "action": "add",
    "quantity": 5
  }
}
2025-08-15 11:09:10,721 [INFO] [root:727] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'smart_cart_update', 'parameters': {'product_name': 'omo', 'action': 'add', 'quantity': 5}}
2025-08-15 11:09:10,722 [DEBUG] [httpcore.connection:47] [trace] close.started
2025-08-15 11:09:10,723 [DEBUG] [httpcore.connection:47] [trace] close.complete
2025-08-15 11:09:10,724 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:09:10,728 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b125b50>
2025-08-15 11:09:10,730 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:09:10,731 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:09:10,733 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:09:10,734 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:09:10,735 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:09:13,204 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:09:13 GMT'), (b'Content-Length', b'459')])
2025-08-15 11:09:13,205 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:09:13,207 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:09:13,208 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:09:13,209 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:09:13,209 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:09:13,210 [INFO] [root:1174] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para operation_success: Opa! Perfeito! Agora temos 20 DT.PO OMO LAVAGEM PE...
2025-08-15 11:09:13,215 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:09:14,446 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:09:14,450 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'Adiciona mais 5 omo'
2025-08-15 11:09:36,064 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:09:36,066 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: meu carrinho
2025-08-15 11:09:36,069 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:09:36] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:09:36,074 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:09:36,075 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'meu carrinho'
2025-08-15 11:09:36,076 [INFO] [root:510] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 11:09:36,083 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:09:37,020 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:09:37,024 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'meu carrinho'
2025-08-15 11:09:56,922 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:09:56,923 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: retira 10 omo do carrinho
2025-08-15 11:09:56,925 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:09:56] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:09:56,928 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:09:56,928 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'retira 10 omo do carrinho'
2025-08-15 11:09:56,929 [INFO] [root:537] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3592 caracteres
2025-08-15 11:09:56,934 [INFO] [root:635] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 11:09:56,936 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:09:56,940 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b11bd00>
2025-08-15 11:09:56,940 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:09:56,941 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:09:56,941 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:09:56,942 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:09:56,942 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:10:00,417 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:10:00 GMT'), (b'Content-Length', b'450')])
2025-08-15 11:10:00,418 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:10:00,419 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:10:00,420 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:10:00,421 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:10:00,422 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:10:00,422 [INFO] [root:654] [get_intent] [llm_interface.py] Resposta recebida do LLM em 3.49s
2025-08-15 11:10:00,423 [INFO] [root:666] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "omo",
    "action": "re...
2025-08-15 11:10:00,424 [DEBUG] [root:676] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "omo",
    "action": "remove",
    "quantity": 10
  }
}
2025-08-15 11:10:00,425 [INFO] [root:727] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'smart_cart_update', 'parameters': {'product_name': 'omo', 'action': 'remove', 'quantity': 10}}
2025-08-15 11:10:00,426 [DEBUG] [httpcore.connection:47] [trace] close.started
2025-08-15 11:10:00,427 [DEBUG] [httpcore.connection:47] [trace] close.complete
2025-08-15 11:10:00,428 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:10:00,432 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b110400>
2025-08-15 11:10:00,432 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:10:00,433 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:10:00,434 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:10:00,435 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:10:00,436 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:10:02,648 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:10:02 GMT'), (b'Content-Length', b'448')])
2025-08-15 11:10:02,649 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:10:02,650 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:10:02,650 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:10:02,651 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:10:02,652 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:10:02,652 [INFO] [root:1174] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para operation_success: Que tal?! Sua opera√ß√£o deu certo! Agora temos 10 u...
2025-08-15 11:10:02,656 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:10:03,480 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:10:03,489 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'retira 10 omo do carrinho'
2025-08-15 11:10:22,232 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:10:22,233 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: bala fini
2025-08-15 11:10:22,234 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:10:22] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:10:22,239 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:10:22,239 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'bala fini'
2025-08-15 11:10:22,240 [INFO] [root:537] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3592 caracteres
2025-08-15 11:10:22,245 [INFO] [root:635] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 11:10:22,246 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:10:22,251 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b0a9280>
2025-08-15 11:10:22,251 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:10:22,252 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:10:22,253 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:10:22,254 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:10:22,255 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:10:25,315 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:10:25 GMT'), (b'Content-Length', b'418')])
2025-08-15 11:10:25,316 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:10:25,317 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:10:25,318 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:10:25,319 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:10:25,319 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:10:25,320 [INFO] [root:654] [get_intent] [llm_interface.py] Resposta recebida do LLM em 3.07s
2025-08-15 11:10:25,320 [INFO] [root:666] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "get_top_selling_products_by_name",
  "parameters": {
    "product_name": "bala fin...
2025-08-15 11:10:25,321 [DEBUG] [root:676] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "get_top_selling_products_by_name",
  "parameters": {
    "product_name": "bala fini"
  }
}
2025-08-15 11:10:25,322 [INFO] [root:727] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'get_top_selling_products_by_name', 'parameters': {'product_name': 'bala fini'}}
2025-08-15 11:10:27,247 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254971 termos.
2025-08-15 11:10:27,254 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: bala fini
2025-08-15 11:10:27,390 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:10:28,189 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:10:28,192 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'bala fini'
2025-08-15 11:10:47,736 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:10:47,738 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: 9
2025-08-15 11:10:47,740 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:10:47] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:10:47,744 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:10:47,744 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '9'
2025-08-15 11:10:47,746 [INFO] [root:510] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 11:10:47,754 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:10:48,492 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:10:48,495 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para '9'
2025-08-15 11:11:08,205 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:11:08,206 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: 6
2025-08-15 11:11:08,208 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:11:08] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:11:08,211 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:11:08,766 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'bala fini'
2025-08-15 11:11:08,805 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:11:09,452 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:11:09,455 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para '6'
2025-08-15 11:11:33,842 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:11:33,843 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: finalizar
2025-08-15 11:11:33,845 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:11:33] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:11:33,851 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:11:33,852 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'finalizar'
2025-08-15 11:11:33,853 [INFO] [root:510] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 11:11:33,854 [DEBUG] [httpcore.connection:47] [trace] close.started
2025-08-15 11:11:33,855 [DEBUG] [httpcore.connection:47] [trace] close.complete
2025-08-15 11:11:33,855 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:11:33,859 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b110be0>
2025-08-15 11:11:33,859 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:11:33,860 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:11:33,861 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:11:33,861 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:11:33,862 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:11:35,046 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:11:35 GMT'), (b'Content-Length', b'368')])
2025-08-15 11:11:35,047 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:11:35,048 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:11:35,049 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:11:35,049 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:11:35,050 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:11:35,051 [INFO] [root:1174] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para cnpj_request: Que tal? Preciso apenas do CNPJ seu para finalizar...
2025-08-15 11:11:35,054 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:11:35,766 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:11:35,783 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'finalizar'
2025-08-15 11:11:57,147 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:11:57,148 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: ver carrinho
2025-08-15 11:11:57,150 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:11:57] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:11:57,154 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:11:57,155 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'ver carrinho'
2025-08-15 11:11:57,156 [INFO] [root:510] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 11:11:57,159 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:11:57,809 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:11:57,812 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'ver carrinho'
2025-08-15 11:13:57,338 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:13:57,339 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: remove 1 fini do carrinho
2025-08-15 11:13:57,341 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:13:57] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:13:57,344 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:13:57,344 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'remove 1 fini do carrinho'
2025-08-15 11:13:57,345 [INFO] [root:537] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3592 caracteres
2025-08-15 11:13:57,351 [INFO] [root:635] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 11:13:57,352 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:13:57,355 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b11ba60>
2025-08-15 11:13:57,356 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:13:57,356 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:13:57,357 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:13:57,357 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:13:57,358 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:14:01,121 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:14:01 GMT'), (b'Content-Length', b'472')])
2025-08-15 11:14:01,122 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:14:01,123 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:14:01,124 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:14:01,124 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:14:01,125 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:14:01,126 [INFO] [root:654] [get_intent] [llm_interface.py] Resposta recebida do LLM em 3.77s
2025-08-15 11:14:01,126 [INFO] [root:666] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "BALA FINI GELATINA POLV...
2025-08-15 11:14:01,127 [DEBUG] [root:676] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "smart_cart_update",
  "parameters": {
    "product_name": "BALA FINI GELATINA POLVO",
    "action": "remove",
    "quantity": 1.0
  }
}
2025-08-15 11:14:01,127 [INFO] [root:727] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'smart_cart_update', 'parameters': {'product_name': 'BALA FINI GELATINA POLVO', 'action': 'remove', 'quantity': 1.0}}
2025-08-15 11:14:01,129 [DEBUG] [httpcore.connection:47] [trace] close.started
2025-08-15 11:14:01,129 [DEBUG] [httpcore.connection:47] [trace] close.complete
2025-08-15 11:14:01,130 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:14:01,133 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b0bee80>
2025-08-15 11:14:01,133 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:14:01,134 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:14:01,135 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:14:01,135 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:14:01,136 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:14:02,462 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:14:02 GMT'), (b'Content-Length', b'390')])
2025-08-15 11:14:02,463 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:14:02,464 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:14:02,465 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:14:02,466 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:14:02,466 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:14:02,467 [INFO] [root:1174] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para operation_success: Que legal! O carrinho do seu pedido foi atualizado...
2025-08-15 11:14:02,470 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:14:03,064 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:14:03,068 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'remove 1 fini do carrinho'
2025-08-15 11:14:23,448 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:14:23,451 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: ver carrinho
2025-08-15 11:14:23,453 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:14:23] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:14:23,456 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:14:23,456 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'ver carrinho'
2025-08-15 11:14:23,457 [INFO] [root:510] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 11:14:23,462 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:14:24,060 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:14:24,065 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'ver carrinho'
2025-08-15 11:14:36,022 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:14:36,023 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: fechar pedido
2025-08-15 11:14:36,026 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:14:36] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:14:36,029 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:14:36,030 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'fechar pedido'
2025-08-15 11:14:36,035 [INFO] [root:202] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-15 11:14:36,039 [INFO] [root:207] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 3592 caracteres
2025-08-15 11:14:36,040 [INFO] [root:537] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3592 caracteres
2025-08-15 11:14:36,045 [INFO] [root:635] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 11:14:36,047 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:14:36,052 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b072970>
2025-08-15 11:14:36,053 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:14:36,053 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:14:36,054 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:14:36,054 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:14:36,055 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:14:39,813 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:14:39 GMT'), (b'Content-Length', b'484')])
2025-08-15 11:14:39,814 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:14:39,815 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:14:39,816 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:14:39,816 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:14:39,817 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:14:39,818 [INFO] [root:654] [get_intent] [llm_interface.py] Resposta recebida do LLM em 3.77s
2025-08-15 11:14:39,818 [INFO] [root:666] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "handle_chitchat", 
  "parameters": {
    "response_text": "Preciso apenas do CNPJ ...
2025-08-15 11:14:39,819 [DEBUG] [root:676] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "handle_chitchat", 
  "parameters": {
    "response_text": "Preciso apenas do CNPJ seu para finalizar a compra com seguran√ßa! Por favor, forne√ßa-o."
  }
}
2025-08-15 11:14:39,820 [INFO] [root:727] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'Preciso apenas do CNPJ seu para finalizar a compra com seguran√ßa! Por favor, forne√ßa-o.'}}
2025-08-15 11:14:39,824 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:14:40,580 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:14:40,587 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'fechar pedido'
2025-08-15 11:14:54,937 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:14:54,938 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: 12345678910203
2025-08-15 11:14:54,940 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:14:54] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:14:54,942 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:14:54,943 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '12345678910203'
2025-08-15 11:14:54,944 [INFO] [root:467] [get_intent] [llm_interface.py] CNPJ detectado em contexto de checkout
2025-08-15 11:14:54,953 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:14:55,513 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:14:55,520 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para '12345678910203'
2025-08-15 11:15:31,577 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:15:31,578 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: quero cerveja
2025-08-15 11:15:31,581 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:15:31] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:15:31,592 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:15:31,593 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'quero cerveja'
2025-08-15 11:15:31,596 [INFO] [root:525] [get_intent] [llm_interface.py] Busca de produto detectada, usando fallback especializado
2025-08-15 11:15:33,424 [INFO] [root:101] [_load_kb] Base de conhecimento '/app/knowledge/knowledge_base.json' carregada com 15970 produtos e 254971 termos.
2025-08-15 11:15:33,429 [INFO] [root:156] [find_product_in_kb] [KB] Busca exata encontrou: cerveja
2025-08-15 11:15:34,062 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:15:34,635 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:15:34,638 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'quero cerveja'
2025-08-15 11:15:39,627 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:15:39,628 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: mais
2025-08-15 11:15:39,630 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:15:39] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:15:39,638 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:15:39,639 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'mais'
2025-08-15 11:15:39,640 [INFO] [root:510] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 11:15:39,672 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:15:40,239 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:15:40,250 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'mais'
2025-08-15 11:16:04,624 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:16:04,625 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: 8
2025-08-15 11:16:04,627 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:16:04] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:16:04,629 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:16:04,630 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: '8'
2025-08-15 11:16:04,630 [INFO] [root:510] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 11:16:04,634 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:16:05,611 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:16:05,617 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para '8'
2025-08-15 11:16:16,958 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:16:16,959 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: 5
2025-08-15 11:16:16,960 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:16:16] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:16:16,963 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:16:17,509 [INFO] [root:263] [update_kb] KB atualizado com novo termo relacionado 'cerveja'
2025-08-15 11:16:17,538 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:16:18,400 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:16:18,405 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para '5'
2025-08-15 11:16:26,614 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:16:26,617 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: limpar carrinho
2025-08-15 11:16:26,620 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:16:26] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:16:26,625 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:16:26,625 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'limpar carrinho'
2025-08-15 11:16:26,626 [INFO] [root:475] [get_intent] [llm_interface.py] Comando de limpeza de carrinho detectado
2025-08-15 11:16:26,629 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:16:27,206 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:16:27,209 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'limpar carrinho'
2025-08-15 11:16:34,547 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:16:34,551 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: ver carrinho
2025-08-15 11:16:34,553 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:16:34] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:16:34,556 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:16:34,557 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'ver carrinho'
2025-08-15 11:16:34,557 [INFO] [root:510] [get_intent] [llm_interface.py] Mensagem simples detectada, usando fallback r√°pido
2025-08-15 11:16:34,560 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:16:35,127 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:16:35,130 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'ver carrinho'
2025-08-15 11:31:52,519 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:31:52,520 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: Oi
2025-08-15 11:31:52,522 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:31:52] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:31:52,525 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:31:52,526 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Oi'
2025-08-15 11:31:52,527 [INFO] [root:491] [get_intent] [llm_interface.py] Sauda√ß√£o detectada, usando handle_chitchat
2025-08-15 11:31:52,531 [DEBUG] [httpcore.connection:47] [trace] close.started
2025-08-15 11:31:52,531 [DEBUG] [httpcore.connection:47] [trace] close.complete
2025-08-15 11:31:52,532 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:31:52,536 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b0b3730>
2025-08-15 11:31:52,536 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:31:52,537 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:31:52,538 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:31:52,538 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:31:52,539 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:31:57,991 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:31:57 GMT'), (b'Content-Length', b'420')])
2025-08-15 11:31:57,992 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:31:57,993 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:31:57,994 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:31:57,995 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:31:57,995 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:31:57,996 [INFO] [root:1174] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para greeting: Oi, G.A.V. aqui! Como eu posso te ajudar hoje? Voc...
2025-08-15 11:31:58,000 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:31:58,950 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:31:58,954 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-15 11:32:26,986 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:32:26,988 [INFO] [root:1577] [inbound_message] Received message from 5511940726493: Bom dia
2025-08-15 11:32:26,989 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:32:26] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:32:26,993 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:32:26,993 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Bom dia'
2025-08-15 11:32:26,999 [INFO] [root:491] [get_intent] [llm_interface.py] Sauda√ß√£o detectada, usando handle_chitchat
2025-08-15 11:32:27,002 [DEBUG] [httpcore.connection:47] [trace] close.started
2025-08-15 11:32:27,003 [DEBUG] [httpcore.connection:47] [trace] close.complete
2025-08-15 11:32:27,005 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:32:27,008 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f035b0b2220>
2025-08-15 11:32:27,009 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:32:27,009 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:32:27,010 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:32:27,010 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:32:27,011 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:32:28,440 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:32:28 GMT'), (b'Content-Length', b'408')])
2025-08-15 11:32:28,441 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:32:28,446 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:32:28,447 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:32:28,448 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:32:28,448 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:32:28,449 [INFO] [root:1174] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para greeting: Bom dia! Como eu posso te ajudar hoje? Voc√™ precis...
2025-08-15 11:32:28,452 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:32:29,015 [ERROR] [root:1481] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1477, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:32:29,020 [INFO] [root:1530] [process_message_async] THREAD: Processamento finalizado para 'Bom dia'
2025-08-15 11:36:58,417 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/app.py', reloading
2025-08-15 11:36:58,520 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 11:36:59,648 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 11:36:59,939 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 11:36:59,941 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 11:37:45,834 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 11:37:45,900 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 11:37:46,615 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 11:37:46,810 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 11:37:46,813 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 11:39:48,492 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 11:39:48,539 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 11:39:49,329 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 11:39:49,552 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 11:39:49,553 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 11:40:10,248 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 11:40:10,296 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 11:40:10,999 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 11:40:11,218 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 11:40:11,219 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 11:40:53,017 [INFO] [werkzeug:97] [_log]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-15 11:40:53,063 [INFO] [werkzeug:97] [_log]  * Restarting with stat
2025-08-15 11:40:53,804 [INFO] [root:534] [setup_main_logging] üöÄ Sistema de logging G.A.V. inicializado
2025-08-15 11:40:54,000 [WARNING] [werkzeug:97] [_log]  * Debugger is active!
2025-08-15 11:40:54,001 [INFO] [werkzeug:97] [_log]  * Debugger PIN: 133-768-190
2025-08-15 11:41:17,513 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:41:17,514 [INFO] [root:1580] [inbound_message] Received message from 5511940726493: Oi
2025-08-15 11:41:17,517 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:41:17] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:41:17,520 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:41:17,521 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Oi'
2025-08-15 11:41:17,522 [INFO] [root:491] [get_intent] [llm_interface.py] Sauda√ß√£o detectada, usando handle_chitchat
2025-08-15 11:41:17,523 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:41:17,526 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1729bc6280>
2025-08-15 11:41:17,527 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:41:17,527 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:41:17,528 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:41:17,530 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:41:17,531 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:41:21,029 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:41:21 GMT'), (b'Content-Length', b'471')])
2025-08-15 11:41:21,030 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:41:21,031 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:41:21,032 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:41:21,032 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:41:21,032 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:41:21,033 [INFO] [root:1176] [generate_personalized_response] [llm_interface.py] Resposta din√¢mica gerada para greeting: Oi! G.A.V., Gentil Assistente de Vendas do Comerci...
2025-08-15 11:41:21,035 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:41:21,955 [ERROR] [root:1484] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1480, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:41:21,964 [INFO] [root:1533] [process_message_async] THREAD: Processamento finalizado para 'Oi'
2025-08-15 11:41:44,413 [DEBUG] [asyncio:54] [__init__] Using selector: EpollSelector
2025-08-15 11:41:44,421 [INFO] [root:1580] [inbound_message] Received message from 5511940726493: Me chamo Jonathan
2025-08-15 11:41:44,425 [INFO] [werkzeug:97] [_log] 172.20.0.1 - - [15/Aug/2025 11:41:44] "POST /webhooks/inbound-message HTTP/1.1" 200 -
2025-08-15 11:41:44,448 [DEBUG] [root:95] [load_session] [SESSION] Sess√£o carregada do arquivo: data/session_5511940726493.json
2025-08-15 11:41:44,453 [INFO] [root:458] [get_intent] [llm_interface.py] Iniciando get_intent para mensagem: 'Me chamo Jonathan'
2025-08-15 11:41:44,456 [INFO] [root:202] [load_prompt_template] [llm_interface.py] Carregando prompt de: ai_llm/gav_prompt_structured.txt
2025-08-15 11:41:44,463 [INFO] [root:207] [load_prompt_template] [llm_interface.py] Prompt carregado e cacheado. Tamanho: 3592 caracteres
2025-08-15 11:41:44,465 [INFO] [root:537] [get_intent] [llm_interface.py] System prompt preparado. Tamanho: 3592 caracteres
2025-08-15 11:41:44,470 [INFO] [root:635] [get_intent] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-15 11:41:44,472 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.started host='host.docker.internal' port=11434 local_address=None timeout=None socket_options=None
2025-08-15 11:41:44,475 [DEBUG] [httpcore.connection:47] [trace] connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f1729c1f130>
2025-08-15 11:41:44,478 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.started request=<Request [b'POST']>
2025-08-15 11:41:44,479 [DEBUG] [httpcore.http11:47] [trace] send_request_headers.complete
2025-08-15 11:41:44,479 [DEBUG] [httpcore.http11:47] [trace] send_request_body.started request=<Request [b'POST']>
2025-08-15 11:41:44,480 [DEBUG] [httpcore.http11:47] [trace] send_request_body.complete
2025-08-15 11:41:44,481 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.started request=<Request [b'POST']>
2025-08-15 11:41:46,915 [DEBUG] [httpcore.http11:47] [trace] receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 15 Aug 2025 11:41:46 GMT'), (b'Content-Length', b'426')])
2025-08-15 11:41:46,922 [INFO] [httpx:1025] [_send_single_request] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-15 11:41:46,925 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.started request=<Request [b'POST']>
2025-08-15 11:41:46,926 [DEBUG] [httpcore.http11:47] [trace] receive_response_body.complete
2025-08-15 11:41:46,927 [DEBUG] [httpcore.http11:47] [trace] response_closed.started
2025-08-15 11:41:46,927 [DEBUG] [httpcore.http11:47] [trace] response_closed.complete
2025-08-15 11:41:46,928 [INFO] [root:654] [get_intent] [llm_interface.py] Resposta recebida do LLM em 2.46s
2025-08-15 11:41:46,929 [INFO] [root:666] [get_intent] [llm_interface.py] Resposta do LLM: {
  "tool_name": "handle_chitchat",
  "parameters": {
    "response_text": "Prazer em te conhecer, J...
2025-08-15 11:41:46,930 [DEBUG] [root:676] [get_intent] [llm_interface.py] Conte√∫do limpo: {
  "tool_name": "handle_chitchat",
  "parameters": {
    "response_text": "Prazer em te conhecer, Jonathan!"
  }
}
2025-08-15 11:41:46,931 [INFO] [root:727] [get_intent] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'Prazer em te conhecer, Jonathan!'}}
2025-08-15 11:41:46,937 [DEBUG] [root:134] [save_session] [SESSION] Sess√£o salva no arquivo: data/session_5511940726493.json
2025-08-15 11:41:47,571 [ERROR] [root:1484] [_finalize_session] Erro ao enviar mensagem WhatsApp: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
Traceback (most recent call last):
  File "/app/app.py", line 1480, in _finalize_session
    vonage_client.enviar_whatsapp(response_text)
  File "/app/communication/vonage_client.py", line 35, in enviar_whatsapp
    resp.raise_for_status()
  File "/usr/local/lib/python3.9/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://messages-sandbox.nexmo.com/v1/messages
2025-08-15 11:41:47,589 [INFO] [root:1533] [process_message_async] THREAD: Processamento finalizado para 'Me chamo Jonathan'
