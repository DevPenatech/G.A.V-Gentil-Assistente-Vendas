2025-08-08 18:13:02,077 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.18.0.3:8080
2025-08-08 18:13:02,077 [INFO] [33mPress CTRL+C to quit[0m
2025-08-08 18:13:02,078 [INFO]  * Restarting with stat
2025-08-08 18:13:02,703 [WARNING]  * Debugger is active!
2025-08-08 18:13:02,704 [INFO]  * Debugger PIN: 935-085-737
2025-08-08 18:13:14,013 [INFO] 172.18.0.1 - - [08/Aug/2025 18:13:14] "POST /webhook HTTP/1.1" 200 -
2025-08-08 18:13:14,014 [INFO] Nenhum arquivo de sess√£o encontrado. Iniciando uma nova.
2025-08-08 18:13:14,039 [INFO] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 404 Not Found"
2025-08-08 18:13:14,045 [INFO] INTEN√á√ÉO PROCESSADA: {'tool_name': 'error', 'parameters': {'detail': 'model "llama3" not found, try pulling it first (status code: 404)'}}
2025-08-08 18:13:14,048 [WARNING] Fallback Final: Ferramenta desconhecida 'error'
2025-08-08 18:13:14,049 [INFO] Salvando sess√£o: {'customer_context': None, 'shopping_cart': [], 'last_search_type': None, 'last_search_params': {}, 'current_offset': 0, 'last_shown_products': [], 'last_bot_action': None, 'pending_action': 'show_top_selling', 'last_kb_search_term': None}
2025-08-08 18:13:14,059 [INFO] Enviando mensagem proativa para whatsapp:+5511951765957: 'ü§ñ Hum, n√£o entendi muito bem. Que tal come√ßarmos pelos produtos mais vendidos? Posso te mostrar?'
2025-08-08 18:13:14,085 [INFO] -- BEGIN Twilio API Request --
2025-08-08 18:13:14,086 [INFO] POST Request: https://api.twilio.com/2010-04-01/Accounts/ACd2a6cd60871d661c034ecb40ddbd51e7/Messages.json
2025-08-08 18:13:14,086 [INFO] Headers:
2025-08-08 18:13:14,086 [INFO] Content-Type : application/x-www-form-urlencoded
2025-08-08 18:13:14,087 [INFO] Accept : application/json
2025-08-08 18:13:14,087 [INFO] User-Agent : twilio-python/9.7.0 (Linux x86_64) Python/3.9.23
2025-08-08 18:13:14,087 [INFO] X-Twilio-Client : python-9.7.0
2025-08-08 18:13:14,087 [INFO] Accept-Charset : utf-8
2025-08-08 18:13:14,087 [INFO] -- END Twilio API Request --
2025-08-08 18:13:15,111 [INFO] Response Status Code: 201
2025-08-08 18:13:15,112 [INFO] Response Headers: {'Content-Type': 'application/json;charset=utf-8', 'Content-Length': '900', 'Connection': 'keep-alive', 'Date': 'Fri, 08 Aug 2025 18:13:14 GMT', 'Twilio-Concurrent-Requests': '1', 'Twilio-Request-Id': 'RQe8eb5beb286e778c39a6c13c588ec77e', 'Twilio-Request-Duration': '0.116', 'X-Home-Region': 'us1', 'X-API-Domain': 'api.twilio.com', 'Strict-Transport-Security': 'max-age=31536000', 'X-Cache': 'Miss from cloudfront', 'Via': '1.1 f5002d75963a7ac4e40089e827005b00.cloudfront.net (CloudFront)', 'X-Amz-Cf-Pop': 'GRU3-P4', 'X-Amz-Cf-Id': 'qAZNhyJPHyF9Wi_1PGk4_5GP2rRi-uyxfdqQgXNy8vTz0lnc-wrxVw==', 'X-Powered-By': 'AT-5000', 'X-Shenanigans': 'none', 'Vary': 'Origin'}
2025-08-08 18:13:15,112 [INFO] THREAD: Processamento finalizado para 'Oi'
2025-08-08 18:15:31,134 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.18.0.3:8080
2025-08-08 18:15:31,134 [INFO] [33mPress CTRL+C to quit[0m
2025-08-08 18:15:31,135 [INFO]  * Restarting with stat
2025-08-08 18:15:31,836 [WARNING]  * Debugger is active!
2025-08-08 18:15:31,836 [INFO]  * Debugger PIN: 878-148-492
2025-08-08 18:15:40,504 [INFO] 172.18.0.1 - - [08/Aug/2025 18:15:40] "POST /webhook HTTP/1.1" 200 -
2025-08-08 18:15:40,505 [INFO] Arquivo de sess√£o encontrado. Carregando.
2025-08-08 18:15:40,528 [INFO] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 404 Not Found"
2025-08-08 18:15:40,528 [INFO] INTEN√á√ÉO PROCESSADA: {'tool_name': 'error', 'parameters': {'detail': 'model "llama3" not found, try pulling it first (status code: 404)'}}
2025-08-08 18:15:40,528 [WARNING] Fallback Final: Ferramenta desconhecida 'error'
2025-08-08 18:15:40,529 [INFO] Salvando sess√£o: {'customer_context': None, 'shopping_cart': [], 'last_search_type': None, 'last_search_params': {}, 'current_offset': 0, 'last_shown_products': [], 'last_bot_action': None, 'pending_action': 'show_top_selling', 'last_kb_search_term': None}
2025-08-08 18:15:40,533 [INFO] Enviando mensagem proativa para whatsapp:+5511951765957: 'ü§ñ Hum, n√£o entendi muito bem. Que tal come√ßarmos pelos produtos mais vendidos? Posso te mostrar?'
2025-08-08 18:15:40,556 [INFO] -- BEGIN Twilio API Request --
2025-08-08 18:15:40,557 [INFO] POST Request: https://api.twilio.com/2010-04-01/Accounts/ACd2a6cd60871d661c034ecb40ddbd51e7/Messages.json
2025-08-08 18:15:40,557 [INFO] Headers:
2025-08-08 18:15:40,557 [INFO] Content-Type : application/x-www-form-urlencoded
2025-08-08 18:15:40,557 [INFO] Accept : application/json
2025-08-08 18:15:40,558 [INFO] User-Agent : twilio-python/9.7.0 (Linux x86_64) Python/3.9.23
2025-08-08 18:15:40,558 [INFO] X-Twilio-Client : python-9.7.0
2025-08-08 18:15:40,558 [INFO] Accept-Charset : utf-8
2025-08-08 18:15:40,558 [INFO] -- END Twilio API Request --
2025-08-08 18:15:41,403 [INFO] Response Status Code: 429
2025-08-08 18:15:41,403 [INFO] Response Headers: {'Content-Type': 'application/json', 'Content-Length': '173', 'Connection': 'keep-alive', 'Date': 'Fri, 08 Aug 2025 18:15:41 GMT', 'X-Twilio-Error-Code': '63038', 'Twilio-Concurrent-Requests': '1', 'Twilio-Request-Id': 'RQ813f3e0634d9d558df01d5c4f21258b1', 'Twilio-Request-Duration': '0.047', 'X-Home-Region': 'us1', 'X-API-Domain': 'api.twilio.com', 'Strict-Transport-Security': 'max-age=31536000', 'X-Cache': 'Error from cloudfront', 'Via': '1.1 6f2f291762a32a9876c9d69d778cb280.cloudfront.net (CloudFront)', 'X-Amz-Cf-Pop': 'GRU3-P4', 'X-Amz-Cf-Id': 'KsStXuEXwAL2OliJr5mLfB79FkrkKUiPeVcsqXoV7qHVNSptXkrhgw==', 'X-Powered-By': 'AT-5000', 'X-Shenanigans': 'none', 'Vary': 'Origin'}
2025-08-08 18:15:41,404 [ERROR] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-08 18:15:41,404 [INFO] THREAD: Processamento finalizado para 'Oi'
2025-08-08 18:16:43,605 [INFO] 172.18.0.1 - - [08/Aug/2025 18:16:43] "POST /webhook HTTP/1.1" 200 -
2025-08-08 18:16:43,607 [INFO] Arquivo de sess√£o encontrado. Carregando.
2025-08-08 18:16:43,634 [INFO] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 404 Not Found"
2025-08-08 18:16:43,635 [INFO] INTEN√á√ÉO PROCESSADA: {'tool_name': 'error', 'parameters': {'detail': 'model "llama3" not found, try pulling it first (status code: 404)'}}
2025-08-08 18:16:43,635 [WARNING] Fallback Final: Ferramenta desconhecida 'error'
2025-08-08 18:16:43,635 [INFO] Salvando sess√£o: {'customer_context': None, 'shopping_cart': [], 'last_search_type': None, 'last_search_params': {}, 'current_offset': 0, 'last_shown_products': [], 'last_bot_action': None, 'pending_action': 'show_top_selling', 'last_kb_search_term': None}
2025-08-08 18:16:43,637 [INFO] Enviando mensagem proativa para whatsapp:+5511940726493: 'ü§ñ Hum, n√£o entendi muito bem. Que tal come√ßarmos pelos produtos mais vendidos? Posso te mostrar?'
2025-08-08 18:16:43,638 [INFO] -- BEGIN Twilio API Request --
2025-08-08 18:16:43,638 [INFO] POST Request: https://api.twilio.com/2010-04-01/Accounts/ACd2a6cd60871d661c034ecb40ddbd51e7/Messages.json
2025-08-08 18:16:43,638 [INFO] Headers:
2025-08-08 18:16:43,639 [INFO] Content-Type : application/x-www-form-urlencoded
2025-08-08 18:16:43,639 [INFO] Accept : application/json
2025-08-08 18:16:43,639 [INFO] User-Agent : twilio-python/9.7.0 (Linux x86_64) Python/3.9.23
2025-08-08 18:16:43,639 [INFO] X-Twilio-Client : python-9.7.0
2025-08-08 18:16:43,639 [INFO] Accept-Charset : utf-8
2025-08-08 18:16:43,639 [INFO] -- END Twilio API Request --
2025-08-08 18:16:44,108 [INFO] Response Status Code: 201
2025-08-08 18:16:44,108 [INFO] Response Headers: {'Content-Type': 'application/json;charset=utf-8', 'Content-Length': '900', 'Connection': 'keep-alive', 'Date': 'Fri, 08 Aug 2025 18:16:43 GMT', 'Twilio-Concurrent-Requests': '1', 'Twilio-Request-Id': 'RQb37cf1b5d558d2560f55b725208159d2', 'Twilio-Request-Duration': '0.115', 'X-Home-Region': 'us1', 'X-API-Domain': 'api.twilio.com', 'Strict-Transport-Security': 'max-age=31536000', 'X-Cache': 'Miss from cloudfront', 'Via': '1.1 6f2f291762a32a9876c9d69d778cb280.cloudfront.net (CloudFront)', 'X-Amz-Cf-Pop': 'GRU3-P4', 'X-Amz-Cf-Id': 'FahdfC7wTmQ3qnbzGsWZG3aPMU5Tzp1njvlnR2wONOL_Bh0bLWs2Bw==', 'X-Powered-By': 'AT-5000', 'X-Shenanigans': 'none', 'Vary': 'Origin'}
2025-08-08 18:16:44,109 [INFO] THREAD: Processamento finalizado para 'Oi'
2025-08-08 18:21:30,993 [INFO]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-08 18:21:31,042 [INFO]  * Restarting with stat
2025-08-08 18:21:31,752 [WARNING]  * Debugger is active!
2025-08-08 18:21:31,753 [INFO]  * Debugger PIN: 878-148-492
2025-08-08 18:21:56,675 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.18.0.3:8080
2025-08-08 18:21:56,675 [INFO] [33mPress CTRL+C to quit[0m
2025-08-08 18:21:56,676 [INFO]  * Restarting with stat
2025-08-08 18:21:57,331 [WARNING]  * Debugger is active!
2025-08-08 18:21:57,332 [INFO]  * Debugger PIN: 112-391-589
2025-08-08 18:22:02,275 [INFO] 172.18.0.1 - - [08/Aug/2025 18:22:02] "POST /webhook HTTP/1.1" 200 -
2025-08-08 18:22:02,277 [INFO] Arquivo de sess√£o encontrado. Carregando.
2025-08-08 18:22:02,282 [INFO] [llm_interface.py] Iniciando get_intent para mensagem: 'Oi...'
2025-08-08 18:22:02,282 [INFO] [llm_interface.py] Tentando carregar prompt de: ai_llm/gav_prompt.txt
2025-08-08 18:22:02,284 [INFO] [llm_interface.py] Prompt carregado com sucesso. Tamanho: 2523 caracteres
2025-08-08 18:22:02,284 [INFO] [llm_interface.py] System prompt preparado. Tamanho: 2455 caracteres
2025-08-08 18:22:02,284 [INFO] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-08 18:22:02,297 [INFO] [llm_interface.py] Verificando disponibilidade do modelo: llama3
2025-08-08 18:22:02,325 [INFO] HTTP Request: GET http://host.docker.internal:11434/api/tags "HTTP/1.1 200 OK"
2025-08-08 18:22:02,326 [WARNING] [llm_interface.py] N√£o foi poss√≠vel verificar modelos dispon√≠veis: 'name'
2025-08-08 18:22:02,326 [INFO] [llm_interface.py] Enviando requisi√ß√£o para o modelo llama3
2025-08-08 18:22:02,328 [INFO] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 404 Not Found"
2025-08-08 18:22:02,329 [ERROR] [llm_interface.py] Erro ao comunicar com o LLM: model "llama3" not found, try pulling it first (status code: 404)
2025-08-08 18:22:02,329 [INFO] INTEN√á√ÉO PROCESSADA: {'tool_name': 'error', 'parameters': {'detail': 'Failed to connect to Ollama. Please check that Ollama is downloaded, running and accessible. model "llama3" not found, try pulling it first (status code: 404)'}}
2025-08-08 18:22:02,329 [WARNING] Fallback Final: Ferramenta desconhecida 'error'
2025-08-08 18:22:02,330 [INFO] Salvando sess√£o: {'customer_context': None, 'shopping_cart': [], 'last_search_type': None, 'last_search_params': {}, 'current_offset': 0, 'last_shown_products': [], 'last_bot_action': None, 'pending_action': 'show_top_selling', 'last_kb_search_term': None}
2025-08-08 18:22:02,332 [INFO] Enviando mensagem proativa para whatsapp:+5511940726493: 'ü§ñ Hum, n√£o entendi muito bem. Que tal come√ßarmos pelos produtos mais vendidos? Posso te mostrar?'
2025-08-08 18:22:02,355 [INFO] -- BEGIN Twilio API Request --
2025-08-08 18:22:02,356 [INFO] POST Request: https://api.twilio.com/2010-04-01/Accounts/ACd2a6cd60871d661c034ecb40ddbd51e7/Messages.json
2025-08-08 18:22:02,356 [INFO] Headers:
2025-08-08 18:22:02,356 [INFO] Content-Type : application/x-www-form-urlencoded
2025-08-08 18:22:02,356 [INFO] Accept : application/json
2025-08-08 18:22:02,357 [INFO] User-Agent : twilio-python/9.7.0 (Linux x86_64) Python/3.9.23
2025-08-08 18:22:02,357 [INFO] X-Twilio-Client : python-9.7.0
2025-08-08 18:22:02,357 [INFO] Accept-Charset : utf-8
2025-08-08 18:22:02,357 [INFO] -- END Twilio API Request --
2025-08-08 18:22:03,110 [INFO] Response Status Code: 201
2025-08-08 18:22:03,110 [INFO] Response Headers: {'Content-Type': 'application/json;charset=utf-8', 'Content-Length': '900', 'Connection': 'keep-alive', 'Date': 'Fri, 08 Aug 2025 18:22:03 GMT', 'Twilio-Concurrent-Requests': '1', 'Twilio-Request-Id': 'RQ03e7cd73a5a4e8019c6c3febd41a3012', 'Twilio-Request-Duration': '0.113', 'X-Home-Region': 'us1', 'X-API-Domain': 'api.twilio.com', 'Strict-Transport-Security': 'max-age=31536000', 'X-Cache': 'Miss from cloudfront', 'Via': '1.1 b0c4c3183ea0dd9a0f495a148c420656.cloudfront.net (CloudFront)', 'X-Amz-Cf-Pop': 'GRU3-P4', 'X-Amz-Cf-Id': 'MDXsuelpxGZC-b4dc8YE_uTMbHuy9LJfwXK0WLfbVviwe5VDbmXDuw==', 'X-Powered-By': 'AT-5000', 'X-Shenanigans': 'none', 'Vary': 'Origin'}
2025-08-08 18:22:03,111 [INFO] THREAD: Processamento finalizado para 'Oi'
2025-08-08 18:22:12,409 [INFO] 172.18.0.1 - - [08/Aug/2025 18:22:12] "POST /webhook HTTP/1.1" 200 -
2025-08-08 18:22:12,410 [INFO] Arquivo de sess√£o encontrado. Carregando.
2025-08-08 18:22:12,414 [INFO] INTEN√á√ÉO PROCESSADA: {'tool_name': 'get_top_selling_products', 'parameters': {}}
2025-08-08 18:22:12,434 [INFO] Salvando sess√£o: {'customer_context': None, 'shopping_cart': [], 'last_search_type': 'top_selling', 'last_search_params': {}, 'current_offset': 5, 'last_shown_products': [], 'last_bot_action': 'AWAITING_PRODUCT_SELECTION', 'pending_action': None, 'last_kb_search_term': None}
2025-08-08 18:22:12,436 [INFO] Enviando mensagem proativa para whatsapp:+5511940726493: 'ü§ñ Estes s√£o nossos produtos mais populares:
Nenhum produto encontrado com esse crit√©rio.'
2025-08-08 18:22:12,437 [INFO] -- BEGIN Twilio API Request --
2025-08-08 18:22:12,437 [INFO] POST Request: https://api.twilio.com/2010-04-01/Accounts/ACd2a6cd60871d661c034ecb40ddbd51e7/Messages.json
2025-08-08 18:22:12,437 [INFO] Headers:
2025-08-08 18:22:12,437 [INFO] Content-Type : application/x-www-form-urlencoded
2025-08-08 18:22:12,438 [INFO] Accept : application/json
2025-08-08 18:22:12,438 [INFO] User-Agent : twilio-python/9.7.0 (Linux x86_64) Python/3.9.23
2025-08-08 18:22:12,438 [INFO] X-Twilio-Client : python-9.7.0
2025-08-08 18:22:12,439 [INFO] Accept-Charset : utf-8
2025-08-08 18:22:12,439 [INFO] -- END Twilio API Request --
2025-08-08 18:22:12,727 [INFO] Response Status Code: 429
2025-08-08 18:22:12,727 [INFO] Response Headers: {'Content-Type': 'application/json', 'Content-Length': '173', 'Connection': 'keep-alive', 'Date': 'Fri, 08 Aug 2025 18:22:12 GMT', 'X-Twilio-Error-Code': '63038', 'Twilio-Concurrent-Requests': '1', 'Twilio-Request-Id': 'RQ35871c1b0b13fc3c43831a957c45c8d1', 'Twilio-Request-Duration': '0.041', 'X-Home-Region': 'us1', 'X-API-Domain': 'api.twilio.com', 'Strict-Transport-Security': 'max-age=31536000', 'X-Cache': 'Error from cloudfront', 'Via': '1.1 b0c4c3183ea0dd9a0f495a148c420656.cloudfront.net (CloudFront)', 'X-Amz-Cf-Pop': 'GRU3-P4', 'X-Amz-Cf-Id': 'im5Zi1bFK9eSw34XSWepUUl5Wk_K67R0tmxuEi0J1sOx92M8Y7ZDnA==', 'X-Powered-By': 'AT-5000', 'X-Shenanigans': 'none', 'Vary': 'Origin'}
2025-08-08 18:22:12,728 [ERROR] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-08 18:22:12,728 [INFO] THREAD: Processamento finalizado para 'Sim'
2025-08-08 18:35:06,695 [INFO]  * Detected change in '/app/ai_llm/llm_interface.py', reloading
2025-08-08 18:35:06,736 [INFO]  * Restarting with stat
2025-08-08 18:35:07,411 [WARNING]  * Debugger is active!
2025-08-08 18:35:07,411 [INFO]  * Debugger PIN: 112-391-589
2025-08-08 19:01:43,443 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.18.0.3:8080
2025-08-08 19:01:43,443 [INFO] [33mPress CTRL+C to quit[0m
2025-08-08 19:01:43,444 [INFO]  * Restarting with stat
2025-08-08 19:01:44,193 [WARNING]  * Debugger is active!
2025-08-08 19:01:44,194 [INFO]  * Debugger PIN: 955-781-476
2025-08-08 19:19:48,594 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://172.18.0.3:8080
2025-08-08 19:19:48,595 [INFO] [33mPress CTRL+C to quit[0m
2025-08-08 19:19:48,597 [INFO]  * Restarting with stat
2025-08-08 19:19:49,280 [WARNING]  * Debugger is active!
2025-08-08 19:19:49,281 [INFO]  * Debugger PIN: 112-853-424
2025-08-08 19:19:54,868 [INFO] 172.18.0.1 - - [08/Aug/2025 19:19:54] "POST /webhook HTTP/1.1" 200 -
2025-08-08 19:19:54,869 [INFO] Arquivo de sess√£o encontrado. Carregando.
2025-08-08 19:19:54,880 [INFO] [llm_interface.py] Iniciando get_intent para mensagem: 'Oi...'
2025-08-08 19:19:54,880 [INFO] [llm_interface.py] Tentando carregar prompt de: ai_llm/gav_prompt.txt
2025-08-08 19:19:54,887 [INFO] [llm_interface.py] Prompt carregado com sucesso. Tamanho: 2523 caracteres
2025-08-08 19:19:54,887 [INFO] [llm_interface.py] System prompt preparado. Tamanho: 2455 caracteres
2025-08-08 19:19:54,887 [INFO] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-08 19:19:54,903 [INFO] [llm_interface.py] Verificando disponibilidade do modelo: llama3.1
2025-08-08 19:19:54,932 [INFO] HTTP Request: GET http://host.docker.internal:11434/api/tags "HTTP/1.1 200 OK"
2025-08-08 19:19:54,933 [WARNING] [llm_interface.py] N√£o foi poss√≠vel verificar modelos dispon√≠veis: 'name'
2025-08-08 19:19:54,934 [INFO] [llm_interface.py] Enviando requisi√ß√£o para o modelo llama3.1
2025-08-08 19:20:04,088 [INFO] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 19:20:04,088 [INFO] [llm_interface.py] Resposta recebida do LLM. Tamanho: 267 caracteres
2025-08-08 19:20:04,089 [INFO] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'Ol√°! Tudo bem? Sou o G.A.V., seu assistente de vendas virtual do Comercial Esperan√≥a. Estou aqui para ajudar voc√™ a encontrar produtos e montar seu pedido. O que voc√™ gostaria de ver hoje?'}}
2025-08-08 19:20:04,089 [INFO] INTEN√á√ÉO PROCESSADA: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'Ol√°! Tudo bem? Sou o G.A.V., seu assistente de vendas virtual do Comercial Esperan√≥a. Estou aqui para ajudar voc√™ a encontrar produtos e montar seu pedido. O que voc√™ gostaria de ver hoje?'}}
2025-08-08 19:20:04,089 [INFO] Salvando sess√£o: {'customer_context': None, 'shopping_cart': [], 'last_search_type': 'top_selling', 'last_search_params': {}, 'current_offset': 5, 'last_shown_products': [], 'last_bot_action': 'AWAITING_PRODUCT_SELECTION', 'pending_action': None, 'last_kb_search_term': None}
2025-08-08 19:20:04,093 [INFO] Enviando mensagem proativa para whatsapp:+5511940726493: 'Ol√°! Tudo bem? Sou o G.A.V., seu assistente de vendas virtual do Comercial Esperan√≥a. Estou aqui para ajudar voc√™ a encontrar produtos e montar seu pedido. O que voc√™ gostaria de ver hoje?'
2025-08-08 19:20:04,135 [INFO] -- BEGIN Twilio API Request --
2025-08-08 19:20:04,136 [INFO] POST Request: https://api.twilio.com/2010-04-01/Accounts/ACd2a6cd60871d661c034ecb40ddbd51e7/Messages.json
2025-08-08 19:20:04,136 [INFO] Headers:
2025-08-08 19:20:04,136 [INFO] Content-Type : application/x-www-form-urlencoded
2025-08-08 19:20:04,136 [INFO] Accept : application/json
2025-08-08 19:20:04,136 [INFO] User-Agent : twilio-python/9.7.0 (Linux x86_64) Python/3.9.23
2025-08-08 19:20:04,136 [INFO] X-Twilio-Client : python-9.7.0
2025-08-08 19:20:04,136 [INFO] Accept-Charset : utf-8
2025-08-08 19:20:04,136 [INFO] -- END Twilio API Request --
2025-08-08 19:20:04,780 [INFO] Response Status Code: 429
2025-08-08 19:20:04,780 [INFO] Response Headers: {'Content-Type': 'application/json', 'Content-Length': '173', 'Connection': 'keep-alive', 'Date': 'Fri, 08 Aug 2025 19:20:04 GMT', 'X-Twilio-Error-Code': '63038', 'Twilio-Concurrent-Requests': '1', 'Twilio-Request-Id': 'RQ87372ead545c8c9b8c8b180f6d16bf19', 'Twilio-Request-Duration': '0.053', 'X-Home-Region': 'us1', 'X-API-Domain': 'api.twilio.com', 'Strict-Transport-Security': 'max-age=31536000', 'X-Cache': 'Error from cloudfront', 'Via': '1.1 1f46652afcaf0a377b232da3cffaae08.cloudfront.net (CloudFront)', 'X-Amz-Cf-Pop': 'GRU3-P4', 'X-Amz-Cf-Id': 'LOTc4jdKCUAmk_3APZx5_ccfGGRs1egVIA7a2I4nTwwRsKG1ERv5Tg==', 'X-Powered-By': 'AT-5000', 'X-Shenanigans': 'none', 'Vary': 'Origin'}
2025-08-08 19:20:04,780 [ERROR] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-08 19:20:04,781 [INFO] THREAD: Processamento finalizado para 'Oi'
2025-08-08 19:20:17,751 [INFO] 172.18.0.1 - - [08/Aug/2025 19:20:17] "POST /webhook HTTP/1.1" 200 -
2025-08-08 19:20:17,752 [INFO] Arquivo de sess√£o encontrado. Carregando.
2025-08-08 19:20:17,754 [INFO] [llm_interface.py] Iniciando get_intent para mensagem: 'Oi...'
2025-08-08 19:20:17,755 [INFO] [llm_interface.py] Tentando carregar prompt de: ai_llm/gav_prompt.txt
2025-08-08 19:20:17,756 [INFO] [llm_interface.py] Prompt carregado com sucesso. Tamanho: 2523 caracteres
2025-08-08 19:20:17,756 [INFO] [llm_interface.py] System prompt preparado. Tamanho: 2455 caracteres
2025-08-08 19:20:17,756 [INFO] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-08 19:20:17,777 [INFO] [llm_interface.py] Verificando disponibilidade do modelo: llama3.1
2025-08-08 19:20:17,783 [INFO] HTTP Request: GET http://host.docker.internal:11434/api/tags "HTTP/1.1 200 OK"
2025-08-08 19:20:17,784 [WARNING] [llm_interface.py] N√£o foi poss√≠vel verificar modelos dispon√≠veis: 'name'
2025-08-08 19:20:17,784 [INFO] [llm_interface.py] Enviando requisi√ß√£o para o modelo llama3.1
2025-08-08 19:20:19,791 [INFO] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 19:20:19,792 [INFO] [llm_interface.py] Resposta recebida do LLM. Tamanho: 272 caracteres
2025-08-08 19:20:19,792 [INFO] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'Ol√°! Tudo bem? Sou o G.A.V., seu assistente de vendas virtual do Comercial Esperan√ßa. Estou aqui para ajudar voc√™ a encontrar produtos e montar seu pedido. O que voc√™ gostaria de ver hoje?'}}
2025-08-08 19:20:19,792 [INFO] INTEN√á√ÉO PROCESSADA: {'tool_name': 'handle_chitchat', 'parameters': {'response_text': 'Ol√°! Tudo bem? Sou o G.A.V., seu assistente de vendas virtual do Comercial Esperan√ßa. Estou aqui para ajudar voc√™ a encontrar produtos e montar seu pedido. O que voc√™ gostaria de ver hoje?'}}
2025-08-08 19:20:19,793 [INFO] Salvando sess√£o: {'customer_context': None, 'shopping_cart': [], 'last_search_type': 'top_selling', 'last_search_params': {}, 'current_offset': 5, 'last_shown_products': [], 'last_bot_action': 'AWAITING_PRODUCT_SELECTION', 'pending_action': None, 'last_kb_search_term': None}
2025-08-08 19:20:19,794 [INFO] Enviando mensagem proativa para whatsapp:+5511940726493: 'Ol√°! Tudo bem? Sou o G.A.V., seu assistente de vendas virtual do Comercial Esperan√ßa. Estou aqui para ajudar voc√™ a encontrar produtos e montar seu pedido. O que voc√™ gostaria de ver hoje?'
2025-08-08 19:20:19,794 [INFO] -- BEGIN Twilio API Request --
2025-08-08 19:20:19,795 [INFO] POST Request: https://api.twilio.com/2010-04-01/Accounts/ACd2a6cd60871d661c034ecb40ddbd51e7/Messages.json
2025-08-08 19:20:19,795 [INFO] Headers:
2025-08-08 19:20:19,795 [INFO] Content-Type : application/x-www-form-urlencoded
2025-08-08 19:20:19,795 [INFO] Accept : application/json
2025-08-08 19:20:19,795 [INFO] User-Agent : twilio-python/9.7.0 (Linux x86_64) Python/3.9.23
2025-08-08 19:20:19,795 [INFO] X-Twilio-Client : python-9.7.0
2025-08-08 19:20:19,795 [INFO] Accept-Charset : utf-8
2025-08-08 19:20:19,795 [INFO] -- END Twilio API Request --
2025-08-08 19:20:20,109 [INFO] Response Status Code: 201
2025-08-08 19:20:20,109 [INFO] Response Headers: {'Content-Type': 'application/json;charset=utf-8', 'Content-Length': '991', 'Connection': 'keep-alive', 'Date': 'Fri, 08 Aug 2025 19:20:20 GMT', 'Twilio-Concurrent-Requests': '1', 'Twilio-Request-Id': 'RQb7a33d05eb82311e99269fe3563797c2', 'Twilio-Request-Duration': '0.104', 'X-Home-Region': 'us1', 'X-API-Domain': 'api.twilio.com', 'Strict-Transport-Security': 'max-age=31536000', 'X-Cache': 'Miss from cloudfront', 'Via': '1.1 1f46652afcaf0a377b232da3cffaae08.cloudfront.net (CloudFront)', 'X-Amz-Cf-Pop': 'GRU3-P4', 'X-Amz-Cf-Id': 'rzfNOpnAdxtJLQI4h8zDK3DVnM2wqCJnJ2jrOXY2CcfGFxaXKGTr3Q==', 'X-Powered-By': 'AT-5000', 'X-Shenanigans': 'none', 'Vary': 'Origin'}
2025-08-08 19:20:20,109 [INFO] THREAD: Processamento finalizado para 'Oi'
2025-08-08 19:20:30,913 [INFO] 172.18.0.1 - - [08/Aug/2025 19:20:30] "POST /webhook HTTP/1.1" 200 -
2025-08-08 19:20:30,914 [INFO] Arquivo de sess√£o encontrado. Carregando.
2025-08-08 19:20:30,916 [INFO] [llm_interface.py] Iniciando get_intent para mensagem: 'Gostaria de comprar coca cola...'
2025-08-08 19:20:30,916 [INFO] [llm_interface.py] Tentando carregar prompt de: ai_llm/gav_prompt.txt
2025-08-08 19:20:30,917 [INFO] [llm_interface.py] Prompt carregado com sucesso. Tamanho: 2523 caracteres
2025-08-08 19:20:30,918 [INFO] [llm_interface.py] System prompt preparado. Tamanho: 2455 caracteres
2025-08-08 19:20:30,918 [INFO] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-08 19:20:30,935 [INFO] [llm_interface.py] Verificando disponibilidade do modelo: llama3.1
2025-08-08 19:20:30,946 [INFO] HTTP Request: GET http://host.docker.internal:11434/api/tags "HTTP/1.1 200 OK"
2025-08-08 19:20:30,947 [WARNING] [llm_interface.py] N√£o foi poss√≠vel verificar modelos dispon√≠veis: 'name'
2025-08-08 19:20:30,947 [INFO] [llm_interface.py] Enviando requisi√ß√£o para o modelo llama3.1
2025-08-08 19:20:31,777 [INFO] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 19:20:31,777 [INFO] [llm_interface.py] Resposta recebida do LLM. Tamanho: 94 caracteres
2025-08-08 19:20:31,777 [INFO] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'get_top_selling_products_by_name', 'parameters': {'product_name': 'coca cola'}}
2025-08-08 19:20:31,777 [INFO] INTEN√á√ÉO PROCESSADA: {'tool_name': 'get_top_selling_products_by_name', 'parameters': {'product_name': 'coca cola'}}
2025-08-08 19:20:31,780 [INFO] Base de conhecimento 'knowledge/knowledge_base.json' carregada.
2025-08-08 19:20:31,796 [INFO] Salvando sess√£o: {'customer_context': None, 'shopping_cart': [], 'last_search_type': 'by_name', 'last_search_params': {'product_name': 'coca cola'}, 'current_offset': 5, 'last_shown_products': [], 'last_bot_action': 'AWAITING_PRODUCT_SELECTION', 'pending_action': None, 'last_kb_search_term': None}
2025-08-08 19:20:31,798 [INFO] Enviando mensagem proativa para whatsapp:+5511940726493: 'ü§ñ Encontrei estes produtos relacionados a 'coca cola':
Nenhum produto encontrado com esse crit√©rio.'
2025-08-08 19:20:31,798 [INFO] -- BEGIN Twilio API Request --
2025-08-08 19:20:31,798 [INFO] POST Request: https://api.twilio.com/2010-04-01/Accounts/ACd2a6cd60871d661c034ecb40ddbd51e7/Messages.json
2025-08-08 19:20:31,799 [INFO] Headers:
2025-08-08 19:20:31,799 [INFO] Content-Type : application/x-www-form-urlencoded
2025-08-08 19:20:31,799 [INFO] Accept : application/json
2025-08-08 19:20:31,800 [INFO] User-Agent : twilio-python/9.7.0 (Linux x86_64) Python/3.9.23
2025-08-08 19:20:31,800 [INFO] X-Twilio-Client : python-9.7.0
2025-08-08 19:20:31,801 [INFO] Accept-Charset : utf-8
2025-08-08 19:20:31,801 [INFO] -- END Twilio API Request --
2025-08-08 19:20:32,061 [INFO] Response Status Code: 429
2025-08-08 19:20:32,061 [INFO] Response Headers: {'Content-Type': 'application/json', 'Content-Length': '173', 'Connection': 'keep-alive', 'Date': 'Fri, 08 Aug 2025 19:20:31 GMT', 'X-Twilio-Error-Code': '63038', 'Twilio-Concurrent-Requests': '1', 'Twilio-Request-Id': 'RQ310f8df72981d4d66400330d6e9adab1', 'Twilio-Request-Duration': '0.030', 'X-Home-Region': 'us1', 'X-API-Domain': 'api.twilio.com', 'Strict-Transport-Security': 'max-age=31536000', 'X-Cache': 'Error from cloudfront', 'Via': '1.1 1f46652afcaf0a377b232da3cffaae08.cloudfront.net (CloudFront)', 'X-Amz-Cf-Pop': 'GRU3-P4', 'X-Amz-Cf-Id': 'mLOXqYK1N0pvB8Tw1j0FKGIBefWlhEJCf_zaLzWeFb2m5lRYPM0DcQ==', 'X-Powered-By': 'AT-5000', 'X-Shenanigans': 'none', 'Vary': 'Origin'}
2025-08-08 19:20:32,061 [ERROR] Falha ao enviar mensagem via API da Twilio: HTTP 429 error: Unable to create record: Account ACd2a6cd60871d661c034ecb40ddbd51e7 exceeded the 9 daily messages limit
2025-08-08 19:20:32,062 [INFO] THREAD: Processamento finalizado para 'Gostaria de comprar coca cola'
2025-08-08 19:21:04,795 [INFO] 172.18.0.1 - - [08/Aug/2025 19:21:04] "POST /webhook HTTP/1.1" 200 -
2025-08-08 19:21:04,796 [INFO] Arquivo de sess√£o encontrado. Carregando.
2025-08-08 19:21:04,798 [INFO] [llm_interface.py] Iniciando get_intent para mensagem: 'Gostaria de comprar coca-cola...'
2025-08-08 19:21:04,799 [INFO] [llm_interface.py] Tentando carregar prompt de: ai_llm/gav_prompt.txt
2025-08-08 19:21:04,800 [INFO] [llm_interface.py] Prompt carregado com sucesso. Tamanho: 2523 caracteres
2025-08-08 19:21:04,800 [INFO] [llm_interface.py] System prompt preparado. Tamanho: 2455 caracteres
2025-08-08 19:21:04,800 [INFO] [llm_interface.py] Configurando Ollama Host: 'http://host.docker.internal:11434'
2025-08-08 19:21:04,814 [INFO] [llm_interface.py] Verificando disponibilidade do modelo: llama3.1
2025-08-08 19:21:04,819 [INFO] HTTP Request: GET http://host.docker.internal:11434/api/tags "HTTP/1.1 200 OK"
2025-08-08 19:21:04,819 [WARNING] [llm_interface.py] N√£o foi poss√≠vel verificar modelos dispon√≠veis: 'name'
2025-08-08 19:21:04,819 [INFO] [llm_interface.py] Enviando requisi√ß√£o para o modelo llama3.1
2025-08-08 19:21:05,745 [INFO] HTTP Request: POST http://host.docker.internal:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 19:21:05,745 [INFO] [llm_interface.py] Resposta recebida do LLM. Tamanho: 89 caracteres
2025-08-08 19:21:05,745 [INFO] [llm_interface.py] JSON parseado com sucesso: {'tool_name': 'get_top_selling_products_by_name', 'parameters': {'product_name': 'coca'}}
2025-08-08 19:21:05,746 [INFO] INTEN√á√ÉO PROCESSADA: {'tool_name': 'get_top_selling_products_by_name', 'parameters': {'product_name': 'coca'}}
2025-08-08 19:21:05,751 [INFO] Salvando sess√£o: {'customer_context': None, 'shopping_cart': [], 'last_search_type': 'by_name', 'last_search_params': {'product_name': 'coca'}, 'current_offset': 5, 'last_shown_products': [{'codprod': 8130, 'descricao': 'REFRIG.COCA-COLA LT 350ML', 'pvenda': 4.2}, {'codprod': 13700, 'descricao': 'REFRIG.COCA-COLA PET 2L', 'pvenda': 8.5}], 'last_bot_action': 'AWAITING_PRODUCT_SELECTION', 'pending_action': None, 'last_kb_search_term': None}
2025-08-08 19:21:05,753 [INFO] Enviando mensagem proativa para whatsapp:+5511940726493: 'ü§ñ Encontrei estes produtos relacionados a 'coca':
1. REFRIG.COCA-COLA LT 350ML - R$ 4,20
2. REFRIG.COCA-COLA PET 2L - R$ 8,50
Me diga o nome ou o n√∫mero do item que deseja adicionar.
'
2025-08-08 19:21:05,753 [INFO] -- BEGIN Twilio API Request --
2025-08-08 19:21:05,753 [INFO] POST Request: https://api.twilio.com/2010-04-01/Accounts/ACd2a6cd60871d661c034ecb40ddbd51e7/Messages.json
2025-08-08 19:21:05,753 [INFO] Headers:
2025-08-08 19:21:05,753 [INFO] Content-Type : application/x-www-form-urlencoded
2025-08-08 19:21:05,754 [INFO] Accept : application/json
2025-08-08 19:21:05,754 [INFO] User-Agent : twilio-python/9.7.0 (Linux x86_64) Python/3.9.23
2025-08-08 19:21:05,754 [INFO] X-Twilio-Client : python-9.7.0
2025-08-08 19:21:05,754 [INFO] Accept-Charset : utf-8
2025-08-08 19:21:05,754 [INFO] -- END Twilio API Request --
2025-08-08 19:21:06,951 [INFO] Response Status Code: 201
2025-08-08 19:21:06,951 [INFO] Response Headers: {'Content-Type': 'application/json;charset=utf-8', 'Content-Length': '986', 'Connection': 'keep-alive', 'Date': 'Fri, 08 Aug 2025 19:21:06 GMT', 'Twilio-Concurrent-Requests': '1', 'Twilio-Request-Id': 'RQ25503306549447a45babedfa808ad3f6', 'Twilio-Request-Duration': '0.087', 'X-Home-Region': 'us1', 'X-API-Domain': 'api.twilio.com', 'Strict-Transport-Security': 'max-age=31536000', 'X-Cache': 'Miss from cloudfront', 'Via': '1.1 1f46652afcaf0a377b232da3cffaae08.cloudfront.net (CloudFront)', 'X-Amz-Cf-Pop': 'GRU3-P4', 'X-Amz-Cf-Id': '9JvpZT30wNLYW0n5T-WIqjovNam7hPZFqZMfelQE-MEJzRUXThW8lg==', 'X-Powered-By': 'AT-5000', 'X-Shenanigans': 'none', 'Vary': 'Origin'}
2025-08-08 19:21:06,952 [INFO] THREAD: Processamento finalizado para 'Gostaria de comprar coca-cola'
